<!-- build time:Fri Mar 05 2021 23:49:00 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><script>!function(){var t,e="在线分享网";document.addEventListener("visibilitychange",function(){document.hidden?(document.title="您去哪里了！",clearTimeout(t)):(document.title="在线分享网欢迎您",t=setTimeout(function(){document.title=e},2e3))})}()</script><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/icon.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/icon.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/icon.png?v=5.1.4"><link rel="mask-icon" href="/icon.png?v=5.1.4" color="#222"><meta name="keywords" content="Jenkins,持续集成/持续部署,"><link rel="alternate" href="/atom.xml" title="在线分享网" type="application/atom+xml"><meta name="description" content="持续集成及Jenkins介绍软件开发生命周期软件开发生命周期又叫做SDLC（Software Development Life Cycle），它是集合了计划、开发、测试 和部署过程的集合。如下图所示 ：需求分析这是生命周期的第一阶段，根据项目需求，团队执行一个可行性计划的分析。项目需求可能是公司内部 或者客户提出的。这阶段主要是对信息的收集，也有可能是对现有项目的改善和重新做一个新的项目。 还要分"><meta name="keywords" content="Jenkins,持续集成&#x2F;持续部署"><meta property="og:type" content="article"><meta property="og:title" content="持续集成及Jenkins详解"><meta property="og:url" content="https://me.obey.fun/持续集成及Jenkins详解.html"><meta property="og:site_name" content="在线分享网"><meta property="og:description" content="持续集成及Jenkins介绍软件开发生命周期软件开发生命周期又叫做SDLC（Software Development Life Cycle），它是集合了计划、开发、测试 和部署过程的集合。如下图所示 ：需求分析这是生命周期的第一阶段，根据项目需求，团队执行一个可行性计划的分析。项目需求可能是公司内部 或者客户提出的。这阶段主要是对信息的收集，也有可能是对现有项目的改善和重新做一个新的项目。 还要分"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://tva1.sinaimg.cn/large/73bac01bgy1go7no8t9twj20dw0dzwet.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7o6afqv0j20cm07r758.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ofujgyqj20bc07kdik.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7om0knh5j20di094gof.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7opzoltpj20fx08j0vt.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ovffxsuj20le09ut9k.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7pe9x4a9j20g3056t9u.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7pplz7rqj20rt0f6aa5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7sjuyydsj20my0ax407.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7sm8t7mdj20em04tt92.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7sn5lexoj20d70hajth.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7soqfp77j20j40aitam.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7spnwvbbj20oq097q3v.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7sqrj9i7j20l30eamza.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7srt961aj20on070dh1.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7srteplwj20nm068756.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7suo1zjxj20o6089wfa.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7svkvwurj20kq0gmgp9.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7sx094wmj20mi09ugnu.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7sy2kyc5j20ok0c10xc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7t08o7d4j20k40fcad9.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7t08qi5hj20kk0j6jvb.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7t1ns1toj20in0d1mzr.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7t32f1dvj20od0bp77d.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7t3t5irjj20g409dwf1.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7t4t35wbj20jy0gngnn.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7t8qcjwxj20kn0bljtv.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7t9lz4jej20m30g3n1t.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7tak7z2zj20nc0bg3zc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7tbqrrb0j20o10cwdhv.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7tbqqkspj20gs07rq3u.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7tbqr0vwj20oq0ffjte.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7texwmbvj20fl0b6jtj.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ti8gzg6j20jo03omxc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ti8ihtdj20kc06975f.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ti8hz3pj206l04474l.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ti8j99jj20jy079jsp.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ttm5a7qj20k306cta2.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7u07bdutj20kw099ack.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7u2fi6b2j20b80bn76g.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7u4a0qqsj20cq07jjt2.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7u7gdy2hj20ki09hmz9.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7u9t44iuj20jv0ac75w.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ue1nw4nj20a608pac5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ue1mqhcj20ft05kaak.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ue1mgvij208e06fweq.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7ue1n9mjj20jk05r3zd.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7uv8oui4j20cz0b1dgp.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7uwbymh8j20cd04zwf8.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7v4domfhj20c1059gm3.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7v4dj9ggj20ix0anq6e.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7v4d7yibj209b04fdg7.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7v4d8su6j20au0ao419.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbeiskij20i207egmc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbejp6bj20hg09kt9i.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbejrujj20kl04cdgn.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbemzt8j20ea0ck0vb.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbeleigj20jw0erq5n.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbekwsrj20kr06f3zc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbeorvpj20fs09i3zw.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzlljcj20kk099mzz.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzjbnoj208u05xmxi.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzk934j20ij044dg8.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzjk7dj20d703dt90.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzojarj20k408zwgs.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzqis7j20kf09xwhk.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzojfej20kb04xab3.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbemzt8j20ea0ck0vb.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzr2gjj20jy0efaco.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzs1pij207z04zq3e.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7wl3w1mkj20kp07hq45.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7wl3wka5j20kh06odg4.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7wl3xoj4j20k80a5mxw.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7wqwb3sfj20fx08qmyb.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7wqw9orkj20ag05d74k.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7wqwblndj20dw08z0tf.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7wqwdt1xj20hm08htav.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7x0qvkpnj20ib09ogoa.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7x0qx340j20ez09fq58.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7x0r3wd6j20fl08kgon.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7xddbkagj20km0b8767.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7xdda3kdj207t07mjs5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7xddbkaaj20g7062q3y.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7xlx6yduj209t04waau.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7xlx63k5j20e10600sy.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7xlx9u53j208y09yjs7.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7y2nvm60j20fr06vq3f.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7y2nxfr7j20fs097jtp.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7y2nwijlj20g9055dgg.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7y69i0jaj20ap05975c.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7y69h7xuj20b2064gmk.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7y69frcjj20gd05cq3e.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7yr3232mj20a005874y.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7yr332guj20dm07dabt.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7yr31mf7j208v098wfr.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7yuiy9rwj20g2059wf1.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7yuigubpj20e705s3zi.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go7yuizzp9j208h08jq4l.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go803zrn40j206z03s0sr.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go812j1fuwj20go08kabx.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go812j1c02j20eu097my3.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8173g2l9j20at03idgc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8173hhgkj20am060t90.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8173hilnj209l053mxe.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8173hilnj209l053mxe.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8s9zyhydj20d7051t9j.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8s9zxt55j20f607g3zg.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8s9zzel0j20dy07mwfy.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8skn2caaj20fy06wgn8.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8skn2m4rj20gz06zgnp.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8skn2jv0j20gk0760tr.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tbk5me3j20ep03vmxm.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tbk3ju2j208m065mxv.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tbk591qj20ew06ltaj.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tfqsf49j20bg06kwfe.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tfqrvsrj209e07bt9f.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tfqqkvcj20a606laad.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tja54hoj20hp058wez.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tja9nbpj20ko06n0tr.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8tja5qwoj20kv03kt9g.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8u1u0zwej20ko032dgi.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8u1u2qkcj20kc0dq41r.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8u1u13ztj20ju09djsf.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8uisiulej20f906h0tv.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8uisjztzj20kk0g9q6e.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8uismsnjj20jz09tdjs.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8urzc5cnj209s02fq30.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8urzc588j208r06jaal.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8urzd5qsj20kd09h0u2.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8v2s7k9rj20ex06ldgk.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8v2s7juqj20k703bq3o.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8v2s8l6qj20gb06hmy2.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8vfjx2f8j20g109ggn8.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8vfjyibqj20hz057t9q.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8vfjynw3j20jz088tas.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8vimvo12j20kj08s75d.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8vimtzisj20kr0bxta6.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8vimwa9xj207q05amxn.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8yaeaz7cj20ks07fmy5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8yaedqtej20ke0bbq6j.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8yae9qfzj20az069gmo.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8yl7zjb8j205l01et8q.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8ze6fficj20g504gglz.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8ze6gfn0j20ko08ydh0.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go8ze6gcysj20ir06pdge.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go905sxsy0j20gx09kgmk.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go905t0gfrj20gj08274w.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go905swi33j20fd0claah.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go90f3ldjuj20l2062gm5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go90f3iugaj20fm0a9q3d.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go90f3kbzlj20kl049mx8.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go90wco67jj20ki06hdh5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go90wcttlxj20k7061gma.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go90wct6mdj20i206yjs8.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go9145ow6sj208m063t9d.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go9145w65yj20jb0cumye.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go9145qvofj20kh0ghdj2.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go91vidga9j20kc0b7gng.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go91vic2hkj20cs0dwjtb.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go91viaixmj20am0363yp.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go926og1ufj20k70c4q45.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go926ofdumj20fk082ab5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go926oej7sj209i069jrs.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go92g8tu0hj20id06jq4a.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go92g8ykn5j20h908itc3.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go92g8sjnaj20ct04m3z2.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go93c0pruuj20jm0acjsv.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go93c0oet7j209l0ajgn6.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go93c0p9byj20ee08vabc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go93hfo0mdj20i00a83zf.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go93hg6ixoj20k40amjud.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go93hfo613j20b00390sx.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go953avvi1j20d30ab76j.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go953auxwgj209x06ujrq.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go953aua45j20as07qwf6.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go9551tmyjj20k6062dgc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go9551v0iyj20dq050q39.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go9551v98cj20fw0413z6.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go957ui22kj20bl09qt9o.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go957uj1cij20do08jwfh.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go957uk0csj20db0dbjsm.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go95husnwmj20cq08mjsc.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go95hut5jqj20bz08owfa.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go95huu5c2j20ko05qt9w.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96ihbqtij20ki04ddgy.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96ihfr0jj20fg0c4q6j.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96iheeo4j20gx04hq3k.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96po0pfgj20kv05imym.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96pnyf1uj209n058aai.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96po17nvj20ki0azt9y.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96s0aiybj20j205fwgi.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96s0dhjbj20e504maaf.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96s09z2nj20j5059wf4.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96x8ihw4j20e80b9abe.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96x8k7u3j20ku09nacp.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96x8kv50j20hm09wdkm.jpg"><meta property="og:image" content="https://tva4.sinaimg.cn/large/006MOU0zgy1go9eq05nmkj30oa0dl7c3.jpg"><meta property="og:image" content="https://tva2.sinaimg.cn/large/006MOU0zgy1go9epy9syyj30gr06fwgx.jpg"><meta property="og:image" content="https://tvax3.sinaimg.cn/large/006MOU0zgy1go9epxjknvj30ol048ad0.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/73bac01bgy1go96x8ihw4j20e80b9abe.jpg"><meta property="og:image" content="https://tvax2.sinaimg.cn/large/006MOU0zgy1go9f5re7t9j30g1098gna.jpg"><meta property="og:image" content="https://tva2.sinaimg.cn/large/006MOU0zgy1go9f5qxpvaj30kf02zq3r.jpg"><meta property="og:image" content="https://tvax4.sinaimg.cn/large/006MOU0zgy1go9f5qiyrgj309a03ot8w.jpg"><meta property="og:image" content="https://tvax1.sinaimg.cn/large/006MOU0zgy1go9f5qb0bwj30k6067t9z.jpg"><meta property="og:image" content="https://tva4.sinaimg.cn/large/006MOU0zgy1go9f5prep6j30c1088jsa.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/006MOU0zgy1go9fgee1gnj30hf061my8.jpg"><meta property="og:image" content="https://tvax1.sinaimg.cn/large/006MOU0zgy1go9fgdv735j30ob0dtmz1.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/006MOU0zgy1go9fgdhkwtj30bn03sglt.jpg"><meta property="og:image" content="https://tvax3.sinaimg.cn/large/006MOU0zgy1go9fgd9y08j30as06u75g.jpg"><meta property="og:image" content="https://tvax1.sinaimg.cn/large/006MOU0zgy1go9fgcyr82j30li0j6win.jpg"><meta property="og:image" content="https://tvax2.sinaimg.cn/large/006MOU0zgy1go9fgcddvsj309e04kglz.jpg"><meta property="og:image" content="https://tvax3.sinaimg.cn/large/006MOU0zgy1go9fgc4neoj30e303cwey.jpg"><meta property="og:image" content="https://tva2.sinaimg.cn/large/006MOU0zgy1go9fgbplf3j30oj09rtau.jpg"><meta property="og:image" content="https://tvax2.sinaimg.cn/large/006MOU0zgy1go9fgb5pm2j30om04fta0.jpg"><meta property="og:updated_time" content="2021-03-05T15:45:35.639Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="持续集成及Jenkins详解"><meta name="twitter:description" content="持续集成及Jenkins介绍软件开发生命周期软件开发生命周期又叫做SDLC（Software Development Life Cycle），它是集合了计划、开发、测试 和部署过程的集合。如下图所示 ：需求分析这是生命周期的第一阶段，根据项目需求，团队执行一个可行性计划的分析。项目需求可能是公司内部 或者客户提出的。这阶段主要是对信息的收集，也有可能是对现有项目的改善和重新做一个新的项目。 还要分"><meta name="twitter:image" content="http://tva1.sinaimg.cn/large/73bac01bgy1go7no8t9twj20dw0dzwet.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"2931888f"}),daovoice("update")</script><link rel="canonical" href="https://me.obey.fun/持续集成及Jenkins详解.html"><title>持续集成及Jenkins详解 | 在线分享网</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div id="particles-js"></div><div class="container sidebar-position-left page-post-detail"><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">在线分享网</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">分享，成为你我之间的快乐！</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档 <span class="badge">54</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签 <span class="badge">45</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类 <span class="badge">43</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-message"><a href="/message/" rel="section"><i class="menu-item-icon fa fa-fw fa-comments"></i><br>留言板</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-address-book-o"></i><br>友情链接</a></li><li class="menu-item menu-item-share"><a href="https://www.52share.online" rel="section"><i class="menu-item-icon fa fa-fw fa-hand-o-right"></i><br>资源分享</a></li><li class="menu-item menu-item-topx"><a href="/topx/" rel="section"><i class="menu-item-icon fa fa-fw fa-line-chart"></i><br>热度排序</a></li><li id="search" class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><div id="lanye_popup_bg" onclick="lanye_popup_closebox()" style="display:none"></div><div class="lanye_popup_top"><a style="border-bottom:0" href="javascript:lanye_popup_box();" target="_blank" rel="external nofollow"></a><div class="lanye_popup_closetop"></div></div><script async src="/js/src/ribbon.js" type="text/javascript"></script><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://me.obey.fun/持续集成及Jenkins详解.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="HuiProgramer"><meta itemprop="description" content=""><meta itemprop="image" content="https://huiprogramer.gitee.io/medias/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="在线分享网"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">持续集成及Jenkins详解</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-05T22:19:10+08:00">2021-03-05 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2021-03-05T23:45:35+08:00">2021-03-05 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CI-CD/" itemprop="url" rel="index"><span itemprop="name">CI/CD</span> </a></span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CI-CD/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span>评论: <span id="sourceId::持续集成及Jenkins详解" class="cy_cmt_count"></span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">21.7k 字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">94 分钟 </span><span id="/持续集成及Jenkins详解.html" class="leancloud_visitors" data-flag-title="持续集成及Jenkins详解"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-thermometer-1"></i> </span><span class="post-meta-item-text">热度&#58;</span> <span class="leancloud-visitors-count"></span> <span>℃</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="持续集成及Jenkins介绍"><a href="#持续集成及Jenkins介绍" class="headerlink" title="持续集成及Jenkins介绍"></a>持续集成及Jenkins介绍</h2><h3 id="软件开发生命周期"><a href="#软件开发生命周期" class="headerlink" title="软件开发生命周期"></a>软件开发生命周期</h3><p>软件开发生命周期又叫做SDLC（Software Development Life Cycle），它是集合了计划、开发、测试 和部署过程的集合。如下图所示 ：</p><p><img src="http://tva1.sinaimg.cn/large/73bac01bgy1go7no8t9twj20dw0dzwet.jpg" referrerpolicy="no-referrer"></p><ul><li><p>需求分析</p><p>这是生命周期的第一阶段，根据项目需求，团队执行一个可行性计划的分析。项目需求可能是公司内部 或者客户提出的。这阶段主要是对信息的收集，也有可能是对现有项目的改善和重新做一个新的项目。 还要分析项目的预算多长，可以从哪方面受益及布局，这也是项目创建的目标。</p></li><li><p>设计</p><p>第二阶段就是设计阶段，系统架构和满意状态（就是要做成什么样子，有什么功能），和创建一个项目 计划。计划可以使用图表，布局设计或者文者的方式呈现。</p></li><li><p>实现<br>第三阶段就是实现阶段，项目经理创建和分配工作给开者，开发者根据任务和在设计阶段定义的目标进 行开发代码。依据项目的大小和复杂程度，可以需要数月或更长时间才能完成。</p></li><li><p>测试</p><p>测试人员进行代码测试 ，包括功能测试、代码测试、压力测试等。</p></li><li><p>进化</p><p>最后进阶段就是对产品不断的进化改进和维护阶段，根据用户的使用情况，可能需要对某功能进行修 改，bug修复，功能增加等。</p></li></ul><h3 id="软件开发瀑布模型"><a href="#软件开发瀑布模型" class="headerlink" title="软件开发瀑布模型"></a>软件开发瀑布模型</h3><p>瀑布模型是最著名和最常使用的软件开发模型。瀑布模型就是一系列的软件开发过程。它是由制造业繁 衍出来的。一个高度化的结构流程在一个方向上流动，有点像生产线一样。在瀑布模型创建之初，没有 其它开发的模型，有很多东西全靠开发人员去猜测，去开发。这样的模型仅适用于那些简单的软件开 发， 但是已经不适合现在的开发了。</p><p>下图对软件开发模型的一个阐述。<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7o6afqv0j20cm07r758.jpg" referrerpolicy="no-referrer"></p><table><thead><tr><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td>简单易用和理解</td><td>各个阶段的划分完全固定，阶段之间产生大量的文档，极大地 增加了工作量。</td></tr><tr><td>当前一阶段完成后，您只需要 去关注后续阶段。</td><td>由于开发模型是线性的，用户只有等到整个过程的末期才能见 到开发成果，从而增加了开发风险。</td></tr><tr><td>为项目提供了按阶段划分的检 查节点</td><td>瀑布模型的突出缺点是不适应用户需求的变化。</td></tr></tbody></table><h3 id="软件的敏捷开发"><a href="#软件的敏捷开发" class="headerlink" title="软件的敏捷开发"></a>软件的敏捷开发</h3><h4 id="什么是敏捷开发"><a href="#什么是敏捷开发" class="headerlink" title="什么是敏捷开发"></a>什么是敏捷开发</h4><p>敏捷开发（Agile Development） 的核心是迭代开发（Iterative Development） 与 增量开发<br>（Incremental Development） 。</p><h5 id="何为迭代开发？"><a href="#何为迭代开发？" class="headerlink" title="何为迭代开发？"></a>何为迭代开发？</h5><p>对于大型软件项目，传统的开发方式是采用一个大周期（比如一年）进行开发，整个过程就是一次”大开发”；迭代开发的方式则不一样，它将开发过程拆分成多个小周期，即一次”大开发”变成多次”小开发”，每次小开发都是同样的流程，所以看上去就好像重复在做同样的步骤。</p><p>举例来说，SpaceX 公司想造一个大推力火箭，将人类送到火星。但是，它不是一开始就造大火箭，而是先造一个最简陋的小火箭 Falcon 1。结果，第一次发射就爆炸了，直到第四次发射，才成功进入轨道。然后，开发了中型火箭 Falcon 9，九年中发射了70次。最后，才开发 Falcon 重型火箭。如果SpaceX 不采用迭代开发，它可能直到现在还无法上天。</p><h5 id="何为增量开发？"><a href="#何为增量开发？" class="headerlink" title="何为增量开发？"></a>何为增量开发？</h5><p>软件的每个版本，都会新增一个用户可以感知的完整功能。也就是说，按照新增功能来划分迭代。</p><p>举例来说，房产公司开发一个10栋楼的小区。如果采用增量开发的模式，该公司第一个迭代就是交付一号楼，第二个迭代交付二号楼……每个迭代都是完成一栋完整的楼。而不是第一个迭代挖好10栋楼的地基，第二个迭代建好每栋楼的骨架，第三个迭代架设屋顶……</p><h4 id="敏捷开发如何迭代？"><a href="#敏捷开发如何迭代？" class="headerlink" title="敏捷开发如何迭代？"></a>敏捷开发如何迭代？</h4><p>虽然敏捷开发将软件开发分成多个迭代，但是也要求，每次迭代都是一个完整的软件开发周期，必须按照软件工程的方法论，进行正规的流程管理。</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ofujgyqj20bc07kdik.jpg" referrerpolicy="no-referrer"></p><h4 id="敏捷开发有什么好处？"><a href="#敏捷开发有什么好处？" class="headerlink" title="敏捷开发有什么好处？"></a>敏捷开发有什么好处？</h4><h5 id="早期交付"><a href="#早期交付" class="headerlink" title="早期交付"></a>早期交付</h5><p>敏捷开发的第一个好处，就是早期交付，从而大大降低成本。 还是以上一节的房产公司为例，如果按照传统的”瀑布开发模式”，先挖10栋楼的地基、再盖骨架、然后架设屋顶，每个阶段都等到前一个阶段完成后开始，可能需要两年才能一次性交付10栋楼。也就是说，如果不考虑预售，该项目必须等到两年后才能回款。 敏捷开发是六个月后交付一号楼，后面每两个月交付一栋楼。因此，半年就能回款10%，后面每个月都会有现金流，资金压力就大大减轻了。</p><h5 id="降低风险"><a href="#降低风险" class="headerlink" title="降低风险"></a>降低风险</h5><p>敏捷开发的第二个好处是，及时了解市场需求，降低产品不适用的风险。 请想一想，哪一种情况损失比较小：10栋楼都造好以后，才发现卖不出去，还是造好第一栋楼，就发现卖不出去，从而改进或停建后面9栋楼？</p><h3 id="什么是持续集成"><a href="#什么是持续集成" class="headerlink" title="什么是持续集成"></a>什么是持续集成</h3><p>持续集成（ Continuous integration ， 简称 CI ）指的是，频繁地（一天多次）将代码集成到主干。</p><p><strong>持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。</strong>它的核心措施是，代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败，就不能集成。</p><p>通过持续集成， 团队可以快速的从一个功能到另一个功能，简而言之，敏捷软件开发很大一部分都要归功于持续集成。</p><h4 id="持续集成的流程"><a href="#持续集成的流程" class="headerlink" title="持续集成的流程"></a>持续集成的流程</h4><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7om0knh5j20di094gof.jpg" referrerpolicy="no-referrer"></p><p>根据持续集成的设计，代码从提交到生产，整个过程有以下几步。</p><ul><li><p>提交<br>流程的第一步，是开发者向代码仓库提交代码。所有后面的步骤都始于本地代码的一次提交<br>（commit）。</p></li><li><p>测试（第一轮）<br>代码仓库对commit操作配置了钩子（hook），只要提交代码或者合并进主干，就会跑自动化测试。</p></li><li><p>构建<br>通过第一轮测试，代码就可以合并进主干，就算可以交付了。<br>交付后，就先进行构建（build），再进入第二轮测试。所谓构建，指的是将源码转换为可以运行的实际代码，比如安装依赖，配置各种资源（样式表、JS脚本、图片）等等。</p></li><li><p>测试（第二轮）<br>构建完成，就要进行第二轮测试。如果第一轮已经涵盖了所有测试内容，第二轮可以省略，当然，这时构建步骤也要移到第一轮测试前面。</p></li><li><p>部署<br>过了第二轮测试，当前代码就是一个可以直接部署的版本（artifact）。将这个版本的所有文件打包（tar filename.tar * ）存档，发到生产服务器。</p></li><li><p>回滚<br>一旦当前版本发生问题，就要回滚到上一个版本的构建结果。最简单的做法就是修改一下符号链接，指向上一个版本的目录。</p></li></ul><h3 id="持续集成的组成要素"><a href="#持续集成的组成要素" class="headerlink" title="持续集成的组成要素"></a>持续集成的组成要素</h3><ul><li><p>一个自动构建过程， 从检出代码、 编译构建、 运行测试、 结果记录、 测试统计等都是自动完成<br>的， 无需人工干预。</p></li><li><p>一个代码存储库，即需要版本控制软件来保障代码的可维护性，同时作为构建过程的素材库，一般<br>使用SVN或Git。</p></li><li><p>一个持续集成服务器， Jenkins 就是一个配置简单和使用方便的持续集成服务器。</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7opzoltpj20fx08j0vt.jpg" referrerpolicy="no-referrer"></p><h3 id="持续集成的好处"><a href="#持续集成的好处" class="headerlink" title="持续集成的好处"></a>持续集成的好处</h3><ol><li>降低风险，由于持续集成不断去构建，编译和测试，可以很早期发现问题，所以修复的代价就少；</li><li>对系统健康持续检查，减少发布风险带来的问题；</li><li>减少重复性工作；</li><li>持续部署，提供可部署单元包；</li><li>持续交付可供使用的版本；</li><li>增强团队信心；</li></ol><h3 id="Jenkins介绍"><a href="#Jenkins介绍" class="headerlink" title="Jenkins介绍"></a>Jenkins介绍</h3><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ovffxsuj20le09ut9k.jpg" referrerpolicy="no-referrer"></p><p>Jenkins 是一款流行的开源持续集成（Continuous Integration）工具，广泛用于项目开发，具有自动化构建、测试和部署等功能。官网： <a href="http://jenkins-ci.org/。" target="_blank" rel="noopener">http://jenkins-ci.org/。</a></p><p>Jenkins的特征：</p><ul><li>开源的Java语言开发持续集成工具，支持持续集成，持续部署。</li><li><p>易于安装部署配置：可通过yum安装,或下载war包以及通过docker容器等快速实现安装部署，可<br>方便web界面配置管理。</p></li><li><p>消息通知及测试报告：集成RSS/E-mail通过RSS发布构建结果或当构建完成时通过e-mail通知，生<br>成JUnit/TestNG测试报告。</p></li><li><p>分布式构建：支持Jenkins能够让多台计算机一起构建/测试。</p></li><li>文件识别：Jenkins能够跟踪哪次构建生成哪些jar，哪次构建使用哪个版本的jar等。</li><li>丰富的插件支持：支持扩展插件，你可以开发适合自己团队使用的工具，如git，svn，maven，<br>docker等。</li></ul><h3 id="Jenkins安装和持续集成环境配置"><a href="#Jenkins安装和持续集成环境配置" class="headerlink" title="Jenkins安装和持续集成环境配置"></a>Jenkins安装和持续集成环境配置</h3><h4 id="持续集成流程说明"><a href="#持续集成流程说明" class="headerlink" title="持续集成流程说明"></a>持续集成流程说明</h4><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7pe9x4a9j20g3056t9u.jpg" referrerpolicy="no-referrer"></p><ol><li>首先，开发人员每天进行代码提交，提交到Git仓库</li><li>然后，Jenkins作为持续集成工具，使用Git工具到Git仓库拉取代码到集成服务器，再配合JDK，<br>Maven等软件完成代码编译，代码测试与审查，测试，打包等工作，在这个过程中每一步出错，都重新再执行一次整个流程。</li><li>最后，Jenkins把生成的jar或war包分发到测试服务器或者生产服务器，测试人员或用户就可以访问应用。</li></ol><h5 id="服务器列表"><a href="#服务器列表" class="headerlink" title="服务器列表"></a>服务器列表</h5><table><thead><tr><th>名称</th><th>IP地址</th><th>安装的软件</th></tr></thead><tbody><tr><td>代码托管服务器</td><td>192.168.66.100</td><td>Gitlab-12.4.2</td></tr><tr><td>持续集成服务器</td><td>192.168.66.101</td><td>Jenkins-2.190.3，JDK1.8，Maven3.6.2，Git， SonarQube</td></tr><tr><td>应用测试服务器</td><td>192.168.66.102</td><td>JDK1.8，Tomcat8.5</td></tr></tbody></table><h4 id="Gitlab代码托管服务器安装"><a href="#Gitlab代码托管服务器安装" class="headerlink" title="Gitlab代码托管服务器安装"></a>Gitlab代码托管服务器安装</h4><h5 id="Gitlab简介"><a href="#Gitlab简介" class="headerlink" title="Gitlab简介"></a>Gitlab简介</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7pplz7rqj20rt0f6aa5.jpg" referrerpolicy="no-referrer"></p><p>官网： <a href="https://about.gitlab.com/" target="_blank" rel="noopener">https://about.gitlab.com/</a><br>GitLab 是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的<br>web服务。</p><p>GitLab和GitHub一样属于第三方基于Git开发的作品，免费且开源（基于MIT协议），与Github类似，可以注册用户，任意提交你的代码，添加SSHKey等等。不同的是，<strong>GitLab是可以部署到自己的服务器上，数据库等一切信息都掌握在自己手上，适合团队内部协作开发</strong>，你总不可能把团队内部的智慧总放在别人的服务器上吧？简单来说可把GitLab看作个人版的GitHub。</p><h5 id="Gitlab安装"><a href="#Gitlab安装" class="headerlink" title="Gitlab安装"></a>Gitlab安装</h5><ol><li>安装相关依赖<blockquote><p>yum -y install policycoreutils openssh-server openssh-clients postfix</p></blockquote></li><li>启动ssh服务&amp;设置为开机启动<blockquote><p>systemctl enable sshd &amp;&amp; sudo systemctl start sshd</p></blockquote></li><li>设置postfix开机自启，并启动，postfix支持gitlab发信功能<blockquote><p>systemctl enable postfix &amp;&amp; systemctl start postfix</p></blockquote></li><li>开放ssh以及http服务，然后重新加载防火墙列表<blockquote><p>firewall-cmd –add-service=ssh –permanent<br>firewall-cmd –add-service=http –permanent<br>firewall-cmd –reload<br>如果关闭防火墙就不需要做以上配置</p></blockquote></li><li>下载gitlab包，并且安装<br>在线下载安装包：<blockquote><p>wget <a href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x</a><br>86_64.rpm<br>安装：<br>rpm -i gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm</p></blockquote></li><li>修改gitlab配置<blockquote><p>vi /etc/gitlab/gitlab.rb<br>修改gitlab访问地址和端口，默认为80，我们改为82<br>external_url ‘<a href="http://192.168.66.100:82" target="_blank" rel="noopener">http://192.168.66.100:82</a><br>nginx[‘listen_port’] = 82</p></blockquote></li><li>重载配置及启动gitlab<blockquote><p>gitlab-ctl reconfigure<br>gitlab-ctl restart</p></blockquote></li><li>把端口添加到防火墙<blockquote><p>firewall-cmd –zone=public –add-port=82/tcp –permanent<br>firewall-cmd –reload<br>启动成功后，看到以下修改管理员root密码的页面，修改密码后，然后登录即可</p></blockquote></li></ol><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7sjuyydsj20my0ax407.jpg" referrerpolicy="no-referrer"></p><h5 id="Gitlab添加组、创建用户、创建项目"><a href="#Gitlab添加组、创建用户、创建项目" class="headerlink" title="Gitlab添加组、创建用户、创建项目"></a>Gitlab添加组、创建用户、创建项目</h5><p>1）创建组<br>使用管理员 root 创建组，一个组里面可以有多个项目分支，可以将开发添加到组里面进行设置权限，不同的组就是公司不同的开发项目或者服务模块，不同的组添加不同的开发即可实现对开发设置权限的管理<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7sm8t7mdj20em04tt92.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7sn5lexoj20d70hajth.jpg" referrerpolicy="no-referrer"><br>2）创建用户<br>创建用户的时候，可以选择Regular或Admin类型。<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7soqfp77j20j40aitam.jpg" referrerpolicy="no-referrer"><br>创建完用户后，立即修改密码<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7spnwvbbj20oq097q3v.jpg" referrerpolicy="no-referrer"><br>3）将用户添加到组中<br>选择某个用户组，进行Members管理组的成员<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7sqrj9i7j20l30eamza.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7srt961aj20on070dh1.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7srteplwj20nm068756.jpg" referrerpolicy="no-referrer"><br>Gitlab用户在组里面有5种不同权限：</p><p>Guest：可以创建issue、发表评论，不能读写版本库<br>Reporter：可以克隆代码，不能提交，QA、PM可以赋予这个权限<br>Developer：可以克隆代码、开发、提交、push，普通开发可以赋予这个权限<br>Maintainer：可以创建项目、添加tag、保护分支、添加项目成员、编辑项目，核心开发可以赋予这个权限<br>Owner：可以设置项目访问权限 - Visibility Level、删除项目、迁移项目、管理组成员，开发组组长可以赋予这个权限</p><p>4）在用户组中创建项目<br>以刚才创建的新用户身份登录到Gitlab，然后在用户组中创建新的项目<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7suo1zjxj20o6089wfa.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7svkvwurj20kq0gmgp9.jpg" referrerpolicy="no-referrer"></p><h4 id="源码上传到Gitlab仓库"><a href="#源码上传到Gitlab仓库" class="headerlink" title="源码上传到Gitlab仓库"></a>源码上传到Gitlab仓库</h4><p>下面来到IDEA开发工具，我们已经准备好一个简单的Web应用准备到集成部署。<br>我们要把源码上传到Gitlab的项目仓库中。<br>1）项目结构说明<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7sx094wmj20mi09ugnu.jpg" referrerpolicy="no-referrer"></p><p>我们建立了一个非常简单的web应用，只有一个index.jsp页面，如果部署好，可以访问该页面就成功啦！<br>2）开启版本控制<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7sy2kyc5j20ok0c10xc.jpg" referrerpolicy="no-referrer"><br>3）提交代码到本地仓库<br>先Add到缓存区<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7t08o7d4j20k40fcad9.jpg" referrerpolicy="no-referrer"><br>再Commit到本地仓库<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7t08qi5hj20kk0j6jvb.jpg" referrerpolicy="no-referrer"><br>4）推送到Gitlab项目仓库中<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7t1ns1toj20in0d1mzr.jpg" referrerpolicy="no-referrer"><br>这时都Gitlab的项目中拷贝url地址<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7t32f1dvj20od0bp77d.jpg" referrerpolicy="no-referrer"><br>输入gitlab的用户名和密码，然后就可以把代码推送到远程仓库啦<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7t3t5irjj20g409dwf1.jpg" referrerpolicy="no-referrer"><br>刷新gitlab项目<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7t4t35wbj20jy0gngnn.jpg" referrerpolicy="no-referrer"></p><h4 id="持续集成环境-1-Jenkins安装"><a href="#持续集成环境-1-Jenkins安装" class="headerlink" title="持续集成环境(1)-Jenkins安装"></a>持续集成环境(1)-Jenkins安装</h4><p>1）安装JDK<br>Jenkins需要依赖JDK，所以先安装JDK1.8</p><blockquote><p>yum install java-1.8.0-openjdk* -y</p></blockquote><p>安装目录为：/usr/lib/jvm<br>2）获取jenkins安装包<br>下载页面：<a href="https://jenkins.io/zh/download/" target="_blank" rel="noopener">https://jenkins.io/zh/download/</a><br>安装文件：jenkins-2.190.3-1.1.noarch.rpm<br>3）把安装包上传到192.168.66.101服务器，进行安装</p><blockquote><p>rpm -ivh jenkins-2.190.3-1.1.noarch.rpm</p></blockquote><p>4）修改Jenkins配置</p><blockquote><p>vi /etc/syscofig/jenkins</p></blockquote><p>修改内容如下：</p><blockquote><p>JENKINS_USER=”root”<br>JENKINS_PORT=”8888”</p></blockquote><p>5）启动Jenkins</p><blockquote><p>systemctl start jenkins</p></blockquote><p>6）打开浏览器访问<br><a href="http://192.168.66.101:8888" target="_blank" rel="noopener">http://192.168.66.101:8888</a><br>注意：本服务器把防火墙关闭了，如果开启防火墙，需要在防火墙添加端口<br>7）获取并输入admin账户密码</p><blockquote><p>cat /var/lib/jenkins/secrets/initialAdminPassword</p></blockquote><p>8）跳过插件安装<br>因为Jenkins插件需要连接默认官网下载，速度非常慢，而且经过会失败，所以我们暂时先跳过插件安装<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7t8qcjwxj20kn0bljtv.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7t9lz4jej20m30g3n1t.jpg" referrerpolicy="no-referrer"><br>9）添加一个管理员账户，并进入Jenkins后台<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7tak7z2zj20nc0bg3zc.jpg" referrerpolicy="no-referrer"><br>保存并完成<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7tbqrrb0j20o10cwdhv.jpg" referrerpolicy="no-referrer"><br>开始使用Jenkins<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7tbqqkspj20gs07rq3u.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7tbqr0vwj20oq0ffjte.jpg" referrerpolicy="no-referrer"></p><h4 id="持续集成环境-2-Jenkins插件管理"><a href="#持续集成环境-2-Jenkins插件管理" class="headerlink" title="持续集成环境(2)-Jenkins插件管理"></a>持续集成环境(2)-Jenkins插件管理</h4><p>Jenkins本身不提供很多功能，我们可以通过使用插件来满足我们的使用。例如从Gitlab拉取代码，使用Maven构建项目等功能需要依靠插件完成。接下来演示如何下载插件。</p><h5 id="修改Jenkins插件下载地址"><a href="#修改Jenkins插件下载地址" class="headerlink" title="修改Jenkins插件下载地址"></a>修改Jenkins插件下载地址</h5><p>Jenkins国外官方插件地址下载速度非常慢，所以可以修改为国内插件地址：<br>Jenkins-&gt;Manage Jenkins-&gt;Manage Plugins，点击Available</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7texwmbvj20fl0b6jtj.jpg" referrerpolicy="no-referrer"><br>这样做是为了把Jenkins官方的插件列表下载到本地，接着修改地址文件，替换为国内插件地址</p><blockquote><p>cd /var/lib/jenkins/updates<br>sed -i ‘s/http:\/\/updates.jenkinsci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g’ default.json &amp;&amp; sed -i<br>‘s/http:\/\/<a href="http://www.google.com/https:\/\/www.baidu.com/g&#39;" target="_blank" rel="noopener">www.google.com/https:\/\/www.baidu.com/g&#39;</a> default.json</p></blockquote><p>最后，Manage Plugins点击Advanced，把Update Site改为国内插件下载地址<br><a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</a><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ti8gzg6j20jo03omxc.jpg" referrerpolicy="no-referrer"><br>Sumbit后，在浏览器输入： <a href="http://192.168.66.101:8888/restart" target="_blank" rel="noopener">http://192.168.66.101:8888/restart</a> ，重启Jenkins。</p><h5 id="下载中文汉化插件"><a href="#下载中文汉化插件" class="headerlink" title="下载中文汉化插件"></a>下载中文汉化插件</h5><p>Jenkins-&gt;Manage Jenkins-&gt;Manage Plugins，点击Available，搜索”Chinese”<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ti8ihtdj20kc06975f.jpg" referrerpolicy="no-referrer"></p><p>完成后如下图：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ti8hz3pj206l04474l.jpg" referrerpolicy="no-referrer"><br>重启Jenkins后，就看到Jenkins汉化了！（PS：但可能部分菜单汉化会失败）<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ti8j99jj20jy079jsp.jpg" referrerpolicy="no-referrer"></p><h4 id="持续集成环境-3-Jenkins用户权限管理"><a href="#持续集成环境-3-Jenkins用户权限管理" class="headerlink" title="持续集成环境(3)-Jenkins用户权限管理"></a>持续集成环境(3)-Jenkins用户权限管理</h4><p>我们可以利用Role-based Authorization Strategy 插件来管理Jenkins用户权限</p><h5 id="安装Role-based-Authorization-Strategy插件"><a href="#安装Role-based-Authorization-Strategy插件" class="headerlink" title="安装Role-based Authorization Strategy插件"></a>安装Role-based Authorization Strategy插件</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ttm5a7qj20k306cta2.jpg" referrerpolicy="no-referrer"></p><h5 id="开启权限全局安全配置"><a href="#开启权限全局安全配置" class="headerlink" title="开启权限全局安全配置"></a>开启权限全局安全配置</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7u07bdutj20kw099ack.jpg" referrerpolicy="no-referrer"><br>授权策略切换为”Role-Based Strategy”，保存<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7u2fi6b2j20b80bn76g.jpg" referrerpolicy="no-referrer"></p><h5 id="创建角色"><a href="#创建角色" class="headerlink" title="创建角色"></a>创建角色</h5><p>在系统管理页面进入 Manage and Assign Roles<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7u4a0qqsj20cq07jjt2.jpg" referrerpolicy="no-referrer"><br>点击”Manage Roles”</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7u7gdy2hj20ki09hmz9.jpg" referrerpolicy="no-referrer"><br>Global roles（全局角色）：管理员等高级用户可以创建基于全局的角色 Project roles（项目角色）：<br>针对某个或者某些项目的角色 Slave roles（奴隶角色）：节点相关的权限</p><p>我们添加以下三个角色：</p><ul><li><p>baseRole：该角色为全局角色。这个角色需要绑定Overall下面的Read权限，是为了给所有用户绑定最基本的Jenkins访问权限。注意：如果不给后续用户绑定这个角色，会报错误：<strong>用户名 is<br>missing the Overall/Read permission</strong></p></li><li><p>role1：该角色为项目角色。使用正则表达式绑定”itcast.*”，意思是只能操作itcast开头的项目。</p></li><li><p>role2：该角色也为项目角色。绑定”itheima.*”，意思是只能操作itheima开头的项目。</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7u9t44iuj20jv0ac75w.jpg" referrerpolicy="no-referrer"></p><p>保存。</p><h6 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h6><p>在系统管理页面进入 Manage Users</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ue1nw4nj20a608pac5.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ue1mqhcj20ft05kaak.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ue1mgvij208e06fweq.jpg" referrerpolicy="no-referrer"></p><p>分别创建两个用户：jack和eric<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7ue1n9mjj20jk05r3zd.jpg" referrerpolicy="no-referrer"></p><h6 id="给用户分配角色"><a href="#给用户分配角色" class="headerlink" title="给用户分配角色"></a>给用户分配角色</h6><p>系统管理页面进入Manage and Assign Roles，点击Assign Roles<br>绑定规则如下：</p><ul><li><p>eric用户分别绑定baseRole和role1角色</p></li><li><p>jack用户分别绑定baseRole和role2角色</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7uv8oui4j20cz0b1dgp.jpg" referrerpolicy="no-referrer"></p><p>保存。</p><h6 id="创建项目测试权限"><a href="#创建项目测试权限" class="headerlink" title="创建项目测试权限"></a>创建项目测试权限</h6><p>以itcast管理员账户创建两个项目，分别为itcast01和itheima01<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7uwbymh8j20cd04zwf8.jpg" referrerpolicy="no-referrer"></p><p>结果为：</p><ul><li>eric用户登录，只能看到itcast01项目</li><li>jack用户登录，只能看到itheima01项目</li></ul><h4 id="持续集成环境-4-Jenkins凭证管理"><a href="#持续集成环境-4-Jenkins凭证管理" class="headerlink" title="持续集成环境(4)-Jenkins凭证管理"></a>持续集成环境(4)-Jenkins凭证管理</h4><p>凭据可以用来存储需要密文保护的数据库密码、Gitlab密码信息、Docker私有仓库密码等，以便<br>Jenkins可以和这些第三方的应用进行交互。</p><h5 id="安装Credentials-Binding插件"><a href="#安装Credentials-Binding插件" class="headerlink" title="安装Credentials Binding插件"></a>安装Credentials Binding插件</h5><p>要在Jenkins使用凭证管理功能，需要安装Credentials Binding插件<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7v4domfhj20c1059gm3.jpg" referrerpolicy="no-referrer"></p><p>安装插件后，左边多了”凭证”菜单，在这里管理所有凭证<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7v4dj9ggj20ix0anq6e.jpg" referrerpolicy="no-referrer"></p><p>可以添加的凭证有5种：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7v4d7yibj209b04fdg7.jpg" referrerpolicy="no-referrer"></p><ul><li>Username with password：用户名和密码</li><li>SSH Username with private key： 使用SSH用户和密钥</li><li>Secret file：需要保密的文本文件，使用时Jenkins会将文件复制到一个临时目录中，再将文件路径设置到一个变量中，等构建结束后，所复制的Secret file就会被删除。</li><li>Secret text：需要保存的一个加密的文本串，如钉钉机器人或Github的api token</li><li>Certificate：通过上传证书文件的方式</li></ul><p>常用的凭证类型有：Username with password（用户密码）和SSH Username with private key（SSH密钥）</p><p>接下来以使用Git工具到Gitlab拉取项目源码为例，演示Jenkins的如何管理Gitlab的凭证。</p><h5 id="安装Git插件和Git工具"><a href="#安装Git插件和Git工具" class="headerlink" title="安装Git插件和Git工具"></a>安装Git插件和Git工具</h5><p>为了让Jenkins支持从Gitlab拉取源码，需要安装Git插件以及在CentOS7上安装Git工具。<br>Git插件安装：</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7v4d8su6j20au0ao419.jpg" referrerpolicy="no-referrer"></p><p>CentOS7上安装Git工具：</p><blockquote><p>yum install git -y 安装<br>git –version 安装后查看版本</p></blockquote><h5 id="用户密码类型"><a href="#用户密码类型" class="headerlink" title="用户密码类型"></a>用户密码类型</h5><p>1）创建凭证<br>Jenkins-&gt;凭证-&gt;系统-&gt;全局凭证-&gt;添加凭证<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbeiskij20i207egmc.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbejp6bj20hg09kt9i.jpg" referrerpolicy="no-referrer"></p><p>选择”Username with password”，输入Gitlab的用户名和密码，点击”确定”。<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbejrujj20kl04cdgn.jpg" referrerpolicy="no-referrer"></p><p>2）测试凭证是否可用<br>创建一个FreeStyle项目：新建Item-&gt;FreeStyle Project-&gt;确定<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbemzt8j20ea0ck0vb.jpg" referrerpolicy="no-referrer"></p><p>找到”源码管理”-&gt;”Git”，在Repository URL复制Gitlab中的项目URL</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbeleigj20jw0erq5n.jpg" referrerpolicy="no-referrer"></p><p>这时会报错说无法连接仓库！在Credentials选择刚刚添加的凭证就不报错啦</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbekwsrj20kr06f3zc.jpg" referrerpolicy="no-referrer"></p><p>保存配置后，点击构建”Build Now“ 开始构建项目<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbeorvpj20fs09i3zw.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzlljcj20kk099mzz.jpg" referrerpolicy="no-referrer"></p><p>查看/var/lib/jenkins/workspace/目录，发现已经从Gitlab成功拉取了代码到Jenkins中。<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzjbnoj208u05xmxi.jpg" referrerpolicy="no-referrer"></p><h5 id="SSH密钥类型"><a href="#SSH密钥类型" class="headerlink" title="SSH密钥类型"></a>SSH密钥类型</h5><p>SSH免密登录示意图<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzk934j20ij044dg8.jpg" referrerpolicy="no-referrer"></p><p>1）使用root用户生成公钥和私钥</p><blockquote><p>ssh-keygen -t rsa</p></blockquote><p>在/root/.ssh/目录保存了公钥和使用<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzjk7dj20d703dt90.jpg" referrerpolicy="no-referrer"></p><p>id_rsa：私钥文件<br>id_rsa.pub：公钥文件</p><p>2）把生成的公钥放在Gitlab中<br>以root账户登录-&gt;点击头像-&gt;Settings-&gt;SSH Keys<br>复制刚才id_rsa.pub文件的内容到这里，点击”Add Key”<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzojarj20k408zwgs.jpg" referrerpolicy="no-referrer"></p><p>3）在Jenkins中添加凭证，配置私钥<br>在Jenkins添加一个新的凭证，类型为”SSH Username with private key”，把刚才生成私有文件内容复制过来</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzqis7j20kf09xwhk.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzojfej20kb04xab3.jpg" referrerpolicy="no-referrer"></p><p>4）测试凭证是否可用<br>新建”test02”项目-&gt;源码管理-&gt;Git，这次要使用Gitlab的SSH连接，并且选择SSH凭证<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vbemzt8j20ea0ck0vb.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzr2gjj20jy0efaco.jpg" referrerpolicy="no-referrer"></p><p>同样尝试构建项目，如果代码可以正常拉取，代表凭证配置成功！<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7vnzs1pij207z04zq3e.jpg" referrerpolicy="no-referrer"></p><h4 id="持续集成环境-5-Maven安装和配置"><a href="#持续集成环境-5-Maven安装和配置" class="headerlink" title="持续集成环境(5)-Maven安装和配置"></a>持续集成环境(5)-Maven安装和配置</h4><p>在Jenkins集成服务器上，我们需要安装Maven来编译和打包项目。</p><h5 id="安装Maven"><a href="#安装Maven" class="headerlink" title="安装Maven"></a>安装Maven</h5><p>先上传Maven软件到192.168.66.101</p><blockquote><p>tar -xzf apache-maven-3.6.2-bin.tar.gz 解压<br>mkdir -p /opt/maven 创建目录<br>mv apache-maven-3.6.2/* /opt/maven 移动文件</p></blockquote><h5 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h5><blockquote><p>vi /etc/profile</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk</span><br><span class="line">export MAVEN_HOME=/opt/maven</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin</span><br></pre></td></tr></table></figure><blockquote><p>source /etc/profile 配置生效<br>mvn -v 查找Maven版本</p></blockquote><h5 id="全局工具配置关联JDK和Maven"><a href="#全局工具配置关联JDK和Maven" class="headerlink" title="全局工具配置关联JDK和Maven"></a>全局工具配置关联JDK和Maven</h5><p>Jenkins-&gt;Global Tool Configuration-&gt;JDK-&gt;新增JDK，配置如下：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7wl3w1mkj20kp07hq45.jpg" referrerpolicy="no-referrer"></p><p>Jenkins-&gt;Global Tool Configuration-&gt;Maven-&gt;新增Maven，配置如下：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7wl3wka5j20kh06odg4.jpg" referrerpolicy="no-referrer"></p><h5 id="添加Jenkins全局变量"><a href="#添加Jenkins全局变量" class="headerlink" title="添加Jenkins全局变量"></a>添加Jenkins全局变量</h5><p>Manage Jenkins-&gt;Configure System-&gt;Global Properties ，添加三个全局变量<br>JAVA_HOME、M2_HOME、PATH+EXTRA<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7wl3xoj4j20k80a5mxw.jpg" referrerpolicy="no-referrer"></p><h5 id="修改Maven的settings-xml"><a href="#修改Maven的settings-xml" class="headerlink" title="修改Maven的settings.xml"></a>修改Maven的settings.xml</h5><blockquote><p>mkdir /root/repo 创建本地仓库目录<br>vi /opt/maven/conf/settings.xml</p></blockquote><p>本地仓库改为：/root/repo/<br>添加阿里云私服地址：</p><blockquote><p>alimaven aliyun maven <a href="http://maven.aliyun.com/nexus/content/groups/public/" target="_blank" rel="noopener">http://maven.aliyun.com/nexus/content/groups/public/</a> central</p></blockquote><h5 id="测试Maven是否配置成功"><a href="#测试Maven是否配置成功" class="headerlink" title="测试Maven是否配置成功"></a>测试Maven是否配置成功</h5><p>使用之前的gitlab密码测试项目，修改配置<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7wqwb3sfj20fx08qmyb.jpg" referrerpolicy="no-referrer"></p><p>构建-&gt;增加构建步骤-&gt;Execute Shell<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7wqw9orkj20ag05d74k.jpg" referrerpolicy="no-referrer"><br>输入</p><blockquote><p>mvn clean package<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7wqwblndj20dw08z0tf.jpg" referrerpolicy="no-referrer"></p></blockquote><p>再次构建，如果可以把项目打成war包，代表maven环境配置成功啦！<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7wqwdt1xj20hm08htav.jpg" referrerpolicy="no-referrer"></p><h4 id="持续集成环境-6-Tomcat安装和配置"><a href="#持续集成环境-6-Tomcat安装和配置" class="headerlink" title="持续集成环境(6)-Tomcat安装和配置"></a>持续集成环境(6)-Tomcat安装和配置</h4><h5 id="安装Tomcat8-5"><a href="#安装Tomcat8-5" class="headerlink" title="安装Tomcat8.5"></a>安装Tomcat8.5</h5><p>把Tomcat压缩包上传到192.168.66.102服务器</p><blockquote><p>yum install java-1.8.0-openjdk<em> -y 安装JDK（已完成）<br>tar -xzf apache-tomcat-8.5.47.tar.gz 解压<br>mkdir -p /opt/tomcat 创建目录<br>mv /root/apache-tomcat-8.5.47/</em> /opt/tomcat 移动文件<br>/opt/tomcat/bin/startup.sh 启动tomcat</p></blockquote><p>注意：服务器已经关闭了防火墙，所以可以直接访问Tomcat啦<br>地址为：<a href="http://192.168.66.102/8080" target="_blank" rel="noopener">http://192.168.66.102/8080</a><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7x0qvkpnj20ib09ogoa.jpg" referrerpolicy="no-referrer"></p><h5 id="配置Tomcat用户角色权限"><a href="#配置Tomcat用户角色权限" class="headerlink" title="配置Tomcat用户角色权限"></a>配置Tomcat用户角色权限</h5><p>默认情况下Tomcat是没有配置用户角色权限的<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7x0qx340j20ez09fq58.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7x0r3wd6j20fl08kgon.jpg" referrerpolicy="no-referrer"></p><p>但是，后续Jenkins部署项目到Tomcat服务器，需要用到Tomcat的用户，所以修改tomcat以下配置，添加用户及权限</p><blockquote><p>vi /opt/tomcat/conf/tomcat-users.xml</p></blockquote><p>内容如下：<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tomcat-users</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"tomcat"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"role1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-script"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-status"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin-gui"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin-script"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"tomcat"</span> <span class="attr">password</span>=<span class="string">"tomcat"</span> <span class="attr">roles</span>=<span class="string">"manager-gui,managerscript,tomcat,admin-gui,admin-script"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tomcat-users</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>用户和密码都是：tomcat<br>注意：为了能够刚才配置的用户登录到Tomcat，还需要修改以下配置</p><blockquote><p>vi /opt/tomcat/webapps/manager/META-INF/context.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">&lt;Valve className="org.apache.catalina.valves.RemoteAddrValve"</span></span><br><span class="line"><span class="comment">allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" /&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p>把上面这行注释掉即可！<br><strong>重启Tomcat，访问测试</strong></p><blockquote><p>/opt/tomcat/bin/shutdown.sh 停止<br>/opt/tomcat/bin/startup.sh 启动</p></blockquote><p>访问： <a href="http://192.168.66.102:8080/manager/html" target="_blank" rel="noopener">http://192.168.66.102:8080/manager/html</a> ，输入tomcat和tomcat，看到以下页面代表成功啦<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7xddbkagj20km0b8767.jpg" referrerpolicy="no-referrer"></p><h4 id="Jenkins构建Maven项目"><a href="#Jenkins构建Maven项目" class="headerlink" title="Jenkins构建Maven项目"></a>Jenkins构建Maven项目</h4><h5 id="Jenkins项目构建类型-1-Jenkins构建的项目类型介绍"><a href="#Jenkins项目构建类型-1-Jenkins构建的项目类型介绍" class="headerlink" title="Jenkins项目构建类型(1)-Jenkins构建的项目类型介绍"></a>Jenkins项目构建类型(1)-Jenkins构建的项目类型介绍</h5><p>Jenkins中自动构建项目的类型有很多，常用的有以下三种：</p><ul><li>自由风格软件项目（FreeStyle Project）</li><li>Maven项目（Maven Project）</li><li>流水线项目（Pipeline Project）</li></ul><p>每种类型的构建其实都可以完成一样的构建过程与结果，只是在操作方式、灵活度等方面有所区别，在实际开发中可以根据自己的需求和习惯来选择。（PS：个人推荐使用流水线类型，因为灵活度非常高）</p><h5 id="Jenkins项目构建类型-2-自由风格项目构建"><a href="#Jenkins项目构建类型-2-自由风格项目构建" class="headerlink" title="Jenkins项目构建类型(2)-自由风格项目构建"></a>Jenkins项目构建类型(2)-自由风格项目构建</h5><p>下面演示创建一个自由风格项目来完成项目的集成过程：</p><blockquote><p>拉取代码-&gt;编译-&gt;打包-&gt;部署</p></blockquote><h6 id="拉取代码"><a href="#拉取代码" class="headerlink" title="拉取代码"></a>拉取代码</h6><p>1）创建项目</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7xdda3kdj207t07mjs5.jpg" referrerpolicy="no-referrer"></p><p>2）配置源码管理，从gitlab拉取代码</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7xddbkaaj20g7062q3y.jpg" referrerpolicy="no-referrer"></p><h6 id="编译打包"><a href="#编译打包" class="headerlink" title="编译打包"></a>编译打包</h6><p>构建-&gt;添加构建步骤-&gt;Executor Shell<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo "开始编译和打包"</span><br><span class="line">mvn clean package</span><br><span class="line">echo "编译和打包结束"</span><br></pre></td></tr></table></figure><p></p><h6 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h6><p>把项目部署到远程的Tomcat里面<br>1）安装 Deploy to container插件<br>Jenkins本身无法实现远程部署到Tomcat的功能，需要安装Deploy to container插件实现</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7xlx6yduj209t04waau.jpg" referrerpolicy="no-referrer"></p><p>2）添加Tomcat用户凭证<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7xlx63k5j20e10600sy.jpg" referrerpolicy="no-referrer"></p><p>3）添加构建后操作<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7xlx9u53j208y09yjs7.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7y2nvm60j20fr06vq3f.jpg" referrerpolicy="no-referrer"></p><p>点击”Build Now”，开始构建过程<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7y2nxfr7j20fs097jtp.jpg" referrerpolicy="no-referrer"></p><p>4）部署成功后，访问项目<br><a href="http://192.168.66.102:8080/web_demo-1.0-SNAPSHOT/" target="_blank" rel="noopener">http://192.168.66.102:8080/web_demo-1.0-SNAPSHOT/</a></p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7y2nwijlj20g9055dgg.jpg" referrerpolicy="no-referrer"></p><h6 id="演示改动代码后的持续集成"><a href="#演示改动代码后的持续集成" class="headerlink" title="演示改动代码后的持续集成"></a>演示改动代码后的持续集成</h6><p>1）IDEA中源码修改并提交到gitlab<br>2）在Jenkins中项目重新构建<br>3）访问Tomcat</p><h5 id="Jenkins项目构建类型-3-Maven项目构建"><a href="#Jenkins项目构建类型-3-Maven项目构建" class="headerlink" title="Jenkins项目构建类型(3)-Maven项目构建"></a>Jenkins项目构建类型(3)-Maven项目构建</h5><p>1）安装Maven Integration插件<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7y69i0jaj20ap05975c.jpg" referrerpolicy="no-referrer"></p><p>2）创建Maven项目<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7y69h7xuj20b2064gmk.jpg" referrerpolicy="no-referrer"></p><p>3）配置项目<br>拉取代码和远程部署的过程和自由风格项目一样，只是”构建”部分不同<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7y69frcjj20gd05cq3e.jpg" referrerpolicy="no-referrer"></p><h5 id="Jenkins项目构建类型-4-Pipeline流水线项目构建"><a href="#Jenkins项目构建类型-4-Pipeline流水线项目构建" class="headerlink" title="Jenkins项目构建类型(4)-Pipeline流水线项目构建(*)"></a>Jenkins项目构建类型(4)-Pipeline流水线项目构建(*)</h5><h6 id="Pipeline简介"><a href="#Pipeline简介" class="headerlink" title="Pipeline简介"></a>Pipeline简介</h6><p>1）概念<br>Pipeline，简单来说，就是一套运行在 Jenkins 上的工作流框架，将原来独立运行于单个或者多个节点的任务连接起来，实现单个任务难以完成的复杂流程编排和可视化的工作。</p><p>2）使用Pipeline有以下好处（来自翻译自官方文档）：<br>代码：Pipeline以代码的形式实现，通常被检入源代码控制，使团队能够编辑，审查和迭代其传送流<br>程。 持久：无论是计划内的还是计划外的服务器重启，Pipeline都是可恢复的。 可停止：Pipeline可接收交互式输入，以确定是否继续执行Pipeline。 多功能：Pipeline支持现实世界中复杂的持续交付要求。它支持fork/join、循环执行，并行执行任务的功能。 可扩展：Pipeline插件支持其DSL的自定义扩展 ，以及与其他插件集成的多个选项。</p><p>3）如何创建 Jenkins Pipeline呢？</p><ul><li>Pipeline 脚本是由 Groovy 语言实现的，但是我们没必要单独去学习 Groovy</li><li>Pipeline 支持两种语法：Declarative(声明式)和 Scripted Pipeline(脚本式)语法</li><li>Pipeline 也有两种创建方法：可以直接在 Jenkins 的 Web UI 界面中输入脚本；也可以通过创建一个 Jenkinsfile 脚本文件放入项目源码库中（一般我们都推荐在 Jenkins 中直接从源代码控制(SCM)<br>中直接载入 Jenkinsfile Pipeline 这种方法）。</li></ul><h6 id="安装Pipeline插件"><a href="#安装Pipeline插件" class="headerlink" title="安装Pipeline插件"></a>安装Pipeline插件</h6><p>Manage Jenkins-&gt;Manage Plugins-&gt;可选插件<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7yr3232mj20a005874y.jpg" referrerpolicy="no-referrer"><br>安装插件后，创建项目的时候多了“流水线”类型<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7yr332guj20dm07dabt.jpg" referrerpolicy="no-referrer"></p><h6 id="Pipeline语法快速入门"><a href="#Pipeline语法快速入门" class="headerlink" title="Pipeline语法快速入门"></a>Pipeline语法快速入门</h6><p><strong>1）Declarative声明式-Pipeline</strong><br>创建项目<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7yr31mf7j208v098wfr.jpg" referrerpolicy="no-referrer"></p><p>流水线-&gt;选择HelloWorld模板<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7yuiy9rwj20g2059wf1.jpg" referrerpolicy="no-referrer"></p><p>生成内容如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">	agent any</span><br><span class="line">	stages &#123;</span><br><span class="line">		stage(&apos;Hello&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				echo &apos;Hello World&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>stages：代表整个流水线的所有执行阶段。通常stages只有1个，里面包含多个stage<br>stage：代表流水线中的某个阶段，可能出现n个。一般分为拉取代码，编译构建，部署等阶段。<br>steps：代表一个阶段内需要执行的逻辑。steps里面是shell脚本，git拉取代码，ssh远程发布等任意内容。<br>编写一个简单声明式Pipeline：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">	agent any</span><br><span class="line">	stages &#123;</span><br><span class="line">		stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				echo &apos;拉取代码&apos;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		stage(&apos;编译构建&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				echo &apos;编译构建&apos;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		stage(&apos;项目部署&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				echo &apos;项目部署&apos;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>点击构建，可以看到整个构建过程<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7yuigubpj20e705s3zi.jpg" referrerpolicy="no-referrer"></p><p><strong>2）Scripted Pipeline脚本式-Pipeline</strong><br>创建项目<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go7yuizzp9j208h08jq4l.jpg" referrerpolicy="no-referrer"></p><p>这次选择”Scripted Pipeline”<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go803zrn40j206z03s0sr.jpg" referrerpolicy="no-referrer"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">	def mvnHome</span><br><span class="line">	stage(&apos;Preparation&apos;) &#123; // for display purposes</span><br><span class="line">	&#125;</span><br><span class="line">	stage(&apos;Build&apos;) &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	stage(&apos;Results&apos;) &#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>Node：节点，一个 Node 就是一个 Jenkins 节点，Master 或者 Agent，是执行 Step 的具体运行<br>环境，后续讲到Jenkins的Master-Slave架构的时候用到。</p></li><li><p>Stage：阶段，一个 Pipeline 可以划分为若干个 Stage，每个 Stage 代表一组操作，比如：<br>Build、Test、Deploy，Stage 是一个逻辑分组的概念。</p></li><li><p>Step：步骤，Step 是最基本的操作单元，可以是打印一句话，也可以是构建一个 Docker 镜像，<br>由各类 Jenkins 插件提供，比如命令：sh ‘make’，就相当于我们平时 shell 终端中执行 make 命令<br>一样。</p></li></ul><p>编写一个简单的脚本式Pipeline<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">	def mvnHome</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123; // for display purposes</span><br><span class="line">		echo &apos;拉取代码&apos;</span><br><span class="line">	&#125;</span><br><span class="line">	stage(&apos;编译构建&apos;) &#123;</span><br><span class="line">		echo &apos;编译构建&apos;</span><br><span class="line">	&#125;</span><br><span class="line">	stage(&apos;项目部署&apos;) &#123;</span><br><span class="line">		echo &apos;项目部署&apos;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>构建结果和声明式一样！</p><p><strong>拉取代码</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">	agent any</span><br><span class="line">	stages &#123;</span><br><span class="line">		stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">					checkout([$class: &apos;GitSCM&apos;, branches: [[name:&apos;*/master&apos;]],doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &apos;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&apos;, url:</span><br><span class="line">&apos;git@192.168.66.100:itheima_group/web_demo.git&apos;]]])</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>部署</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">	agent any</span><br><span class="line">	stages &#123;</span><br><span class="line">		stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/master&apos;]],doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &apos;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&apos;, url:&apos;git@192.168.66.100:itheima_group/web_demo.git&apos;]]])</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		stage(&apos;编译构建&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				sh label: &apos;&apos;, script: &apos;mvn clean package&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		stage(&apos;项目部署&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				deploy adapters: [tomcat8(credentialsId: &apos;afc43e5e-4a4e-4de6-984fb1d5a254e434&apos;, path: &apos;&apos;, url: &apos;http://192.168.66.102:8080&apos;)], contextPath: null,war: &apos;target/*.war&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>Pipeline Script from SCM</strong><br>刚才我们都是直接在Jenkins的UI界面编写Pipeline代码，这样不方便脚本维护，建议把Pipeline脚本放在项目中（一起进行版本控制）<br>1）在项目根目录建立Jenkinsfile文件，把内容复制到该文件中<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go812j1fuwj20go08kabx.jpg" referrerpolicy="no-referrer"></p><p>把Jenkinsfile上传到Gitlab</p><p>2）在项目中引用该文件<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go812j1c02j20eu097my3.jpg" referrerpolicy="no-referrer"></p><h4 id="Jenkins项目构建细节-1-常用的构建触发器"><a href="#Jenkins项目构建细节-1-常用的构建触发器" class="headerlink" title="Jenkins项目构建细节(1)-常用的构建触发器"></a>Jenkins项目构建细节(1)-常用的构建触发器</h4><p>Jenkins内置4种构建触发器：</p><ul><li>触发远程构建</li><li>其他工程构建后触发（Build after other projects are build）</li><li>定时构建（Build periodically）</li><li>轮询SCM（Poll SCM）</li></ul><p><strong>触发远程构建</strong><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8173g2l9j20at03idgc.jpg" referrerpolicy="no-referrer"></p><p>触发构建url：<a href="http://192.168.66.101:8888/job/web_demo_pipeline/build?token=6666" target="_blank" rel="noopener">http://192.168.66.101:8888/job/web_demo_pipeline/build?token=6666</a></p><p><strong>其他工程构建后触发</strong><br>1）创建pre_job流水线工程<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8173hhgkj20am060t90.jpg" referrerpolicy="no-referrer"><br>2）配置需要触发的工程<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8173hilnj209l053mxe.jpg" referrerpolicy="no-referrer"><br><strong>定时构建</strong><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8173hilnj209l053mxe.jpg" referrerpolicy="no-referrer"><br>定时字符串从左往右分别为： 分 时 日 月 周<br>一些定时表达式的例子：</p><blockquote><p>每30分钟构建一次：H代表形参 H/30 <em></em> <em></em> 10:02 10:32<br>每2个小时构建一次: H H/2 <em></em> <em><br>每天的8点，12点，22点，一天构建3次： (多个时间点中间用逗号隔开) 0 8,12,22 </em><em></em><br>每天中午12点定时构建一次 H 12 <em></em> <em><br>每天下午18点定时构建一次 H 18 </em><em></em><br>在每个小时的前半个小时内的每10分钟 H(0-29)/10 <em></em> <em></em><br>每两小时一次，每个工作日上午9点到下午5点(也许是上午10:38，下午12:38，下午2:38，下午<br>4:38) H H(9-16)/2 <em></em> 1-5</p></blockquote><p><strong>轮询SCM</strong><br>轮询SCM，是指定时扫描本地代码仓库的代码是否有变更，如果代码有变更就触发项目构建。<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8s9zyhydj20d7051t9j.jpg" referrerpolicy="no-referrer"><br>注意：这次构建触发器，Jenkins会定时扫描本地整个项目的代码，增大系统的开销，不建议使用。</p><h4 id="Jenkins项目构建细节-2-Git-hook自动触发构建"><a href="#Jenkins项目构建细节-2-Git-hook自动触发构建" class="headerlink" title="Jenkins项目构建细节(2)-Git hook自动触发构建(*)"></a>Jenkins项目构建细节(2)-Git hook自动触发构建(*)</h4><p>刚才我们看到在Jenkins的内置构建触发器中，轮询SCM可以实现Gitlab代码更新，项目自动构建，但是该方案的性能不佳。那有没有更好的方案呢？ 有的。就是利用Gitlab的webhook实现代码push到仓库，立即触发项目自动构建。<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8s9zxt55j20f607g3zg.jpg" referrerpolicy="no-referrer"></p><h5 id="安装Gitlab-Hook插件"><a href="#安装Gitlab-Hook插件" class="headerlink" title="安装Gitlab Hook插件"></a>安装Gitlab Hook插件</h5><p>需要安装两个插件：<br>Gitlab Hook和GitLab<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8s9zzel0j20dy07mwfy.jpg" referrerpolicy="no-referrer"></p><h5 id="Jenkins设置自动构建"><a href="#Jenkins设置自动构建" class="headerlink" title="Jenkins设置自动构建"></a>Jenkins设置自动构建</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8skn2caaj20fy06wgn8.jpg" referrerpolicy="no-referrer"><br>等会需要把生成的webhook URL配置到Gitlab中。</p><h5 id="Gitlab配置webhook"><a href="#Gitlab配置webhook" class="headerlink" title="Gitlab配置webhook"></a>Gitlab配置webhook</h5><p>1）开启webhook功能<br>使用root账户登录到后台，点击Admin Area -&gt; Settings -&gt; Network<br>勾选”Allow requests to the local network from web hooks and services”<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8skn2m4rj20gz06zgnp.jpg" referrerpolicy="no-referrer"><br>2）在项目添加webhook<br>点击项目-&gt;Settings-&gt;Integrations<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8skn2jv0j20gk0760tr.jpg" referrerpolicy="no-referrer"><br>注意：以下设置必须完成，否则会报错！<br>Manage Jenkins-&gt;Configure System<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tbk5me3j20ep03vmxm.jpg" referrerpolicy="no-referrer"></p><h4 id="Jenkins项目构建细节-3-Jenkins的参数化构建"><a href="#Jenkins项目构建细节-3-Jenkins的参数化构建" class="headerlink" title="Jenkins项目构建细节(3)-Jenkins的参数化构建"></a>Jenkins项目构建细节(3)-Jenkins的参数化构建</h4><p>有时在项目构建的过程中，我们需要根据用户的输入动态传入一些参数，从而影响整个构建结果，这时我们可以使用参数化构建。</p><p>Jenkins支持非常丰富的参数类型<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tbk3ju2j208m065mxv.jpg" referrerpolicy="no-referrer"><br>接下来演示通过输入gitlab项目的分支名称来部署不同分支项目。</p><h5 id="项目创建分支，并推送到Gitlab上"><a href="#项目创建分支，并推送到Gitlab上" class="headerlink" title="项目创建分支，并推送到Gitlab上"></a>项目创建分支，并推送到Gitlab上</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tbk591qj20ew06ltaj.jpg" referrerpolicy="no-referrer"></p><p>新建分支：v1，代码稍微改动下，然后提交到gitlab上。<br>这时看到gitlab上有一个两个分支：master和v1</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tfqsf49j20bg06kwfe.jpg" referrerpolicy="no-referrer"></p><h5 id="在Jenkins添加字符串类型参数"><a href="#在Jenkins添加字符串类型参数" class="headerlink" title="在Jenkins添加字符串类型参数"></a>在Jenkins添加字符串类型参数</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tfqrvsrj209e07bt9f.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tfqqkvcj20a606laad.jpg" referrerpolicy="no-referrer"></p><h5 id="改动pipeline流水线代码"><a href="#改动pipeline流水线代码" class="headerlink" title="改动pipeline流水线代码"></a>改动pipeline流水线代码</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tja54hoj20hp058wez.jpg" referrerpolicy="no-referrer"></p><h5 id="点击Build-with-Parameters"><a href="#点击Build-with-Parameters" class="headerlink" title="点击Build with Parameters"></a>点击Build with Parameters</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tja9nbpj20ko06n0tr.jpg" referrerpolicy="no-referrer"></p><p>输入分支名称，构建即可！构建完成后访问Tomcat查看结果</p><h4 id="Jenkins项目构建细节-4-配置邮箱服务器发送构建结果"><a href="#Jenkins项目构建细节-4-配置邮箱服务器发送构建结果" class="headerlink" title="Jenkins项目构建细节(4)-配置邮箱服务器发送构建结果"></a>Jenkins项目构建细节(4)-配置邮箱服务器发送构建结果</h4><h5 id="安装Email-Extension插件"><a href="#安装Email-Extension插件" class="headerlink" title="安装Email Extension插件"></a>安装Email Extension插件</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8tja5qwoj20kv03kt9g.jpg" referrerpolicy="no-referrer"></p><h5 id="Jenkins设置邮箱相关参数"><a href="#Jenkins设置邮箱相关参数" class="headerlink" title="Jenkins设置邮箱相关参数"></a>Jenkins设置邮箱相关参数</h5><p>Manage Jenkins-&gt;Configure System<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8u1u0zwej20ko032dgi.jpg" referrerpolicy="no-referrer"></p><p>设置邮件参数<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8u1u2qkcj20kc0dq41r.jpg" referrerpolicy="no-referrer"><br>设置Jenkins默认邮箱信息<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8u1u13ztj20ju09djsf.jpg"></p><h5 id="准备邮件内容"><a href="#准备邮件内容" class="headerlink" title="准备邮件内容"></a>准备邮件内容</h5><p>在项目根目录编写email.html，并把文件推送到Gitlab，内容如下：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8uisiulej20f906h0tv.jpg" referrerpolicy="no-referrer"><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>$&#123;ENV, var="JOB_NAME"&#125;-第$&#123;BUILD_NUMBER&#125;次构建日志<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">leftmargin</span>=<span class="string">"8"</span> <span class="attr">marginwidth</span>=<span class="string">"0"</span> <span class="attr">topmargin</span>=<span class="string">"8"</span> <span class="attr">marginheight</span>=<span class="string">"4"</span></span></span><br><span class="line"><span class="tag"><span class="attr">offset</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">"95%"</span> <span class="attr">cellpadding</span>=<span class="string">"0"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag"><span class="attr">style</span>=<span class="string">"font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>(本邮件是程序自动下发的，请勿回复！)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#0000FF"</span>&gt;</span>构建结果 - $&#123;BUILD_STATUS&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#0B610B"</span>&gt;</span>构建信息<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">"2"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">align</span>=<span class="string">"center"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>项目名称&amp;nbsp;：&amp;nbsp;$&#123;PROJECT_NAME&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>构建编号&amp;nbsp;：&amp;nbsp;第$&#123;BUILD_NUMBER&#125;次构建<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>触发原因：&amp;nbsp;$&#123;CAUSE&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>构建日志：&amp;nbsp;<span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag"><span class="attr">href</span>=<span class="string">"$&#123;BUILD_URL&#125;console"</span>&gt;</span>$&#123;BUILD_URL&#125;console<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>构建&amp;nbsp;&amp;nbsp;Url&amp;nbsp;：&amp;nbsp;<span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag"><span class="attr">href</span>=<span class="string">"$&#123;BUILD_URL&#125;"</span>&gt;</span>$&#123;BUILD_URL&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>工作目录&amp;nbsp;：&amp;nbsp;<span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag"><span class="attr">href</span>=<span class="string">"$&#123;PROJECT_URL&#125;ws"</span>&gt;</span>$&#123;PROJECT_URL&#125;ws<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>项目&amp;nbsp;&amp;nbsp;Url&amp;nbsp;：&amp;nbsp;<span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag"><span class="attr">href</span>=<span class="string">"$&#123;PROJECT_URL&#125;"</span>&gt;</span>$&#123;PROJECT_URL&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#0B610B"</span>&gt;</span>Changes Since Last</span><br><span class="line">Successful Build:<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">"2"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">align</span>=<span class="string">"center"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">编写Jenkinsfile添加构建后发送邮件</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>历史变更记录 : <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag"><span class="attr">href</span>=<span class="string">"$&#123;PROJECT_URL&#125;changes"</span>&gt;</span>$&#123;PROJECT_URL&#125;changes<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> $&#123;CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for</span><br><span class="line">Build #%n:<span class="tag">&lt;<span class="name">br</span> /&gt;</span>%c<span class="tag">&lt;<span class="name">br</span> /&gt;</span>",showPaths=true,changesFormat="<span class="tag">&lt;<span class="name">pre</span>&gt;</span>[%a]<span class="tag">&lt;<span class="name">br</span></span></span><br><span class="line"><span class="tag">/&gt;</span>%m<span class="tag">&lt;/<span class="name">pre</span>&gt;</span>",pathFormat="&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p"&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>Failed Test Results<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">"2"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">align</span>=<span class="string">"center"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span></span></span><br><span class="line"><span class="tag"><span class="attr">style</span>=<span class="string">"font-size: 11pt; font-family: Tahoma, Arial, Helvetica,</span></span></span><br><span class="line"><span class="tag"><span class="string">sans-serif"</span>&gt;</span>$FAILED_TESTS<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#0B610B"</span>&gt;</span>构建日志 (最后 100行):<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">"2"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">align</span>=<span class="string">"center"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"80"</span> <span class="attr">rows</span>=<span class="string">"30"</span> <span class="attr">readonly</span>=<span class="string">"readonly"</span></span></span><br><span class="line"><span class="tag"><span class="attr">style</span>=<span class="string">"font-family: Courier New"</span>&gt;</span>$&#123;BUILD_LOG,</span><br><span class="line">maxLines=100&#125;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h5 id="编写Jenkinsfile添加构建后发送邮件"><a href="#编写Jenkinsfile添加构建后发送邮件" class="headerlink" title="编写Jenkinsfile添加构建后发送邮件"></a>编写Jenkinsfile添加构建后发送邮件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">	agent any</span><br><span class="line">		stages &#123;</span><br><span class="line">			stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">				steps &#123;</span><br><span class="line">					checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/master&apos;]],doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &apos;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&apos;, url:&apos;git@192.168.66.100:itheima_group/web_demo.git&apos;]]])</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">		stage(&apos;编译构建&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				sh label: &apos;&apos;, script: &apos;mvn clean package&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		stage(&apos;项目部署&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">			deploy adapters: [tomcat8(credentialsId: &apos;afc43e5e-4a4e-4de6-984fb1d5a254e434&apos;, path: &apos;&apos;, url: &apos;http://192.168.66.102:8080&apos;)], contextPath: null,war: &apos;target/*.war&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		post &#123;</span><br><span class="line">			always &#123;</span><br><span class="line">				emailext(</span><br><span class="line">					subject: &apos;构建通知：$&#123;PROJECT_NAME&#125; - Build # $&#123;BUILD_NUMBER&#125; -</span><br><span class="line">$&#123;BUILD_STATUS&#125;!&apos;,body: &apos;$&#123;FILE,path=&quot;email.html&quot;&#125;&apos;,to: &apos;xxx@qq.com&apos;)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8uisjztzj20kk0g9q6e.jpg" referrerpolicy="no-referrer"></p><p>PS：邮件相关全局参数参考列表：<br>系统设置-&gt;Extended E-mail Notification-&gt;Content Token Reference，点击旁边的?号</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8uismsnjj20jz09tdjs.jpg" referrerpolicy="no-referrer"></p><h4 id="Jenkins-SonarQube代码审查-1-安装SonarQube"><a href="#Jenkins-SonarQube代码审查-1-安装SonarQube" class="headerlink" title="Jenkins+SonarQube代码审查(1) - 安装SonarQube"></a>Jenkins+SonarQube代码审查(1) - 安装SonarQube</h4><h5 id="SonaQube简介"><a href="#SonaQube简介" class="headerlink" title="SonaQube简介"></a>SonaQube简介</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8urzc5cnj209s02fq30.jpg" referrerpolicy="no-referrer"><br>SonarQube是一个用于管理代码质量的开放平台，可以快速的定位代码中潜在的或者明显的错误。目前支持java,C#,C/C++,Python,PL/SQL,Cobol,JavaScrip,Groovy等二十几种编程语言的代码质量管理与检测。</p><p>官网：<a href="https://www.sonarqube.org" target="_blank" rel="noopener">https://www.sonarqube.org</a></p><h5 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h5><table><thead><tr><th>软件</th><th>服务器</th><th>版本</th></tr></thead><tbody><tr><td>JDK</td><td>192.168.66.101</td><td>1.8</td></tr><tr><td>MySQL</td><td>192.168.66.101</td><td>5.7</td></tr><tr><td>SonarQube</td><td>192.168.66.101</td><td>6.7.4</td></tr></tbody></table><h5 id="安装SonarQube"><a href="#安装SonarQube" class="headerlink" title="安装SonarQube"></a>安装SonarQube</h5><ol><li>安装MySQL</li><li>安装SonarQube</li></ol><p>在MySQL创建sonar数据库<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8urzc588j208r06jaal.jpg" referrerpolicy="no-referrer"><br>下载sonar压缩包：<br><a href="https://www.sonarqube.org/downloads/" target="_blank" rel="noopener">https://www.sonarqube.org/downloads/</a><br>解压sonar，并设置权限</p><blockquote><p>yum install unzip<br>unzip sonarqube-6.7.4.zip 解压<br>mkdir /opt/sonar 创建目录<br>mv sonarqube-6.7.4/* /opt/sonar 移动文件<br>useradd sonar 创建sonar用户，必须sonar用于启动，否则报错<br>chown -R sonar. /opt/sonar 更改sonar目录及文件权限</p></blockquote><p>修改sonar配置文件</p><blockquote><p>vi /opt/sonarqube-6.7.4/conf/sonar.properties</p></blockquote><p>内容如下：</p><blockquote><p>sonar.jdbc.username=root sonar.jdbc.password=Root@123<br>sonar.jdbc.url=jdbc:mysql://localhost:3306/sonar?<br>useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=<br>maxPerformance&amp;useSSL=false</p></blockquote><p>注意：sonar默认监听9000端口，如果9000端口被占用，需要更改。<br>启动sonar</p><blockquote><p>cd /opt/sonarqube-6.7.4<br>su sonar ./bin/linux-x86-64/sonar.sh start 启动<br>su sonar ./bin/linux-x86-64/sonar.sh status 查看状态<br>su sonar ./bin/linux-x86-64/sonar.sh stop 停止<br>tail -f logs/sonar.logs 查看日志</p></blockquote><p>访问sonar<br><a href="http://192.168.66.101:9000" target="_blank" rel="noopener">http://192.168.66.101:9000</a></p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8urzd5qsj20kd09h0u2.jpg" referrerpolicy="no-referrer"></p><p>默认账户：admin/admin<br>创建token</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8v2s7k9rj20ex06ldgk.jpg" referrerpolicy="no-referrer"></p><p>token要记下来后面要使用<br>例如：<strong>0151ae8c548a143eda9253e4334ad030b56047ee</strong></p><h4 id="Jenkins-SonarQube代码审查-2-实现代码审查"><a href="#Jenkins-SonarQube代码审查-2-实现代码审查" class="headerlink" title="Jenkins+SonarQube代码审查(2) - 实现代码审查"></a>Jenkins+SonarQube代码审查(2) - 实现代码审查</h4><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8v2s7juqj20k703bq3o.jpg" referrerpolicy="no-referrer"></p><h5 id="安装SonarQube-Scanner插件"><a href="#安装SonarQube-Scanner插件" class="headerlink" title="安装SonarQube Scanner插件"></a>安装SonarQube Scanner插件</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8v2s8l6qj20gb06hmy2.jpg" referrerpolicy="no-referrer"></p><h5 id="添加SonarQube凭证"><a href="#添加SonarQube凭证" class="headerlink" title="添加SonarQube凭证"></a>添加SonarQube凭证</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8vfjx2f8j20g109ggn8.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8vfjyibqj20hz057t9q.jpg" referrerpolicy="no-referrer"></p><h5 id="Jenkins进行SonarQube配置"><a href="#Jenkins进行SonarQube配置" class="headerlink" title="Jenkins进行SonarQube配置"></a>Jenkins进行SonarQube配置</h5><p>Manage Jenkins-&gt;Configure System-&gt;SonarQube servers<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8vfjynw3j20jz088tas.jpg" referrerpolicy="no-referrer"><br>Manage Jenkins-&gt;Global Tool Configuration<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8vimvo12j20kj08s75d.jpg" referrerpolicy="no-referrer"></p><h5 id="SonaQube关闭审查结果上传到SCM功能"><a href="#SonaQube关闭审查结果上传到SCM功能" class="headerlink" title="SonaQube关闭审查结果上传到SCM功能"></a>SonaQube关闭审查结果上传到SCM功能</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8vimtzisj20kr0bxta6.jpg" referrerpolicy="no-referrer"></p><h5 id="在项目添加SonaQube代码审查（非流水线项目）"><a href="#在项目添加SonaQube代码审查（非流水线项目）" class="headerlink" title="在项目添加SonaQube代码审查（非流水线项目）"></a>在项目添加SonaQube代码审查（非流水线项目）</h5><p>添加构建步骤：<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># must be unique in a given SonarQube instance</span><br><span class="line">sonar.projectKey=web_demo</span><br><span class="line"># this is the name and version displayed in the SonarQube UI. Was mandatory</span><br><span class="line">prior to SonarQube 6.1.</span><br><span class="line">sonar.projectName=web_demo</span><br><span class="line">sonar.projectVersion=1.0</span><br><span class="line"># Path is relative to the sonar-project.properties file. Replace "\" by "/" on</span><br><span class="line">Windows.</span><br><span class="line"># This property is optional if sonar.modules is set.</span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.exclusions=**/test/**,**/target/**</span><br><span class="line">sonar.java.source=1.8</span><br><span class="line">sonar.java.target=1.8</span><br><span class="line"># Encoding of the source code. Default is default system encoding</span><br><span class="line">sonar.sourceEncoding=UTF-8</span><br></pre></td></tr></table></figure><p></p><h5 id="在项目添加SonaQube代码审查（流水线项目）"><a href="#在项目添加SonaQube代码审查（流水线项目）" class="headerlink" title="在项目添加SonaQube代码审查（流水线项目）"></a>在项目添加SonaQube代码审查（流水线项目）</h5><p>1）项目根目录下，创建sonar-project.properties文件<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8vimwa9xj207q05amxn.jpg" referrerpolicy="no-referrer"><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># must be unique in a given SonarQube instance</span><br><span class="line">sonar.projectKey=web_demo</span><br><span class="line"># this is the name and version displayed in the SonarQube UI. Was mandatory</span><br><span class="line">prior to SonarQube 6.1.</span><br><span class="line">sonar.projectName=web_demo</span><br><span class="line">sonar.projectVersion=1.0</span><br><span class="line"># Path is relative to the sonar-project.properties file. Replace "\" by "/" on</span><br><span class="line">Windows.</span><br><span class="line"># This property is optional if sonar.modules is set.</span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.exclusions=**/test/**,**/target/**</span><br><span class="line">sonar.java.source=1.8</span><br><span class="line">sonar.java.target=1.8</span><br><span class="line"># Encoding of the source code. Default is default system encoding</span><br><span class="line">sonar.sourceEncoding=UTF-8</span><br></pre></td></tr></table></figure><p></p><p>2）修改Jenkinsfile，加入SonarQube代码审查阶段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">	agent any</span><br><span class="line">	stages &#123;</span><br><span class="line">		stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/master&apos;]],doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &apos;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&apos;, url:&apos;git@192.168.66.100:itheima_group/web_demo.git&apos;]]])</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		stage(&apos;编译构建&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				sh label: &apos;&apos;, script: &apos;mvn clean package&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		stage(&apos;SonarQube代码审查&apos;) &#123;</span><br><span class="line">			steps&#123;</span><br><span class="line">				script &#123;</span><br><span class="line">					scannerHome = tool &apos;sonarqube-scanner&apos;</span><br><span class="line">					&#125;</span><br><span class="line">				withSonarQubeEnv(&apos;sonarqube6.7.4&apos;) &#123;</span><br><span class="line">					sh &quot;$&#123;scannerHome&#125;/bin/sonar-scanner&quot;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		stage(&apos;项目部署&apos;) &#123;</span><br><span class="line">			steps &#123;</span><br><span class="line">				deploy adapters: [tomcat8(credentialsId: &apos;afc43e5e-4a4e-4de6-984fb1d5a254e434&apos;, path: &apos;&apos;, url: &apos;http://192.168.66.102:8080&apos;)], contextPath: null,war: &apos;target/*.war&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		post &#123;</span><br><span class="line">			always &#123;</span><br><span class="line">				emailext(</span><br><span class="line">					subject: &apos;构建通知：$&#123;PROJECT_NAME&#125; - Build # $&#123;BUILD_NUMBER&#125; -$&#123;BUILD_STATUS&#125;!&apos;,body: &apos;$&#123;FILE,path=&quot;email.html&quot;&#125;&apos;,</span><br><span class="line">to: &apos;1014671449@qq.com&apos;)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p>3）到SonarQube的UI界面查看审查结果<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8yaeaz7cj20ks07fmy5.jpg" referrerpolicy="no-referrer"></p><h3 id="Jenkins-Docker-SpringCloud微服务持续集成-上"><a href="#Jenkins-Docker-SpringCloud微服务持续集成-上" class="headerlink" title="Jenkins+Docker+SpringCloud微服务持续集成(上)"></a>Jenkins+Docker+SpringCloud微服务持续集成(上)</h3><h4 id="Jenkins-Docker-SpringCloud持续集成流程说明"><a href="#Jenkins-Docker-SpringCloud持续集成流程说明" class="headerlink" title="Jenkins+Docker+SpringCloud持续集成流程说明"></a>Jenkins+Docker+SpringCloud持续集成流程说明</h4><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8yaedqtej20ke0bbq6j.jpg" referrerpolicy="no-referrer"><br>大致流程说明：<br>1）开发人员每天把代码提交到Gitlab代码仓库<br>2）Jenkins从Gitlab中拉取项目源码，编译并打成jar包，然后构建成Docker镜像，将镜像上传到<br>Harbor私有仓库。<br>3）Jenkins发送SSH远程命令，让生产部署服务器到Harbor私有仓库拉取镜像到本地，然后创建容器。<br>4）最后，用户可以访问到容器</p><p><strong>服务列表</strong></p><table><thead><tr><th>服务器名称</th><th>IP地址</th><th>安装的软件</th></tr></thead><tbody><tr><td>代码托管服务器</td><td>192.168.66.100</td><td>Gitlab</td></tr><tr><td>持续集成服务器</td><td>192.168.66.101</td><td>Jenkins，Maven，Docker18.06.1-ce</td></tr><tr><td>Docker仓库服务器</td><td>192.168.66.102</td><td>Docker18.06.1-ce，Harbor1.9.2</td></tr><tr><td>生成部署服务器</td><td>192.168.66.103</td><td>Docker18.06.1-ce</td></tr></tbody></table><h4 id="SpringCloud微服务源码概述"><a href="#SpringCloud微服务源码概述" class="headerlink" title="SpringCloud微服务源码概述"></a>SpringCloud微服务源码概述</h4><p>项目架构：前后端分离<br>后端技术栈：SpringBoot+SpringCloud+SpringDataJpa（Spring全家桶）<br>微服务项目结构：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8yae9qfzj20az069gmo.jpg" referrerpolicy="no-referrer"></p><ul><li>tensquare_parent：父工程，存放基础配置</li><li>tensquare_common：通用工程，存放工具类</li><li>tensquare_eureka_server：SpringCloud的Eureka注册中心</li><li>tensquare_zuul：SpringCloud的网关服务</li><li>tensquare_admin_service：基础权限认证中心，负责用户认证（使用JWT认证）</li><li>tensquare_gathering：一个简单的业务模块，活动微服务相关逻辑</li></ul><p>数据库结构：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8yl7zjb8j205l01et8q.jpg" referrerpolicy="no-referrer"></p><ul><li>tensquare_user：用户认证数据库，存放用户账户数据。对应tensquare_admin_service微服务</li><li><p>tensquare_gathering：活动微服务数据库。对应tensquare_gathering微服务<br>微服务配置分析：</p></li><li><p>tensquare_eureka</p></li><li>tensquare_zuul</li><li>tensquare_admin_service</li><li>tensquare_gathering</li></ul><h5 id="本地部署-1-SpringCloud微服务部署"><a href="#本地部署-1-SpringCloud微服务部署" class="headerlink" title="本地部署(1)-SpringCloud微服务部署"></a>本地部署(1)-SpringCloud微服务部署</h5><h6 id="本地运行微服务"><a href="#本地运行微服务" class="headerlink" title="本地运行微服务"></a>本地运行微服务</h6><p>1）逐一启动微服务<br>2）使用postman测试功能是否可用</p><h6 id="本地部署微服务"><a href="#本地部署微服务" class="headerlink" title="本地部署微服务"></a>本地部署微服务</h6><p>1）SpringBoot微服务项目打包<br>必须导入该插件<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>打包后在target下产生jar包<br>2）本地运行微服务的jar包</p><blockquote><p>java -jar xxx.jar</p></blockquote><p>3）查看效果</p><h5 id="本地部署-2-前端静态web网站"><a href="#本地部署-2-前端静态web网站" class="headerlink" title="本地部署(2)-前端静态web网站"></a>本地部署(2)-前端静态web网站</h5><p>前端技术栈：NodeJS+VueJS+ElementUI<br>使用Visual Studio Code打开源码<br>1）本地运行</p><blockquote><p>npm run dev</p></blockquote><p>2）打包静态web网站</p><blockquote><p>npm run build</p></blockquote><p>打包后，产生dist目录的静态文件<br>3）部署到nginx服务器<br>把dist目录的静态文件拷贝到nginx的html目录，启动nginx<br>4）启动nginx，并访问<br><a href="http://localhost:82" target="_blank" rel="noopener">http://localhost:82</a></p><h5 id="环境准备-1-Docker快速入门"><a href="#环境准备-1-Docker快速入门" class="headerlink" title="环境准备(1)-Docker快速入门"></a>环境准备(1)-Docker快速入门</h5><p>详细介绍：<a href="https://me.obey.fun/Docker%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5.html#more">https://me.obey.fun/Docker%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5.html#more</a></p><h6 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h6><p>Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。</p><p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p><p>容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</p><table><thead><tr><th></th><th>虚拟机</th><th>容器</th></tr></thead><tbody><tr><td>占用磁盘空间</td><td>非常大，GB级</td><td>小，MB甚至KB级</td></tr><tr><td>启动速度</td><td>慢，分钟级</td><td>快，秒级</td></tr><tr><td>运行形态</td><td>运行于Hypervisor上</td><td>直接运行在宿主机内核上</td></tr><tr><td>并发性</td><td>一台宿主机上十几个，最多几十个</td><td>上百个，甚至数百上千个</td></tr><tr><td>性能</td><td>逊于宿主机</td><td>接近宿主机本地进程</td></tr><tr><td>资源利用率</td><td>低</td><td>高</td></tr></tbody></table><p>简单一句话总结：Docker技术就是让我们更加高效轻松地将任何应用在Linux服务器部署和使用。</p><p>Docker安装<br>1）卸载旧版本</p><blockquote><p>yum list installed | grep docker 列出当前所有docker的包<br>yum -y remove docker的包名称 卸载docker包<br>rm -rf /var/lib/docker 删除docker的所有镜像和容器</p></blockquote><p>2）安装必要的软件包</p><blockquote><p>sudo yum install -y yum-utils \ device-mapper-persistent-data \ lvm2</p></blockquote><p>3）设置下载的镜像仓库</p><blockquote><p>sudo yum-config-manager \ –add-repo \ <a href="https://download.docker.com/linux/centos/dockerce.repo" target="_blank" rel="noopener">https://download.docker.com/linux/centos/dockerce.repo</a></p></blockquote><p>4）列出需要安装的版本列表</p><blockquote><p>yum list docker-ce –showduplicates | sort -r</p></blockquote><p>5）安装指定版本（这里使用18.0.1版本）</p><blockquote><p>sudo yum install docker-ce-18.06.1.ce</p></blockquote><p>6）查看版本</p><blockquote><p>docker -v</p></blockquote><p>7）启动Docker</p><blockquote><p>sudo systemctl start docker 启动<br>sudo systemctl enable docker 设置开机启动</p></blockquote><p>8）添加阿里云镜像下载地址</p><blockquote><p>vi /etc/docker/daemon.json</p></blockquote><p>内容如下：<br></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"registry-mirrors"</span>: [<span class="string">"https://zydiol88.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>9）重启Docker</p><blockquote><p>sudo systemctl restart docker</p></blockquote><h6 id="Docker基本命令快速入门"><a href="#Docker基本命令快速入门" class="headerlink" title="Docker基本命令快速入门"></a>Docker基本命令快速入门</h6><p>1）镜像命令<br>镜像：相当于应用的安装包，在Docker部署的任何应用都需要先构建成为镜像</p><blockquote><p>docker search 镜像名称 搜索镜像<br>docker pull 镜像名称 拉取镜像<br>docker images 查看本地所有镜像<br>docker rmi -f 镜像名称 删除镜像<br>docker pull openjdk:8-jdk-alpine</p></blockquote><p>2）容器命令<br>容器：容器是由镜像创建而来。容器是Docker运行应用的载体，每个应用都分别运行在Docker的每个容器中。</p><blockquote><p>docker run -i 镜像名称:标签 运行容器（默认是前台运行）<br>docker ps 查看运行的容器<br>docker ps -a 查询所有容器</p></blockquote><p>常用的参数：<br>-i：运行容器<br>-d：后台守方式运行（守护式）<br>–name：给容器添加名称<br>-p：公开容器端口给当前宿主机<br>-v：挂载目录</p><blockquote><p>docker exec -it 容器ID/容器名称 /bin/bash 进入容器内部<br>docker start/stop/restart 容器名称/ID 启动/停止/重启容器<br>docker rm -f 容器名称/ID 删除容器</p></blockquote><h5 id="环境准备-2-Dockerfile镜像脚本快速入门"><a href="#环境准备-2-Dockerfile镜像脚本快速入门" class="headerlink" title="环境准备(2)-Dockerfile镜像脚本快速入门"></a>环境准备(2)-Dockerfile镜像脚本快速入门</h5><h6 id="Dockerfile简介"><a href="#Dockerfile简介" class="headerlink" title="Dockerfile简介"></a>Dockerfile简介</h6><p>Dockerfile其实就是我们用来构建Docker镜像的源码，当然这不是所谓的编程源码，而是一些命令的组合，只要理解它的逻辑和语法格式，就可以编写Dockerfile了。</p><p>简单点说，Dockerfile的作用：它可以让用户个性化定制Docker镜像。因为工作环境中的需求各式各样，网络上的镜像很难满足实际的需求。</p><h6 id="Dockerfile常见命令"><a href="#Dockerfile常见命令" class="headerlink" title="Dockerfile常见命令"></a>Dockerfile常见命令</h6><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>FROM image_name:tag</td><td></td></tr><tr><td>MAINTAINER user_name</td><td>声明镜像的作者</td></tr><tr><td>ENV key value</td><td>设置环境变量 (可以写多条)</td></tr><tr><td>RUN command</td><td>编译镜像时运行的脚本(可以写多条)</td></tr><tr><td>CMD</td><td>设置容器的启动命令</td></tr><tr><td>ENTRYPOINT</td><td>设置容器的入口程序</td></tr><tr><td>ADD source_dir/file dest_dir/file</td><td>将宿主机的文件复制到容器内，如果是一个压缩文件，将会在复 制后自动解压</td></tr><tr><td>COPY source_dir/file dest_dir/file</td><td>和ADD相似，但是如果有压缩文件并不能解压</td></tr><tr><td>WORKDIR path_dir</td><td>设置工作目录</td></tr><tr><td>ARG</td><td>设置编译镜像时加入的参数</td></tr><tr><td>VOLUMN</td><td>设置容器的挂载卷</td></tr></tbody></table><ul><li>RUN、CMD、ENTRYPOINT的区别？</li></ul><p>RUN：用于指定 docker build 过程中要运行的命令，即是创建 Docker 镜像（image）的步骤</p><p>CMD：设置容器的启动命令， Dockerfile 中只能有一条 CMD 命令，如果写了多条则最后一条生效， CMD不支持接收docker run的参数。</p><p>ENTRYPOINT：入口程序是容器启动时执行的程序， docker run 中最后的命令将作为参数传递给入口 程序 ，ENTRYPOINY类似于 CMD 指令，但可以接收docker run的参数 。</p><p>以下是mysql官方镜像的Dockerfile示例：<br></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> oraclelinux:<span class="number">7</span>-slim</span><br><span class="line"><span class="keyword">ARG</span> MYSQL_SERVER_PACKAGE=mysql-community-server-minimal-<span class="number">5.7</span>.<span class="number">28</span></span><br><span class="line"><span class="keyword">ARG</span> MYSQL_SHELL_PACKAGE=mysql-<span class="keyword">shell</span>-8.0.18</span><br><span class="line"># Install server</span><br><span class="line">RUN yum install -y https://repo.mysql.com/mysql-community-minimal-releaseel7.rpm \</span><br><span class="line">https://repo.mysql.com/mysql-community-release-el7.rpm \</span><br><span class="line">&amp;&amp; yum-config-manager --enable mysql57-server-minimal \</span><br><span class="line">&amp;&amp; yum install -y \</span><br><span class="line">$MYSQL_SERVER_PACKAGE \</span><br><span class="line">$MYSQL_SHELL_PACKAGE \</span><br><span class="line">libpwquality \</span><br><span class="line">&amp;&amp; yum clean all \</span><br><span class="line">&amp;&amp; mkdir /docker-entrypoint-initdb.d</span><br><span class="line">VOLUME /var/lib/mysql</span><br><span class="line">COPY docker-entrypoint.sh /entrypoint.sh</span><br><span class="line">COPY healthcheck.sh /healthcheck.sh</span><br><span class="line">ENTRYPOINT ["/entrypoint.sh"]</span><br><span class="line">HEALTHCHECK CMD /healthcheck.sh</span><br><span class="line">EXPOSE 3306 33060</span><br><span class="line">CMD ["mysqld"]</span><br></pre></td></tr></table></figure><p></p><h6 id="使用Dockerfile制作微服务镜像"><a href="#使用Dockerfile制作微服务镜像" class="headerlink" title="使用Dockerfile制作微服务镜像"></a>使用Dockerfile制作微服务镜像</h6><p>我们利用Dockerfile制作一个Eureka注册中心的镜像<br>1）上传Eureka的微服务jar包到linux<br>2）编写Dockerfile<br></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk-alpine</span><br><span class="line"><span class="keyword">ARG</span> JAR_FILE</span><br><span class="line"><span class="keyword">COPY</span> $&#123;JAR_FILE&#125; app.jar</span><br><span class="line">EXPOSE 10086</span><br><span class="line">ENTRYPOINT ["java","-jar","/app.jar"]</span><br></pre></td></tr></table></figure><p></p><p>3）构建镜像</p><blockquote><p>docker build –build-arg JAR_FILE=tensquare_eureka_server-1.0-SNAPSHOT.jar -t eureka:v1 .</p></blockquote><p>4）查看镜像是否创建成功</p><blockquote><p>docker images</p></blockquote><p>5）创建容器</p><blockquote><p>docker run -i –name=eureka -p 10086:10086 eureka:v1</p></blockquote><p>6）访问容器<br><a href="http://192.168.66.101:10086" target="_blank" rel="noopener">http://192.168.66.101:10086</a></p><h5 id="环境准备-3-Harbor镜像仓库安装及使用"><a href="#环境准备-3-Harbor镜像仓库安装及使用" class="headerlink" title="环境准备(3)-Harbor镜像仓库安装及使用"></a>环境准备(3)-Harbor镜像仓库安装及使用</h5><h6 id="Harbor简介"><a href="#Harbor简介" class="headerlink" title="Harbor简介"></a>Harbor简介</h6><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8ze6fficj20g504gglz.jpg" referrerpolicy="no-referrer"></p><p>Harbor（港口，港湾）是一个用于存储和分发Docker镜像的企业级Registry服务器。<br>除了Harbor这个私有镜像仓库之外，还有Docker官方提供的Registry。相对Registry，Harbor具有很多优势：</p><ol><li>提供分层传输机制，优化网络传输 Docker镜像是是分层的，而如果每次传输都使用全量文件(所以用FTP的方式并不适合)，显然不经济。必须提供识别分层传输的机制，以层的UUID为标识，确定<br>传输的对象。</li><li>提供WEB界面，优化用户体验 只用镜像的名字来进行上传下载显然很不方便，需要有一个用户界面可以支持登陆、搜索功能，包括区分公有、私有镜像。</li><li>支持水平扩展集群 当有用户对镜像的上传下载操作集中在某服务器，需要对相应的访问压力作分解。</li><li>良好的安全机制 企业中的开发团队有很多不同的职位，对于不同的职位人员，分配不同的权限，具有更好的安全性。</li></ol><h6 id="Harbor安装"><a href="#Harbor安装" class="headerlink" title="Harbor安装"></a>Harbor安装</h6><p>Harbor需要安装在192.168.66.102上面<br>1）先安装Docker并启动Docker（已完成）<br>参考之前的安装过程<br>2）先安装docker-compose<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/dockercompose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose</span><br><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p></p><p>3）给docker-compose添加执行权限</p><blockquote><p>sudo chmod +x /usr/local/bin/docker-compose</p></blockquote><p>4）查看docker-compose是否安装成功</p><blockquote><p>docker-compose -version</p></blockquote><p>5）下载Harbor的压缩包（本课程版本为：v1.9.2）<br><a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener">https://github.com/goharbor/harbor/releases</a><br>6）上传压缩包到linux，并解压</p><blockquote><p>tar -xzf harbor-offline-installer-v1.9.2.tgz<br>mkdir /opt/harbor<br>mv harbor/* /opt/harbor<br>cd /opt/harbor</p></blockquote><p>7）修改Harbor的配置</p><blockquote><p>vi harbor.yml</p></blockquote><p>修改hostname和port</p><blockquote><p>hostname: 192.168.66.102<br>port: 85</p></blockquote><p>8）安装Harbor</p><blockquote><p>./prepare<br>./install.sh</p></blockquote><p>9）启动Harbor</p><blockquote><p>docker-compose up -d 启动<br>docker-compose stop 停止<br>docker-compose restart 重新启动</p></blockquote><p>10）访问Harbor<br><a href="http://192.168.66.102:85" target="_blank" rel="noopener">http://192.168.66.102:85</a><br>默认账户密码：admin/Harbor12345</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8ze6gfn0j20ko08ydh0.jpg" referrerpolicy="no-referrer"></p><p>在Harbor创建用户和项目<br>1）创建项目<br>Harbor的项目分为公开和私有的：<br>公开项目：所有用户都可以访问，通常存放公共的镜像，默认有一个library公开项目。<br>私有项目：只有授权用户才可以访问，通常存放项目本身的镜像。<br>我们可以为微服务项目创建一个新的项目：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go8ze6gcysj20ir06pdge.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go905sxsy0j20gx09kgmk.jpg" referrerpolicy="no-referrer"><br>2）创建用户<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go905t0gfrj20gj08274w.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go905swi33j20fd0claah.jpg" referrerpolicy="no-referrer"><br>创建的用户为： itcast/Itcast123<br>3）给私有项目分配用户<br>进入tensquare项目-&gt;成员<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go90f3ldjuj20l2062gm5.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go90f3iugaj20fm0a9q3d.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go90f3kbzlj20kl049mx8.jpg" referrerpolicy="no-referrer"></p><table><thead><tr><th>角色</th><th>权限说明</th></tr></thead><tbody><tr><td>访客</td><td>对于指定项目拥有只读权限</td></tr><tr><td>开发人员</td><td>对于指定项目拥有读写权限</td></tr><tr><td>维护人员</td><td>对于指定项目拥有读写权限，创建 Webhooks</td></tr><tr><td>项目管理员</td><td>除了读写权限，同时拥有用户管理/镜像扫描等管理权限</td></tr></tbody></table><p>4）以新用户登录Harbor<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go90wco67jj20ki06hdh5.jpg" referrerpolicy="no-referrer"></p><h6 id="把镜像上传到Harbor"><a href="#把镜像上传到Harbor" class="headerlink" title="把镜像上传到Harbor"></a>把镜像上传到Harbor</h6><p>1）给镜像打上标签</p><blockquote><p>docker tag eureka:v1 192.168.66.102:85/tensquare/eureka:v1</p></blockquote><p>2）推送镜像</p><blockquote><p>docker push 192.168.66.102:85/tensquare/eureka:v1</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The push refers to repository [192.168.66.102:85/tensquare/eureka]</span><br><span class="line">Get https://192.168.66.102:85/v2/: http: server gave HTTP response to HTTPS</span><br><span class="line">client</span><br></pre></td></tr></table></figure><p>这时会出现以上报错，是因为Docker没有把Harbor加入信任列表中<br>3）把Harbor地址加入到Docker信任列表</p><blockquote><p>vi /etc/docker/daemon.json</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"registry-mirrors"</span>: [<span class="string">"https://zydiol88.mirror.aliyuncs.com"</span>],</span><br><span class="line"><span class="attr">"insecure-registries"</span>: [<span class="string">"192.168.66.102:85"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要重启Docker<br>4）再次执行推送命令，会提示权限不足<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">denied: requested access to the resource is denied</span><br></pre></td></tr></table></figure><p></p><p>需要先登录Harbor，再推送镜像<br>5）登录Harbor</p><blockquote><p>docker login -u 用户名 -p 密码 192.168.66.102:85</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go90wcttlxj20k7061gma.jpg" referrerpolicy="no-referrer"></p><h6 id="从Harbor下载镜像"><a href="#从Harbor下载镜像" class="headerlink" title="从Harbor下载镜像"></a>从Harbor下载镜像</h6><p>需求：在192.168.66.103服务器完成从Harbor下载镜像<br>1）安装Docker，并启动Docker（已经完成）<br>2）修改Docker配置</p><blockquote><p>vi /etc/docker/daemon.json</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"registry-mirrors"</span>: [<span class="string">"https://zydiol88.mirror.aliyuncs.com"</span>],</span><br><span class="line"><span class="attr">"insecure-registries"</span>: [<span class="string">"192.168.66.102:85"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重启docker<br>3）先登录，再从Harbor下载镜像</p><blockquote><p>docker login -u 用户名 -p 密码 192.168.66.102:85<br>docker pull 192.168.66.102:85/tensquare/eureka:v1</p></blockquote><h4 id="微服务持续集成-1-项目代码上传到Gitlab"><a href="#微服务持续集成-1-项目代码上传到Gitlab" class="headerlink" title="微服务持续集成(1)-项目代码上传到Gitlab"></a>微服务持续集成(1)-项目代码上传到Gitlab</h4><p>在IDEA操作即可，参考之前的步骤。包括后台微服务和前端web网站代码<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go90wct6mdj20i206yjs8.jpg" referrerpolicy="no-referrer"></p><h4 id="微服务持续集成-2-从Gitlab拉取项目源码"><a href="#微服务持续集成-2-从Gitlab拉取项目源码" class="headerlink" title="微服务持续集成(2)-从Gitlab拉取项目源码"></a>微服务持续集成(2)-从Gitlab拉取项目源码</h4><p>1）创建Jenkinsfile文件<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go9145ow6sj208m063t9d.jpg" referrerpolicy="no-referrer"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//gitlab的凭证</span><br><span class="line">def git_auth = &quot;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&quot;</span><br><span class="line">node &#123;</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">		checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/$&#123;branch&#125;&apos;]],doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url:&apos;git@192.168.66.100:itheima_group/tensquare_back.git&apos;]]])</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure><p>2）拉取Jenkinsfile文件<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go9145w65yj20jb0cumye.jpg" referrerpolicy="no-referrer"></p><h4 id="微服务持续集成-3-提交到SonarQube代码审查"><a href="#微服务持续集成-3-提交到SonarQube代码审查" class="headerlink" title="微服务持续集成(3)-提交到SonarQube代码审查"></a>微服务持续集成(3)-提交到SonarQube代码审查</h4><p>1）创建项目，并设置参数<br>创建tensquare_back项目，添加两个参数<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go9145qvofj20kh0ghdj2.jpg" referrerpolicy="no-referrer"><br>2）每个项目的根目录下添加sonar-project.properties<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># must be unique in a given SonarQube instance</span><br><span class="line">sonar.projectKey=tensquare_zuul</span><br><span class="line"># this is the name and version displayed in the SonarQube UI. Was mandatory</span><br><span class="line">prior to SonarQube 6.1.</span><br><span class="line">sonar.projectName=tensquare_zuul</span><br><span class="line">sonar.projectVersion=1.0</span><br><span class="line"># Path is relative to the sonar-project.properties file. Replace &quot;\&quot; by &quot;/&quot; on</span><br><span class="line">Windows.</span><br><span class="line"># This property is optional if sonar.modules is set.</span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.exclusions=**/test/**,**/target/**</span><br><span class="line">sonar.java.binaries=.</span><br><span class="line">sonar.java.source=1.8</span><br><span class="line">sonar.java.target=1.8</span><br><span class="line">sonar.java.libraries=**/target/classes/**</span><br><span class="line"># Encoding of the source code. Default is default system encoding</span><br><span class="line">sonar.sourceEncoding=UTF-8</span><br></pre></td></tr></table></figure><p></p><p>注意：修改sonar.projectKey和sonar.projectName<br>3）修改Jenkinsfile构建脚本<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//gitlab的凭证</span><br><span class="line">def git_auth = &quot;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&quot;</span><br><span class="line">//构建版本的名称</span><br><span class="line">def tag = &quot;latest&quot;</span><br><span class="line">node &#123;</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">	checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/$&#123;branch&#125;&apos;]],</span><br><span class="line">	doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url:</span><br><span class="line">&apos;git@192.168.66.100:itheima_group/tensquare_back.git&apos;]]])</span><br><span class="line">		&#125;</span><br><span class="line">	stage(&apos;代码审查&apos;) &#123;</span><br><span class="line">		def scannerHome = tool &apos;sonarqube-scanner&apos;</span><br><span class="line">		withSonarQubeEnv(&apos;sonarqube6.7.4&apos;) &#123;</span><br><span class="line">		sh &quot;&quot;&quot;</span><br><span class="line">		cd $&#123;project_name&#125;</span><br><span class="line">		$&#123;scannerHome&#125;/bin/sonar-scanner</span><br><span class="line">		&quot;&quot;&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="微服务持续集成-4-使用Dockerfile编译、生成镜像"><a href="#微服务持续集成-4-使用Dockerfile编译、生成镜像" class="headerlink" title="微服务持续集成(4)-使用Dockerfile编译、生成镜像"></a>微服务持续集成(4)-使用Dockerfile编译、生成镜像</h4><p>利用dockerfile-maven-plugin插件构建Docker镜像<br>1）在每个微服务项目的pom.xml加入dockerfile-maven-plugin插件<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dockerfile-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">repository</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">buildArgs</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">JAR_FILE</span>&gt;</span>target/$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">JAR_FILE</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">buildArgs</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>2）在每个微服务项目根目录下建立Dockerfile文件<br></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#FROM java:8</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk-alpine</span><br><span class="line"><span class="keyword">ARG</span> JAR_FILE</span><br><span class="line"><span class="keyword">COPY</span> $&#123;JAR_FILE&#125; app.jar</span><br><span class="line">EXPOSE 10086</span><br><span class="line">ENTRYPOINT ["java","-jar","/app.jar"]</span><br></pre></td></tr></table></figure><p></p><p>注意：每个项目公开的端口不一样<br>3）修改Jenkinsfile构建脚本<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//gitlab的凭证</span><br><span class="line">def git_auth = &quot;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&quot;</span><br><span class="line">//构建版本的名称</span><br><span class="line">def tag = &quot;latest&quot;</span><br><span class="line">//Harbor私服地址</span><br><span class="line">def harbor_url = &quot;192.168.66.102:85/tensquare/&quot;</span><br><span class="line">node &#123;</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">		checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/$&#123;branch&#125;&apos;]],</span><br><span class="line">doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url:</span><br><span class="line">&apos;git@192.168.66.100:itheima_group/tensquare_back.git&apos;]]])</span><br><span class="line">				&#125;</span><br><span class="line">	stage(&apos;代码审查&apos;) &#123;</span><br><span class="line">		def scannerHome = tool &apos;sonarqube-scanner&apos;</span><br><span class="line">		withSonarQubeEnv(&apos;sonarqube6.7.4&apos;) &#123;</span><br><span class="line">		sh &quot;&quot;&quot;</span><br><span class="line">		cd $&#123;project_name&#125;</span><br><span class="line">		$&#123;scannerHome&#125;/bin/sonar-scanner</span><br><span class="line">		&quot;&quot;&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	stage(&apos;编译，构建镜像&apos;) &#123;</span><br><span class="line">		//定义镜像名称</span><br><span class="line">		def imageName = &quot;$&#123;project_name&#125;:$&#123;tag&#125;&quot;</span><br><span class="line">		//编译，安装公共工程</span><br><span class="line">		sh &quot;mvn -f tensquare_common clean install&quot;</span><br><span class="line">		//编译，构建本地镜像</span><br><span class="line">		sh &quot;mvn -f $&#123;project_name&#125; clean package dockerfile:build&quot;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p></p><p>注意：如果出现找不到父工程依赖，需要手动把父工程的依赖上传到仓库中</p><h4 id="微服务持续集成-5-上传到Harbor镜像仓库"><a href="#微服务持续集成-5-上传到Harbor镜像仓库" class="headerlink" title="微服务持续集成(5)-上传到Harbor镜像仓库"></a>微服务持续集成(5)-上传到Harbor镜像仓库</h4><p>1）修改Jenkinsfile构建脚本<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">//gitlab的凭证</span><br><span class="line">def git_auth = &quot;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&quot;</span><br><span class="line">//构建版本的名称</span><br><span class="line">def tag = &quot;latest&quot;</span><br><span class="line">//Harbor私服地址</span><br><span class="line">def harbor_url = &quot;192.168.66.102:85&quot;</span><br><span class="line">//Harbor的项目名称</span><br><span class="line">def harbor_project_name = &quot;tensquare&quot;</span><br><span class="line">//Harbor的凭证</span><br><span class="line">def harbor_auth = &quot;ef499f29-f138-44dd-975e-ff1ca1d8c933&quot;</span><br><span class="line">node &#123;</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">		checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/$&#123;branch&#125;&apos;]],</span><br><span class="line">doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url:</span><br><span class="line">&apos;git@192.168.66.100:itheima_group/tensquare_back.git&apos;]]])</span><br><span class="line">		&#125;</span><br><span class="line">	stage(&apos;代码审查&apos;) &#123;</span><br><span class="line">		def scannerHome = tool &apos;sonarqube-scanner&apos;</span><br><span class="line">		withSonarQubeEnv(&apos;sonarqube6.7.4&apos;) &#123;</span><br><span class="line">		sh &quot;&quot;&quot;</span><br><span class="line">		cd $&#123;project_name&#125;</span><br><span class="line">		$&#123;scannerHome&#125;/bin/sonar-scanner</span><br><span class="line">		&quot;&quot;&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	stage(&apos;编译，构建镜像&apos;) &#123;</span><br><span class="line">		//定义镜像名称</span><br><span class="line">		def imageName = &quot;$&#123;project_name&#125;:$&#123;tag&#125;&quot;</span><br><span class="line">		//编译，安装公共工程</span><br><span class="line">		sh &quot;mvn -f tensquare_common clean install&quot;</span><br><span class="line">		//编译，构建本地镜像</span><br><span class="line">		sh &quot;mvn -f $&#123;project_name&#125; clean package dockerfile:build&quot;</span><br><span class="line">		//给镜像打标签</span><br><span class="line">		sh &quot;docker tag $&#123;imageName&#125;</span><br><span class="line">		$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">		//登录Harbor，并上传镜像</span><br><span class="line">		withCredentials([usernamePassword(credentialsId: &quot;$&#123;harbor_auth&#125;&quot;,passwordVariable: &apos;password&apos;, usernameVariable: &apos;username&apos;)]) &#123;</span><br><span class="line">		//登录</span><br><span class="line">		sh &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125; $&#123;harbor_url&#125;&quot;</span><br><span class="line">		//上传镜像</span><br><span class="line">		sh &quot;docker push $&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">	&#125;</span><br><span class="line">		//删除本地镜像</span><br><span class="line">		sh &quot;docker rmi -f $&#123;imageName&#125;&quot;</span><br><span class="line">		sh &quot;docker rmi -f $&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p></p><p>2）使用凭证管理Harbor私服账户和密码<br>先在凭证建立Harbor的凭证，在生成凭证脚本代码<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go91vidga9j20kc0b7gng.jpg" referrerpolicy="no-referrer"></p><h4 id="微服务持续集成-6-拉取镜像和发布应用"><a href="#微服务持续集成-6-拉取镜像和发布应用" class="headerlink" title="微服务持续集成(6)-拉取镜像和发布应用"></a>微服务持续集成(6)-拉取镜像和发布应用</h4><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go91vic2hkj20cs0dwjtb.jpg" referrerpolicy="no-referrer"><br>注意：192.168.66.103服务已经安装Docker并启动</p><h5 id="安装-Publish-Over-SSH-插件"><a href="#安装-Publish-Over-SSH-插件" class="headerlink" title="安装 Publish Over SSH 插件"></a>安装 Publish Over SSH 插件</h5><p>安装以下插件，可以实现远程发送Shell命令<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go91viaixmj20am0363yp.jpg" referrerpolicy="no-referrer"></p><h5 id="配置远程部署服务器"><a href="#配置远程部署服务器" class="headerlink" title="配置远程部署服务器"></a>配置远程部署服务器</h5><p>1）拷贝公钥到远程服务器</p><blockquote><p>ssh-copy-id 192.168.66.103</p></blockquote><p>2）系统配置-&gt;添加远程服务器</p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go926og1ufj20k70c4q45.jpg" referrerpolicy="no-referrer"></p><h5 id="修改Jenkinsfile构建脚本"><a href="#修改Jenkinsfile构建脚本" class="headerlink" title="修改Jenkinsfile构建脚本"></a>修改Jenkinsfile构建脚本</h5><p>生成远程调用模板代码<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go926ofdumj20fk082ab5.jpg" referrerpolicy="no-referrer"><br>添加一个port参数<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go926oej7sj209i069jrs.jpg" referrerpolicy="no-referrer"><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">//gitlab的凭证</span><br><span class="line">def git_auth = &quot;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&quot;</span><br><span class="line">//构建版本的名称</span><br><span class="line">def tag = &quot;latest&quot;</span><br><span class="line">//Harbor私服地址</span><br><span class="line">def harbor_url = &quot;192.168.66.102:85&quot;</span><br><span class="line">//Harbor的项目名称</span><br><span class="line">def harbor_project_name = &quot;tensquare&quot;</span><br><span class="line">//Harbor的凭证</span><br><span class="line">def harbor_auth = &quot;ef499f29-f138-44dd-975e-ff1ca1d8c933&quot;</span><br><span class="line">node &#123;</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">		checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/$&#123;branch&#125;&apos;]],</span><br><span class="line">doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url:</span><br><span class="line">&apos;git@192.168.66.100:itheima_group/tensquare_back.git&apos;]]])</span><br><span class="line">			&#125;</span><br><span class="line">	stage(&apos;代码审查&apos;) &#123;</span><br><span class="line">		def scannerHome = tool &apos;sonarqube-scanner&apos;</span><br><span class="line">		withSonarQubeEnv(&apos;sonarqube6.7.4&apos;) &#123;</span><br><span class="line">		sh &quot;&quot;&quot;</span><br><span class="line">		cd $&#123;project_name&#125;</span><br><span class="line">		$&#123;scannerHome&#125;/bin/sonar-scanner</span><br><span class="line">		&quot;&quot;&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	stage(&apos;编译，构建镜像，部署服务&apos;) &#123;</span><br><span class="line">		//定义镜像名称</span><br><span class="line">		def imageName = &quot;$&#123;project_name&#125;:$&#123;tag&#125;&quot;</span><br><span class="line">		//编译并安装公共工程</span><br><span class="line">		sh &quot;mvn -f tensquare_common clean install&quot;</span><br><span class="line">		//编译，构建本地镜像</span><br><span class="line">		sh &quot;mvn -f $&#123;project_name&#125; clean package dockerfile:build&quot;</span><br><span class="line">		//给镜像打标签</span><br><span class="line">		sh &quot;docker tag $&#123;imageName&#125;</span><br><span class="line">		$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">		//登录Harbor，并上传镜像</span><br><span class="line">		withCredentials([usernamePassword(credentialsId: &quot;$&#123;harbor_auth&#125;&quot;,passwordVariable: &apos;password&apos;, usernameVariable: &apos;username&apos;)]) &#123;</span><br><span class="line">		//登录</span><br><span class="line">		sh &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125; $&#123;harbor_url&#125;&quot;</span><br><span class="line">		//上传镜像</span><br><span class="line">		sh &quot;docker push $&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">		&#125;</span><br><span class="line">		//删除本地镜像</span><br><span class="line">		sh &quot;docker rmi -f $&#123;imageName&#125;&quot;</span><br><span class="line">		sh &quot;docker rmi -f $&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">		//=====以下为远程调用进行项目部署========</span><br><span class="line">		sshPublisher(publishers: [sshPublisherDesc(configName: &apos;master_server&apos;,transfers: [sshTransfer(cleanRemote: false, excludes: &apos;&apos;, execCommand:&quot;/opt/jenkins_shell/deploy.sh $harbor_url $harbor_project_name $project_name $tag $port&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false,noDefaultExcludes: false, patternSeparator: &apos;[, ]+&apos;, remoteDirectory: &apos;&apos;,</span><br><span class="line">		remoteDirectorySDF: false, removePrefix: &apos;&apos;, sourceFiles: &apos;&apos;)],</span><br><span class="line">		usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p></p><h5 id="编写deploy-sh部署脚本"><a href="#编写deploy-sh部署脚本" class="headerlink" title="编写deploy.sh部署脚本"></a>编写deploy.sh部署脚本</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>! /bin/sh</span><br><span class="line"><span class="meta">#</span>接收外部参数</span><br><span class="line">harbor_url=$1</span><br><span class="line">harbor_project_name=$2</span><br><span class="line">project_name=$3</span><br><span class="line">tag=$4</span><br><span class="line">port=$5</span><br><span class="line">imageName=$harbor_url/$harbor_project_name/$project_name:$tag</span><br><span class="line">echo "$imageName"</span><br><span class="line"><span class="meta">#</span>查询容器是否存在，存在则删除</span><br><span class="line">containerId=`docker ps -a | grep -w $&#123;project_name&#125;:$&#123;tag&#125; | awk '&#123;print $1&#125;'`</span><br><span class="line">if [ "$containerId" != "" ] ; then</span><br><span class="line"><span class="meta">#</span>停掉容器</span><br><span class="line">docker stop $containerId</span><br><span class="line"><span class="meta">#</span>删除容器</span><br><span class="line">docker rm $containerId</span><br><span class="line">echo "成功删除容器"</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span>查询镜像是否存在，存在则删除</span><br><span class="line">imageId=`docker images | grep -w $project_name | awk '&#123;print $3&#125;'`</span><br><span class="line">if [ "$imageId" != "" ] ; then</span><br><span class="line"><span class="meta">#</span>删除镜像</span><br><span class="line">docker rmi -f $imageId</span><br><span class="line">echo "成功删除镜像"</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span> 登录Harbor私服</span><br><span class="line">docker login -u itcast -p Itcast123 $harbor_url</span><br><span class="line"><span class="meta">#</span> 下载镜像</span><br><span class="line">docker pull $imageName</span><br><span class="line"><span class="meta">#</span> 启动容器</span><br><span class="line">docker run -di -p $port:$port $imageName</span><br><span class="line">echo "容器启动成功"</span><br></pre></td></tr></table></figure><p>上传deploy.sh文件到/opt/jenkins_shell目录下，且文件至少有执行权限！</p><blockquote><p>chmod +x deploy.sh 添加执行权限</p></blockquote><p>导入数据，测试微服务</p><h4 id="微服务持续集成-7-部署前端静态web网站"><a href="#微服务持续集成-7-部署前端静态web网站" class="headerlink" title="微服务持续集成(7)-部署前端静态web网站"></a>微服务持续集成(7)-部署前端静态web网站</h4><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go92g8tu0hj20id06jq4a.jpg" referrerpolicy="no-referrer"></p><h5 id="安装Nginx服务器"><a href="#安装Nginx服务器" class="headerlink" title="安装Nginx服务器"></a>安装Nginx服务器</h5><blockquote><p>yum install epel-release<br>yum -y install nginx 安装</p></blockquote><p>修改nginx的端口，默认80，改为9090：</p><blockquote><p>vi /etc/nginx/nginx.conf</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 9090 default_server;</span><br><span class="line">	listen [::]:9090 default_server;</span><br><span class="line">	server_name _;</span><br><span class="line">	root /usr/share/nginx/html;</span><br></pre></td></tr></table></figure><p>还需要关闭selinux，将SELINUX=disabled</p><blockquote><p>setenforce 0 先临时关闭<br>vi /etc/selinux/config 编辑文件，永久关闭 SELINUX=disabled</p></blockquote><p>启动Nginx</p><blockquote><p>systemctl enable nginx 设置开机启动<br>systemctl start nginx 启动<br>systemctl stop nginx 停止<br>systemctl restart nginx 重启</p></blockquote><p>访问：<a href="http://192.168.66.103:9090/" target="_blank" rel="noopener">http://192.168.66.103:9090/</a><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go92g8ykn5j20h908itc3.jpg" referrerpolicy="no-referrer"></p><h5 id="安装NodeJS插件"><a href="#安装NodeJS插件" class="headerlink" title="安装NodeJS插件"></a>安装NodeJS插件</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go92g8sjnaj20ct04m3z2.jpg" referrerpolicy="no-referrer"></p><h5 id="Jenkins配置Nginx服务器"><a href="#Jenkins配置Nginx服务器" class="headerlink" title="Jenkins配置Nginx服务器"></a>Jenkins配置Nginx服务器</h5><p>Manage Jenkins-&gt;Global Tool Configuration<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go93c0pruuj20jm0acjsv.jpg" referrerpolicy="no-referrer"></p><h5 id="创建前端流水线项目"><a href="#创建前端流水线项目" class="headerlink" title="创建前端流水线项目"></a>创建前端流水线项目</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go93c0oet7j209l0ajgn6.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go93c0p9byj20ee08vabc.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go93hfo0mdj20i00a83zf.jpg" referrerpolicy="no-referrer"></p><h5 id="建立Jenkinsfile构建脚本"><a href="#建立Jenkinsfile构建脚本" class="headerlink" title="建立Jenkinsfile构建脚本"></a>建立Jenkinsfile构建脚本</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//gitlab的凭证</span><br><span class="line">def git_auth = &quot;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&quot;</span><br><span class="line">node &#123;</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">		checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/$&#123;branch&#125;&apos;]],</span><br><span class="line">doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url:</span><br><span class="line">&apos;git@192.168.66.100:itheima_group/tensquare_front.git&apos;]]])</span><br><span class="line">				&#125;</span><br><span class="line">	stage(&apos;打包，部署网站&apos;) &#123;</span><br><span class="line">		//使用NodeJS的npm进行打包</span><br><span class="line">		nodejs(&apos;nodejs12&apos;)&#123;</span><br><span class="line">			sh &apos;&apos;&apos;</span><br><span class="line">			npm install</span><br><span class="line">			npm run build</span><br><span class="line">			&apos;&apos;&apos;</span><br><span class="line">		&#125;</span><br><span class="line">		//=====以下为远程调用进行项目部署========</span><br><span class="line">		sshPublisher(publishers: [sshPublisherDesc(configName: &apos;master_server&apos;,transfers: [sshTransfer(cleanRemote: false, excludes: &apos;&apos;, execCommand: &apos;&apos;,execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes:false, patternSeparator: &apos;[, ]+&apos;, remoteDirectory: &apos;/usr/share/nginx/html&apos;,remoteDirectorySDF: false, removePrefix: &apos;dist&apos;, sourceFiles: &apos;dist/**&apos;)],</span><br><span class="line">usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完成后，访问：<a href="http://192.168.66.103:9090" target="_blank" rel="noopener">http://192.168.66.103:9090</a> 进行测试。</p><h4 id="5、Jenkins-Docker-SpringCloud微服务持续集成-下"><a href="#5、Jenkins-Docker-SpringCloud微服务持续集成-下" class="headerlink" title="5、Jenkins+Docker+SpringCloud微服务持续集成(下)"></a>5、Jenkins+Docker+SpringCloud微服务持续集成(下)</h4><h5 id="Jenkins-Docker-SpringCloud部署方案优化"><a href="#Jenkins-Docker-SpringCloud部署方案优化" class="headerlink" title="Jenkins+Docker+SpringCloud部署方案优化"></a>Jenkins+Docker+SpringCloud部署方案优化</h5><p>上面部署方案存在的问题：<br>1）一次只能选择一个微服务部署<br>2）只有一台生产者部署服务器<br>3）每个微服务只有一个实例，容错率低</p><p>优化方案：<br>1）在一个Jenkins工程中可以选择多个微服务同时发布<br>2）在一个Jenkins工程中可以选择多台生产服务器同时部署<br>3）每个微服务都是以集群高可用形式部署</p><h5 id="Jenkins-Docker-SpringCloud集群部署流程说明"><a href="#Jenkins-Docker-SpringCloud集群部署流程说明" class="headerlink" title="Jenkins+Docker+SpringCloud集群部署流程说明"></a>Jenkins+Docker+SpringCloud集群部署流程说明</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go93hg6ixoj20k40amjud.jpg" referrerpolicy="no-referrer"></p><h5 id="修改所有微服务配置"><a href="#修改所有微服务配置" class="headerlink" title="修改所有微服务配置"></a>修改所有微服务配置</h5><h6 id="注册中心配置"><a href="#注册中心配置" class="headerlink" title="注册中心配置(*)"></a>注册中心配置(*)</h6><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 集群版</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">application:</span></span><br><span class="line">		<span class="attr">name:</span> <span class="string">EUREKA-HA</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="attr">port:</span> <span class="number">10086</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="comment"># 指定profile=eureka-server1</span></span><br><span class="line">	<span class="attr">profiles:</span> <span class="string">eureka-server1</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">	<span class="attr">instance:</span></span><br><span class="line">	<span class="comment"># 指定当profile=eureka-server1时，主机名是eureka-server1</span></span><br><span class="line">	  <span class="attr">hostname:</span> <span class="number">192.168</span><span class="number">.66</span><span class="number">.103</span></span><br><span class="line">	<span class="attr">client:</span></span><br><span class="line">	<span class="attr">service-url:</span></span><br><span class="line">	<span class="comment"># 将自己注册到eureka-server1、eureka-server2这个Eureka上面去</span></span><br><span class="line">	  <span class="attr">defaultZone:</span></span><br><span class="line">		<span class="attr">http://192.168.66.103:10086/eureka/,http://192.168.66.104:10086/eureka/</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="attr">port:</span> <span class="number">10086</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">profiles:</span> <span class="string">eureka-server2</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">	<span class="attr">instance:</span></span><br><span class="line">	  <span class="attr">hostname:</span> <span class="number">192.168</span><span class="number">.66</span><span class="number">.104</span></span><br><span class="line">	<span class="attr">client:</span></span><br><span class="line">	  <span class="attr">service-url:</span></span><br><span class="line">	    <span class="attr">defaultZone:</span></span><br><span class="line">		<span class="attr">http://192.168.66.103:10086/eureka/,http://192.168.66.104:10086/eureka/</span></span><br></pre></td></tr></table></figure><p>在启动微服务的时候，加入参数: spring.profiles.active 来读取对应的配置</p><h6 id="其他微服务配置"><a href="#其他微服务配置" class="headerlink" title="其他微服务配置"></a>其他微服务配置</h6><p>除了Eureka注册中心以外，其他微服务配置都需要加入所有Eureka服务<br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Eureka配置</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">	<span class="attr">client:</span></span><br><span class="line">		<span class="attr">service-url:</span></span><br><span class="line">			<span class="attr">defaultZone:</span></span><br><span class="line">				<span class="attr">http://192.168.66.103:10086/eureka,http://192.168.66.104:10086/eureka</span> <span class="comment"># Eureka访问地址</span></span><br><span class="line"><span class="attr">instance:</span></span><br><span class="line">	<span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p></p><p>把代码提交到Gitlab中</p><h5 id="设计Jenkins集群项目的构建参数"><a href="#设计Jenkins集群项目的构建参数" class="headerlink" title="设计Jenkins集群项目的构建参数"></a>设计Jenkins集群项目的构建参数</h5><p>1）安装Extended Choice Parameter插件<br>支持多选框<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go93hfo613j20b00390sx.jpg" referrerpolicy="no-referrer"><br>2）创建流水线项目<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go953avvi1j20d30ab76j.jpg" referrerpolicy="no-referrer"><br>3）添加参数<br>字符串参数：分支名称<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go953auxwgj209x06ujrq.jpg" referrerpolicy="no-referrer"><br>多选框：项目名称<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go953aua45j20as07qwf6.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go9551tmyjj20k6062dgc.jpg" referrerpolicy="no-referrer"><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tensquare_eureka_server@10086,tensquare_zuul@10020,tensquare_admin_service@9001,</span><br><span class="line">tensquare_gathering@9002</span><br></pre></td></tr></table></figure><p></p><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go9551v0iyj20dq050q39.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go9551v98cj20fw0413z6.jpg" referrerpolicy="no-referrer"><br>最后效果：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go957ui22kj20bl09qt9o.jpg" referrerpolicy="no-referrer"></p><h5 id="完成微服务构建镜像，上传私服"><a href="#完成微服务构建镜像，上传私服" class="headerlink" title="完成微服务构建镜像，上传私服"></a>完成微服务构建镜像，上传私服</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">//gitlab的凭证</span><br><span class="line">def git_auth = &quot;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&quot;</span><br><span class="line">//构建版本的名称</span><br><span class="line">def tag = &quot;latest&quot;</span><br><span class="line">//Harbor私服地址</span><br><span class="line">def harbor_url = &quot;192.168.66.102:85&quot;</span><br><span class="line">//Harbor的项目名称</span><br><span class="line">def harbor_project_name = &quot;tensquare&quot;</span><br><span class="line">//Harbor的凭证</span><br><span class="line">def harbor_auth = &quot;ef499f29-f138-44dd-975e-ff1ca1d8c933&quot;</span><br><span class="line">node &#123;</span><br><span class="line">	//把选择的项目信息转为数组</span><br><span class="line">	def selectedProjects = &quot;$&#123;project_name&#125;&quot;.split(&apos;,&apos;)</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">	checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/$&#123;branch&#125;&apos;]],</span><br><span class="line">doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &apos;$&#123;git_auth&#125;&apos;, url:</span><br><span class="line">&apos;git@192.168.66.100:itheima_group/tensquare_back_cluster.git&apos;]]])</span><br><span class="line">				&#125;</span><br><span class="line">	stage(&apos;代码审查&apos;) &#123;</span><br><span class="line">		def scannerHome = tool &apos;sonarqube-scanner&apos;</span><br><span class="line">		withSonarQubeEnv(&apos;sonarqube6.7.4&apos;) &#123;</span><br><span class="line">			for(int i=0;i&lt;selectedProjects.size();i++)&#123;</span><br><span class="line">			//取出每个项目的名称和端口</span><br><span class="line">			def currentProject = selectedProjects[i];</span><br><span class="line">			//项目名称</span><br><span class="line">			def currentProjectName = currentProject.split(&apos;@&apos;)[0]</span><br><span class="line">			//项目启动端口</span><br><span class="line">			def currentProjectPort = currentProject.split(&apos;@&apos;)[1]</span><br><span class="line">			sh &quot;&quot;&quot;</span><br><span class="line">			cd $&#123;currentProjectName&#125;</span><br><span class="line">			$&#123;scannerHome&#125;/bin/sonar-scanner</span><br><span class="line">			&quot;&quot;&quot;</span><br><span class="line">			echo &quot;$&#123;currentProjectName&#125;完成代码审查&quot;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	stage(&apos;编译，构建镜像，部署服务&apos;) &#123;</span><br><span class="line">		//编译并安装公共工程</span><br><span class="line">		sh &quot;mvn -f tensquare_common clean install&quot;</span><br><span class="line">		for(int i=0;i&lt;selectedProjects.size();i++)&#123;</span><br><span class="line">			//取出每个项目的名称和端口</span><br><span class="line">			def currentProject = selectedProjects[i];</span><br><span class="line">			//项目名称</span><br><span class="line">			def currentProjectName = currentProject.split(&apos;@&apos;)[0]</span><br><span class="line">			//项目启动端口</span><br><span class="line">			def currentProjectPort = currentProject.split(&apos;@&apos;)[1]</span><br><span class="line">			//定义镜像名称</span><br><span class="line">			def imageName = &quot;$&#123;currentProjectName&#125;:$&#123;tag&#125;&quot;</span><br><span class="line">			//编译，构建本地镜像</span><br><span class="line">			sh &quot;mvn -f $&#123;currentProjectName&#125; clean package</span><br><span class="line">			dockerfile:build&quot;</span><br><span class="line">			//给镜像打标签</span><br><span class="line">			sh &quot;docker tag $&#123;imageName&#125;</span><br><span class="line">			$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">			//登录Harbor，并上传镜像</span><br><span class="line">			withCredentials([usernamePassword(credentialsId:</span><br><span class="line">			&quot;$&#123;harbor_auth&#125;&quot;, passwordVariable: &apos;password&apos;, usernameVariable: &apos;username&apos;)])</span><br><span class="line">			&#123;</span><br><span class="line">				//登录</span><br><span class="line">				sh &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125;</span><br><span class="line">				$&#123;harbor_url&#125;&quot;</span><br><span class="line">				//上传镜像</span><br><span class="line">				sh &quot;docker push</span><br><span class="line">				$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		//删除本地镜像</span><br><span class="line">		sh &quot;docker rmi -f $&#123;imageName&#125;&quot;</span><br><span class="line">		sh &quot;docker rmi -f</span><br><span class="line">		$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">		//=====以下为远程调用进行项目部署========</span><br><span class="line">		//sshPublisher(publishers: [sshPublisherDesc(configName:</span><br><span class="line">&apos;master_server&apos;, transfers: [sshTransfer(cleanRemote: false, excludes: &apos;&apos;,execCommand: &quot;/opt/jenkins_shell/deployCluster.sh $harbor_url</span><br><span class="line">$harbor_project_name $currentProjectName $tag $currentProjectPort&quot;, execTimeout:120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false,patternSeparator: &apos;[, ]+&apos;, remoteDirectory: &apos;&apos;, remoteDirectorySDF: false,removePrefix: &apos;&apos;, sourceFiles: &apos;&apos;)], usePromotionTimestamp: false,useWorkspaceInPromotion: false, verbose: false)])echo &quot;$&#123;currentProjectName&#125;完成编译，构建镜像&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="完成微服务多服务器远程发布"><a href="#完成微服务多服务器远程发布" class="headerlink" title="完成微服务多服务器远程发布"></a>完成微服务多服务器远程发布</h5><p>1）配置远程部署服务器</p><ul><li><p>拷贝公钥到远程服务器</p><blockquote><p>ssh-copy-id 192.168.66.104</p></blockquote></li><li><p>系统配置-&gt;添加远程服务器<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go957uj1cij20do08jwfh.jpg" referrerpolicy="no-referrer"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"registry-mirrors"</span>: [<span class="string">"https://zydiol88.mirror.aliyuncs.com"</span>],</span><br><span class="line"><span class="attr">"insecure-registries"</span>: [<span class="string">"192.168.66.102:85"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>重启Docker<br>3）添加参数<br>多选框：部署服务器<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go957uk0csj20db0dbjsm.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go95husnwmj20cq08mjsc.jpg" referrerpolicy="no-referrer"><br>最终效果：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go95hut5jqj20bz08owfa.jpg" referrerpolicy="no-referrer"><br>4）修改Jenkinsfile构建脚本<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">//gitlab的凭证</span><br><span class="line">def git_auth = &quot;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&quot;</span><br><span class="line">//构建版本的名称</span><br><span class="line">def tag = &quot;latest&quot;</span><br><span class="line">//Harbor私服地址</span><br><span class="line">def harbor_url = &quot;192.168.66.102:85&quot;</span><br><span class="line">//Harbor的项目名称</span><br><span class="line">def harbor_project_name = &quot;tensquare&quot;</span><br><span class="line">//Harbor的凭证</span><br><span class="line">def harbor_auth = &quot;ef499f29-f138-44dd-975e-ff1ca1d8c933&quot;</span><br><span class="line">node &#123;</span><br><span class="line">	//把选择的项目信息转为数组</span><br><span class="line">	def selectedProjects = &quot;$&#123;project_name&#125;&quot;.split(&apos;,&apos;)</span><br><span class="line">	//把选择的服务区信息转为数组</span><br><span class="line">	def selectedServers = &quot;$&#123;publish_server&#125;&quot;.split(&apos;,&apos;)</span><br><span class="line">	stage(&apos;拉取代码&apos;) &#123;</span><br><span class="line">	checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/$&#123;branch&#125;&apos;]],</span><br><span class="line">	doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &apos;$&#123;git_auth&#125;&apos;, url:</span><br><span class="line">&apos;git@192.168.66.100:itheima_group/tensquare_back_cluster.git&apos;]]])</span><br><span class="line">		&#125;</span><br><span class="line">	stage(&apos;代码审查&apos;) &#123;</span><br><span class="line">		def scannerHome = tool &apos;sonarqube-scanner&apos;</span><br><span class="line">		withSonarQubeEnv(&apos;sonarqube6.7.4&apos;) &#123;</span><br><span class="line">			for(int i=0;i&lt;selectedProjects.size();i++)&#123;</span><br><span class="line">				//取出每个项目的名称和端口</span><br><span class="line">				def currentProject = selectedProjects[i];</span><br><span class="line">				//项目名称</span><br><span class="line">				def currentProjectName = currentProject.split(&apos;@&apos;)[0]</span><br><span class="line">				//项目启动端口</span><br><span class="line">				def currentProjectPort = currentProject.split(&apos;@&apos;)[1]</span><br><span class="line">				sh &quot;&quot;&quot;</span><br><span class="line">				cd $&#123;currentProjectName&#125;</span><br><span class="line">				$&#123;scannerHome&#125;/bin/sonar-scanner</span><br><span class="line">				&quot;&quot;&quot;</span><br><span class="line">				echo &quot;$&#123;currentProjectName&#125;完成代码审查&quot;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">	stage(&apos;编译，构建镜像，部署服务&apos;) &#123;</span><br><span class="line">		//编译并安装公共工程</span><br><span class="line">		sh &quot;mvn -f tensquare_common clean install&quot;</span><br><span class="line">			for(int i=0;i&lt;selectedProjects.size();i++)&#123;</span><br><span class="line">				//取出每个项目的名称和端口</span><br><span class="line">				def currentProject = selectedProjects[i];</span><br><span class="line">				//项目名称</span><br><span class="line">				def currentProjectName = currentProject.split(&apos;@&apos;)[0]</span><br><span class="line">				//项目启动端口</span><br><span class="line">				def currentProjectPort = currentProject.split(&apos;@&apos;)[1]</span><br><span class="line">				//定义镜像名称</span><br><span class="line">				def imageName = &quot;$&#123;currentProjectName&#125;:$&#123;tag&#125;&quot;</span><br><span class="line">				//编译，构建本地镜像</span><br><span class="line">				sh &quot;mvn -f $&#123;currentProjectName&#125; clean package</span><br><span class="line">				dockerfile:build&quot;</span><br><span class="line">				//给镜像打标签</span><br><span class="line">				sh &quot;docker tag $&#123;imageName&#125;</span><br><span class="line">				$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">				//登录Harbor，并上传镜像</span><br><span class="line">				withCredentials([usernamePassword(credentialsId:</span><br><span class="line">&quot;$&#123;harbor_auth&#125;&quot;, passwordVariable: &apos;password&apos;, usernameVariable: &apos;username&apos;)])</span><br><span class="line">			&#123;</span><br><span class="line">				//登录</span><br><span class="line">				sh &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125;</span><br><span class="line">				$&#123;harbor_url&#125;&quot;</span><br><span class="line">				//上传镜像</span><br><span class="line">				sh &quot;docker push</span><br><span class="line">				$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		//删除本地镜像</span><br><span class="line">		sh &quot;docker rmi -f $&#123;imageName&#125;&quot;</span><br><span class="line">		sh &quot;docker rmi -f</span><br><span class="line">		$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">		//=====以下为远程调用进行项目部署========</span><br><span class="line">		for(int j=0;j&lt;selectedServers.size();j++)&#123;</span><br><span class="line">			//每个服务名称</span><br><span class="line">			def currentServer = selectedServers[j]</span><br><span class="line">			//添加微服务运行时的参数：spring.profiles.active</span><br><span class="line">			def activeProfile = &quot;--spring.profiles.active=&quot;</span><br><span class="line">			if(currentServer==&quot;master_server&quot;)&#123;</span><br><span class="line">				activeProfile = activeProfile+&quot;eureka-server1&quot;</span><br><span class="line">			&#125;else if(currentServer==&quot;slave_server1&quot;)&#123;</span><br><span class="line">				activeProfile = activeProfile+&quot;eureka-server2&quot;</span><br><span class="line">			&#125;</span><br><span class="line">			sshPublisher(publishers: [sshPublisherDesc(configName:</span><br><span class="line">&quot;$&#123;currentServer&#125;&quot;, transfers: [sshTransfer(cleanRemote: false, excludes: &apos;&apos;,execCommand: &quot;/opt/jenkins_shell/deployCluster.sh $harbor_url$harbor_project_name $currentProjectName $tag $currentProjectPort$activeProfile&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false,noDefaultExcludes: false, patternSeparator: &apos;[, ]+&apos;, remoteDirectory: &apos;&apos;,remoteDirectorySDF: false, removePrefix: &apos;&apos;, sourceFiles: &apos;&apos;)],usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span><br><span class="line">			&#125;</span><br><span class="line">			echo &quot;$&#123;currentProjectName&#125;完成编译，构建镜像&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>5）编写deployCluster.sh部署脚本<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>! /bin/sh</span><br><span class="line"><span class="meta">#</span>接收外部参数</span><br><span class="line">harbor_url=$1</span><br><span class="line">harbor_project_name=$2</span><br><span class="line">project_name=$3</span><br><span class="line">tag=$4</span><br><span class="line">port=$5</span><br><span class="line">profile=$6</span><br><span class="line">imageName=$harbor_url/$harbor_project_name/$project_name:$tag</span><br><span class="line">echo "$imageName"</span><br><span class="line"><span class="meta">#</span>查询容器是否存在，存在则删除</span><br><span class="line">containerId=`docker ps -a | grep -w $&#123;project_name&#125;:$&#123;tag&#125; | awk '&#123;print $1&#125;'`</span><br><span class="line">if [ "$containerId" != "" ] ; then</span><br><span class="line"><span class="meta">#</span>停掉容器</span><br><span class="line">docker stop $containerId</span><br><span class="line"><span class="meta">#</span>删除容器</span><br><span class="line">docker rm $containerId</span><br><span class="line">echo "成功删除容器"</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span>查询镜像是否存在，存在则删除</span><br><span class="line">imageId=`docker images | grep -w $project_name | awk '&#123;print $3&#125;'`</span><br><span class="line">if [ "$imageId" != "" ] ; then</span><br><span class="line"><span class="meta">#</span>删除镜像</span><br><span class="line">docker rmi -f $imageId</span><br><span class="line">echo "成功删除镜像"</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span> 登录Harbor私服</span><br><span class="line">docker login -u itcast -p Itcast123 $harbor_url</span><br><span class="line"><span class="meta">#</span> 下载镜像</span><br><span class="line">docker pull $imageName</span><br><span class="line"><span class="meta">#</span> 启动容器</span><br><span class="line">docker run -di -p $port:$port $imageName $profile</span><br><span class="line">echo "容器启动成功"</span><br></pre></td></tr></table></figure><p></p><p>6）集群效果</p><h5 id="Nginx-Zuul集群实现高可用网关"><a href="#Nginx-Zuul集群实现高可用网关" class="headerlink" title="Nginx+Zuul集群实现高可用网关"></a>Nginx+Zuul集群实现高可用网关</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go95huu5c2j20ko05qt9w.jpg" referrerpolicy="no-referrer"><br>1）安装Nginx（已完成）<br>2）修改Nginx配置</p><blockquote><p>vi /etc/nginx/nginx.conf</p></blockquote><p>内容如下：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">upstream zuulServer&#123;</span><br><span class="line">server 192.168.66.103:10020 weight=1;</span><br><span class="line">server 192.168.66.104:10020 weight=1;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">listen 85 default_server;</span><br><span class="line">listen [::]:85 default_server;</span><br><span class="line">server_name _;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line"><span class="meta">#</span> Load configuration files for the default server block.</span><br><span class="line">include /etc/nginx/default.d/*.conf;</span><br><span class="line">location / &#123;</span><br><span class="line"><span class="meta">#</span>## 指定服务器负载均衡服务器</span><br><span class="line">proxy_pass http://zuulServer/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>3）重启Nginx： systemctl restart nginx<br>4）修改前端Nginx的访问地址<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96ihbqtij20ki04ddgy.jpg" referrerpolicy="no-referrer"></p><h3 id="基于Kubernetes-K8S构建Jenkins持续集成平台-上"><a href="#基于Kubernetes-K8S构建Jenkins持续集成平台-上" class="headerlink" title="基于Kubernetes/K8S构建Jenkins持续集成平台(上)"></a>基于Kubernetes/K8S构建Jenkins持续集成平台(上)</h3><h4 id="Jenkins的Master-Slave分布式构建"><a href="#Jenkins的Master-Slave分布式构建" class="headerlink" title="Jenkins的Master-Slave分布式构建"></a>Jenkins的Master-Slave分布式构建</h4><h5 id="什么是Master-Slave分布式构建"><a href="#什么是Master-Slave分布式构建" class="headerlink" title="什么是Master-Slave分布式构建"></a>什么是Master-Slave分布式构建</h5><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96ihfr0jj20fg0c4q6j.jpg" referrerpolicy="no-referrer"><br>Jenkins的Master-Slave分布式构建，就是通过将构建过程分配到从属Slave节点上，从而减轻Master节点的压力，而且可以同时构建多个，有点类似负载均衡的概念。</p><h5 id="如何实现Master-Slave分布式构建"><a href="#如何实现Master-Slave分布式构建" class="headerlink" title="如何实现Master-Slave分布式构建"></a>如何实现Master-Slave分布式构建</h5><p>1）开启代理程序的TCP端口<br>Manage Jenkins -&gt; Configure Global Security<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96iheeo4j20gx04hq3k.jpg" referrerpolicy="no-referrer"><br>2）新建节点<br>Manage Jenkins—Manage Nodes—新建节点<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96po0pfgj20kv05imym.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96pnyf1uj209n058aai.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96po17nvj20ki0azt9y.jpg" referrerpolicy="no-referrer"><br>有两种在Slave节点连接Master节点的方法<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96s0aiybj20j205fwgi.jpg" referrerpolicy="no-referrer"><br>我们选择第二种：<br>2）安装和配置节点<br>下载agent.jar，并上传到Slave节点，然后执行页面提示的命令：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -jar agent.jar -jnlpUrl http://192.168.66.101:8888/computer/slave1/slaveagent.jnlp -secret</span><br><span class="line">f2ecbb99e0c81331e8b7a7917a94d478f39cb9763fc6c66d9a9741c61f9ae6d6 -workDir</span><br><span class="line">"/root/jenkins"</span><br></pre></td></tr></table></figure><p></p><p>刷新页面<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96s0dhjbj20e504maaf.jpg" referrerpolicy="no-referrer"><br>3）测试节点是否可用<br>自由风格和Maven风格的项目：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96s09z2nj20j5059wf4.jpg" referrerpolicy="no-referrer"></p><p>流水线风格的项目：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node(&apos;slave1&apos;) &#123;</span><br><span class="line">	stage(&apos;check out&apos;) &#123;</span><br><span class="line">		checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;*/master&apos;]],</span><br><span class="line">doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],userRemoteConfigs: [[credentialsId: &apos;68f2087f-a034-4d39-a9ff-1f776dd3dfa8&apos;,url:&apos;git@192.168.66.100:itheima_group/tensquare_back_cluster.git&apos;]]])</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p></p><h4 id="Kubernetes实现Master-Slave分布式构建方案"><a href="#Kubernetes实现Master-Slave分布式构建方案" class="headerlink" title="Kubernetes实现Master-Slave分布式构建方案"></a>Kubernetes实现Master-Slave分布式构建方案</h4><h5 id="传统Jenkins的Master-Slave方案的缺陷"><a href="#传统Jenkins的Master-Slave方案的缺陷" class="headerlink" title="传统Jenkins的Master-Slave方案的缺陷"></a>传统Jenkins的Master-Slave方案的缺陷</h5><ul><li>Master节点发生单点故障时，整个流程都不可用了</li><li>每个 Slave节点的配置环境不一样，来完成不同语言的编译打包等操作，但是这些差异化的配置导致管理起来非常不方便，维护起来也是比较费劲</li><li>资源分配不均衡，有的 Slave节点要运行的job出现排队等待，而有的Slave节点处于空闲状态</li><li>资源浪费，每台 Slave节点可能是实体机或者VM，当Slave节点处于空闲状态时，也不会完全释放<br>掉资源</li></ul><p>以上种种问题，我们可以引入Kubernates来解决！</p><h6 id="Kubernates简介"><a href="#Kubernates简介" class="headerlink" title="Kubernates简介"></a>Kubernates简介</h6><p>Kubernetes（简称，K8S）是Google开源的容器集群管理系统，在Docker技术的基础上，为容器化的应用提供部署运行、资源调度、服务发现和动态伸缩等一系列完整功能，提高了大规模容器集群管理的便捷性。 其主要功能如下：</p><ul><li>使用Docker对应用程序包装(package)、实例化(instantiate)、运行(run)。</li><li>以集群的方式运行、管理跨机器的容器。以集群的方式运行、管理跨机器的容器。</li><li>解决Docker跨机器容器之间的通讯问题。解决Docker跨机器容器之间的通讯问题。</li><li>Kubernetes的自我修复机制使得容器集群总是运行在用户期望的状态。</li></ul><h6 id="Kubernates-Docker-Jenkins持续集成架构图"><a href="#Kubernates-Docker-Jenkins持续集成架构图" class="headerlink" title="Kubernates+Docker+Jenkins持续集成架构图"></a>Kubernates+Docker+Jenkins持续集成架构图</h6><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96x8ihw4j20e80b9abe.jpg" referrerpolicy="no-referrer"><br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96x8k7u3j20ku09nacp.jpg" referrerpolicy="no-referrer"><br>大致工作流程：手动/自动构建 -&gt; Jenkins 调度 K8S API -＞动态生成 Jenkins Slave pod -＞ Slave pod拉取 Git 代码／编译／打包镜像 -＞推送到镜像仓库 Harbor -＞ Slave 工作完成，Pod 自动销毁 -＞部署到测试或生产 Kubernetes平台。（完全自动化，无需人工干预）</p><h6 id="Kubernates-Docker-Jenkins持续集成方案好处"><a href="#Kubernates-Docker-Jenkins持续集成方案好处" class="headerlink" title="Kubernates+Docker+Jenkins持续集成方案好处"></a>Kubernates+Docker+Jenkins持续集成方案好处</h6><ul><li><strong>服务高可用</strong>：当 Jenkins Master 出现故障时，Kubernetes 会自动创建一个新的 Jenkins Master容器，并且将 Volume 分配给新创建的容器，保证数据不丢失，从而达到集群服务高可用。</li><li><strong>动态伸缩，合理使用资源</strong>：每次运行 Job 时，会自动创建一个 Jenkins Slave，Job 完成后，Slave自动注销并删除容器，资源自动释放，而且 Kubernetes 会根据每个资源的使用情况，动态分配Slave 到空闲的节点上创建，降低出现因某节点资源利用率高，还排队等待在该节点的情况。</li><li><strong>扩展性好</strong>：当 Kubernetes 集群的资源严重不足而导致 Job 排队等待时，可以很容易的添加一个Kubernetes Node 到集群中，从而实现扩展。</li></ul><h5 id="Kubeadm安装Kubernetes"><a href="#Kubeadm安装Kubernetes" class="headerlink" title="Kubeadm安装Kubernetes"></a>Kubeadm安装Kubernetes</h5><h6 id="Kubernetes的架构"><a href="#Kubernetes的架构" class="headerlink" title="Kubernetes的架构"></a>Kubernetes的架构</h6><p><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96x8kv50j20hm09wdkm.jpg" referrerpolicy="no-referrer"><br>API Server：用于暴露Kubernetes API，任何资源的请求的调用操作都是通过kube-apiserver提供的接口进行的。<br>Etcd：是Kubernetes提供默认的存储系统，保存所有集群数据，使用时需要为etcd数据提供备份计划。<br>Controller-Manager：作为集群内部的管理控制中心，负责集群内的Node、Pod副本、服务端点（Endpoint）、命名空间（Namespace）、服务账号（ServiceAccount）、资源定额<br>（ResourceQuota）的管理，当某个Node意外宕机时，Controller Manager会及时发现并执行自动化修复流程，确保集群始终处于预期的工作状态。<br>Scheduler：监视新创建没有分配到Node的Pod，为Pod选择一个Node。<br>Kubelet：负责维护容器的生命周期，同时负责Volume和网络的管理<br>Kube proxy：是Kubernetes的核心组件，部署在每个Node节点上，它是实现Kubernetes Service的通信与负载均衡机制的重要组件。</p><h6 id="安装环境说明"><a href="#安装环境说明" class="headerlink" title="安装环境说明"></a>安装环境说明</h6><table><thead><tr><th>主机名称</th><th>IP地址</th><th>安装的软件</th></tr></thead><tbody><tr><td>代码托管服务器</td><td>192.168.66.100</td><td>Gitlab-12.4.2</td></tr><tr><td>Docker仓库服务器</td><td>192.168.66.102</td><td>Harbor1.9.2</td></tr><tr><td>k8s-master</td><td>192.168.66.101</td><td>kube-apiserver、kube-controller-manager、kube-scheduler、docker、etcd、calico，NFS</td></tr><tr><td>k8s-node1</td><td>192.168.66.103</td><td>kubelet、kubeproxy、Docker18.06.1-ce</td></tr><tr><td>k8s-node2</td><td>192.168.66.104</td><td>kubelet、kubeproxy、Docker18.06.1-ce</td></tr></tbody></table><h6 id="三台机器都需要完成"><a href="#三台机器都需要完成" class="headerlink" title="三台机器都需要完成"></a>三台机器都需要完成</h6><p>修改三台机器的hostname及hosts文件</p><blockquote><p>hostnamectl set-hostname k8s-master<br>hostnamectl set-hostname k8s-node1 hostnamectl set-hostname k8s-node2<br>cat &gt;&gt;/etc/hosts&lt;&lt;EOF 192.168.66.101 k8s-master 192.168.66.103 k8s-node1<br>192.168.66.104 k8s-node2 EOF</p></blockquote><p>关闭防火墙和关闭SELinux</p><blockquote><p>systemctl stop firewalld<br>systemctl disable firewalld<br>setenforce 0 临时关闭<br>vi /etc/sysconfig/selinux 永久关闭</p></blockquote><p>改为SELINUX=disabled</p><p>设置系统参数</p><p>设置允许路由转发，不对bridge的数据进行处理<br>创建文件</p><blockquote><p>vi /etc/sysctl.d/k8s.conf</p></blockquote><p>内容如下：</p><blockquote><p>net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1<br>net.ipv4.ip_forward = 1 vm.swappiness = 0</p></blockquote><p>执行文件</p><blockquote><p>sysctl -p /etc/sysctl.d/k8s.conf</p></blockquote><p>kube-proxy 开启ipvs的前置条件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash</span><br><span class="line">/etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e</span><br><span class="line">nf_conntrack_ipv4</span><br></pre></td></tr></table></figure><h6 id="所有节点关闭swap"><a href="#所有节点关闭swap" class="headerlink" title="所有节点关闭swap"></a>所有节点关闭swap</h6><blockquote><p>swapoff -a 临时关闭<br>vi /etc/fstab 永久关闭<br>注释掉以下字段<br>/dev/mapper/cl-swap swap swap defaults 0 0</p></blockquote><h6 id="安装kubelet、kubeadm、kubectl"><a href="#安装kubelet、kubeadm、kubectl" class="headerlink" title="安装kubelet、kubeadm、kubectl"></a>安装kubelet、kubeadm、kubectl</h6><ul><li>kubeadm: 用来初始化集群的指令。</li><li>kubelet: 在集群中的每个节点上用来启动 pod 和 container 等。</li><li>kubectl: 用来与集群通信的命令行工具。<br>清空yum缓存<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br></pre></td></tr></table></figure></li></ul><p>设置 yum安装源<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p></p><p>安装：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure><p></p><p>kubelet 设置开机启动（注意：先不启动，现在启动的话会报错）<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable kubelet</span><br></pre></td></tr></table></figure><p></p><p>查看版本<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubelet --version</span><br></pre></td></tr></table></figure><p></p><p>安装的是最新版本： Kubernetes v1.16.3（可能会变化）</p><h6 id="Master节点需要完成"><a href="#Master节点需要完成" class="headerlink" title="Master节点需要完成"></a>Master节点需要完成</h6><p>1）运行初始化命令<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=1.17.0 \</span><br><span class="line">--apiserver-advertise-address=192.168.66.101 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">--service-cidr=10.1.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure><p></p><p>注意： apiserver-advertise-address这个地址必须是master机器的IP<br>常用错误：<br>错误一：[WARNING IsDockerSystemdCheck]: detected “cgroupfs” as the Docker cgroup driver<br>作为Docker cgroup驱动程序。，Kubernetes推荐的Docker驱动程序是“systemd”<br>解决方案：修改Docker的配置: vi /etc/docker/daemon.json，加入<br></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"exec-opts"</span>:[<span class="string">"native.cgroupdriver=systemd"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>然后重启 Docker</p><p>错误二：[ERROR NumCPU]: the number of available CPUs 1 is less than the required 2<br>解决方案：修改虚拟机的CPU的个数，至少为2个</p><p>安装过程日志：</p><p><img src="https://tva4.sinaimg.cn/large/006MOU0zgy1go9eq05nmkj30oa0dl7c3.jpg" alt="jenkins持续集成-安装过程日志" referrerpolicy="no-referrer"></p><p>最后，会提示节点安装的命令，必须记下来</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.66.101:6443 --token 754snw.9xq9cotze1ybwnti \</span><br><span class="line">  --discovery-token-ca-cert-hash</span><br><span class="line">sha256:3372ff6717ea5997121213e2c9d63fa7c8cdfb031527e17f2e20254f382ea03a</span><br></pre></td></tr></table></figure><p>2）启动kubelet<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure><p></p><p><img src="https://tva2.sinaimg.cn/large/006MOU0zgy1go9epy9syyj30gr06fwgx.jpg" alt="jenkins持续集成-安装过程日志" referrerpolicy="no-referrer"></p><p>3）配置kubectl工具<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure><p></p><p>4）安装Calico</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir k8s</span><br><span class="line">cd k8s</span><br><span class="line">wget https://docs.projectcalico.org/v3.10/getting-</span><br><span class="line">started/kubernetes/installation/hosted/kubernetes-datastore/calico-</span><br><span class="line">networking/1.7/calico.yaml</span><br><span class="line">sed -i 's/192.168.0.0/10.244.0.0/g' calico.yaml</span><br><span class="line">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure><p>5）等待几分钟，查看所有Pod的状态，确保所有Pod都是Running状态<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod --all-namespaces -o wide</span><br></pre></td></tr></table></figure><p></p><p><img src="https://tvax3.sinaimg.cn/large/006MOU0zgy1go9epxjknvj30ol048ad0.jpg" alt="jenkins持续集成-安装过程日志" referrerpolicy="no-referrer"></p><h6 id="Slave节点需要完成"><a href="#Slave节点需要完成" class="headerlink" title="Slave节点需要完成"></a>Slave节点需要完成</h6><p>1）让所有节点让集群环境<br>使用之前Master节点产生的命令加入集群<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.66.101:6443 --token 754snw.9xq9cotze1ybwnti \</span><br><span class="line">  --discovery-token-ca-cert-hash</span><br><span class="line">sha256:3372ff6717ea5997121213e2c9d63fa7c8cdfb031527e17f2e20254f382ea03a</span><br></pre></td></tr></table></figure><p></p><p>2 ）启动kubelet<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start kubelet</span><br></pre></td></tr></table></figure><p></p><p>3）回到Master节点查看，如果Status全部为Ready，代表集群环境搭建成功！！！<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure><p></p><h6 id="kubectl常用命令"><a href="#kubectl常用命令" class="headerlink" title="kubectl常用命令"></a>kubectl常用命令</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes  查看所有主从节点的状态</span><br><span class="line">kubectl get ns  获取所有namespace资源</span><br><span class="line">kubectl get pods -n &#123;$nameSpace&#125; 获取指定namespace的pod</span><br><span class="line">kubectl describe pod的名称  -n &#123;$nameSpace&#125;  查看某个pod的执行过程</span><br><span class="line">kubectl logs --tail=1000 pod的名称 | less 查看日志</span><br><span class="line">kubectl create -f xxx.yml 通过配置文件创建一个集群资源对象</span><br><span class="line">kubectl delete -f xxx.yml 通过配置文件删除一个集群资源对象</span><br><span class="line">kubectl delete pod名称 -n &#123;$nameSpace&#125;  通过pod删除集群资源</span><br><span class="line">kubectl get service -n &#123;$nameSpace&#125;  查看pod的service情况</span><br></pre></td></tr></table></figure><h3 id="基于Kubernetes-K8S构建Jenkins持续集成平台-下"><a href="#基于Kubernetes-K8S构建Jenkins持续集成平台-下" class="headerlink" title="基于Kubernetes/K8S构建Jenkins持续集成平台(下)"></a>基于Kubernetes/K8S构建Jenkins持续集成平台(下)</h3><p>Jenkins-Master-Slave架构图回顾：<br><img src="https://tva1.sinaimg.cn/large/73bac01bgy1go96x8ihw4j20e80b9abe.jpg" referrerpolicy="no-referrer"></p><h4 id="安装和配置-NFS"><a href="#安装和配置-NFS" class="headerlink" title="安装和配置 NFS"></a>安装和配置 NFS</h4><h5 id="NFS简介"><a href="#NFS简介" class="headerlink" title="NFS简介"></a>NFS简介</h5><p>NFS（Network File System），它最大的功能就是可以通过网络，让不同的机器、不同的操作系统可以共享彼此的文件。我们可以利用NFS共享Jenkins运行的配置文件、Maven的仓库依赖文件等</p><h5 id="NFS安装"><a href="#NFS安装" class="headerlink" title="NFS安装"></a>NFS安装</h5><p>我们把 NFS服务器安装在192.168.66.101机器上<br>1）安装NFS服务（在所有K8S的节点都需要安装）<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nfs-utils</span><br></pre></td></tr></table></figure><p></p><p>2 ）创建共享目录<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/nfs/jenkins</span><br><span class="line">vi /etc/exports   编写NFS的共享配置</span><br><span class="line">内容如下:</span><br><span class="line">/opt/nfs/jenkins  *(rw,no_root_squash)    *代表对所有IP都开放此目录，rw是读写</span><br></pre></td></tr></table></figure><p></p><p>3）启动服务<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nfs  开机启动</span><br><span class="line">systemctl start nfs   启动</span><br></pre></td></tr></table></figure><p></p><p>4）查看NFS共享目录<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showmount -e 192.168.66.101</span><br></pre></td></tr></table></figure><p></p><h4 id="在Kubernetes安装Jenkins-Master"><a href="#在Kubernetes安装Jenkins-Master" class="headerlink" title="在Kubernetes安装Jenkins-Master"></a>在Kubernetes安装Jenkins-Master</h4><h5 id="创建NFS-client-provisioner"><a href="#创建NFS-client-provisioner" class="headerlink" title="创建NFS client provisioner"></a>创建NFS client provisioner</h5><p>nfs-client-provisioner 是一个Kubernetes的简易NFS的外部provisioner，本身不提供NFS，需要现有的NFS服务器提供存储。</p><p>1）上传nfs-client-provisioner构建文件<br>其中注意修改 <strong>deployment.yaml</strong>，使用之前配置NFS服务器和目录<br><img src="https://tvax2.sinaimg.cn/large/006MOU0zgy1go9f5re7t9j30g1098gna.jpg" referrerpolicy="no-referrer"><br>2 ）构建nfs-client-provisioner的pod资源<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd nfs-client</span><br><span class="line">kubectl create -f .</span><br></pre></td></tr></table></figure><p></p><p>3 ）查看pod是否创建成功<br><img src="https://tva2.sinaimg.cn/large/006MOU0zgy1go9f5qxpvaj30kf02zq3r.jpg" referrerpolicy="no-referrer"></p><h5 id="安装Jenkins-Master"><a href="#安装Jenkins-Master" class="headerlink" title="安装Jenkins-Master"></a>安装Jenkins-Master</h5><p>1）上传Jenkins-Master构建文件<br><img src="https://tvax4.sinaimg.cn/large/006MOU0zgy1go9f5qiyrgj309a03ot8w.jpg" referrerpolicy="no-referrer"><br>其中有两点注意：<br>第一、在StatefulSet.yaml文件，声明了利用nfs-client-provisioner进行Jenkins-Master文件存储<br><img src="https://tvax1.sinaimg.cn/large/006MOU0zgy1go9f5qb0bwj30k6067t9z.jpg" referrerpolicy="no-referrer"><br>第二、 Service发布方法采用NodePort，会随机产生节点访问端口<br><img src="https://tva4.sinaimg.cn/large/006MOU0zgy1go9f5prep6j30c1088jsa.jpg" referrerpolicy="no-referrer"><br>2）创建kube-ops的namespace<br>因为我们把Jenkins-Master的pod放到kube-ops下<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create namespace kube-ops</span><br></pre></td></tr></table></figure><p></p><p>3）构建Jenkins-Master的pod资源<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd jenkins-master</span><br><span class="line">kubectl create -f .</span><br></pre></td></tr></table></figure><p></p><p>4）查看pod是否创建成功<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n kube-ops</span><br></pre></td></tr></table></figure><p></p><p>5）查看信息，并访问<br>查看Pod运行在那个Node上<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pods -n kube-ops</span><br></pre></td></tr></table></figure><p></p><p>查看分配的端口<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get service -n kube-ops</span><br></pre></td></tr></table></figure><p></p><p>最终访问地址为： <a href="http://192.168.66.103:30136" target="_blank" rel="noopener">http://192.168.66.103:30136</a> （192.168.66.103为k8s-node1的IP）</p><p>安装过程跟之前是一样的！</p><p>6）先安装基本的插件</p><ul><li>Localization:Chinese</li><li>Git</li><li>Pipeline</li><li>Extended Choice Parameter</li></ul><h4 id="Jenkins与Kubernetes整合"><a href="#Jenkins与Kubernetes整合" class="headerlink" title="Jenkins与Kubernetes整合"></a>Jenkins与Kubernetes整合</h4><h5 id="安装Kubernetes插件"><a href="#安装Kubernetes插件" class="headerlink" title="安装Kubernetes插件"></a>安装Kubernetes插件</h5><p>系统管理-&gt;插件管理-&gt;可选插件<br><img src="https://tva1.sinaimg.cn/large/006MOU0zgy1go9fgee1gnj30hf061my8.jpg" referrerpolicy="no-referrer"></p><h5 id="实现Jenkins与Kubernetes整合"><a href="#实现Jenkins与Kubernetes整合" class="headerlink" title="实现Jenkins与Kubernetes整合"></a>实现Jenkins与Kubernetes整合</h5><p>系统管理-&gt;系统配置-&gt;云-&gt;新建云-&gt;Kubernetes<br><img src="https://tvax1.sinaimg.cn/large/006MOU0zgy1go9fgdv735j30ob0dtmz1.jpg" referrerpolicy="no-referrer"></p><ul><li>kubernetes 地址采用了kube的服务器发现： <a href="https://kubernetes.default.svc.cluster.local" target="_blank" rel="noopener">https://kubernetes.default.svc.cluster.local</a></li><li>namespace 填kube-ops，然后点击Test Connection，如果出现 Connection test successful 的提示信息证明 Jenkins 已经可以和 Kubernetes 系统正常通信</li><li>Jenkins URL 地址： <a href="http://jenkins.kube-ops.svc.cluster.local:8080" target="_blank" rel="noopener">http://jenkins.kube-ops.svc.cluster.local:8080</a></li></ul><h5 id="构建Jenkins-Slave自定义镜像"><a href="#构建Jenkins-Slave自定义镜像" class="headerlink" title="构建Jenkins-Slave自定义镜像"></a>构建Jenkins-Slave自定义镜像</h5><p>Jenkins-Master在构建Job的时候，Kubernetes会创建Jenkins-Slave的Pod来完成Job的构建。我们选择运行Jenkins-Slave的镜像为官方推荐镜像：jenkins/jnlp-slave:latest，但是这个镜像里面并没有Maven环境，为了方便使用，我们需要自定义一个新的镜像：<br>准备材料：<br><img src="https://tva1.sinaimg.cn/large/006MOU0zgy1go9fgdhkwtj30bn03sglt.jpg" referrerpolicy="no-referrer"><br>Dockerfile 文件内容如下：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FROM jenkins/jnlp-slave:latest</span><br><span class="line">MAINTAINER itcast</span><br><span class="line"><span class="meta">#</span> 切换到 root 账户进行操作</span><br><span class="line">USER root</span><br><span class="line"><span class="meta">#</span> 安装 maven</span><br><span class="line">COPY apache-maven-3.6.2-bin.tar.gz .</span><br><span class="line">RUN tar -zxf apache-maven-3.6.2-bin.tar.gz &amp;&amp; \</span><br><span class="line"> mv apache-maven-3.6.2 /usr/local &amp;&amp; \</span><br><span class="line"> rm -f apache-maven-3.6.2-bin.tar.gz &amp;&amp; \</span><br><span class="line"> ln -s /usr/local/apache-maven-3.6.2/bin/mvn /usr/bin/mvn &amp;&amp; \</span><br><span class="line">  ln -s /usr/local/apache-maven-3.6.2 /usr/local/apache-maven &amp;&amp; \</span><br><span class="line"> mkdir -p /usr/local/apache-maven/repo</span><br><span class="line">COPY settings.xml /usr/local/apache-maven/conf/settings.xml</span><br><span class="line">USER jenkins</span><br></pre></td></tr></table></figure><p></p><p>构建出一个新镜像： jenkins-slave-maven:latest<br>然把镜像上传到Harbor的公共库library中<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag jenkins-slave-maven:latest 192.168.66.102:85/library/jenkins-slave-maven:latest</span><br><span class="line">docker push 192.168.66.102:85/library/jenkins-slave-maven:latest</span><br></pre></td></tr></table></figure><p></p><h5 id="测试Jenkins-Slave是否可以创建"><a href="#测试Jenkins-Slave是否可以创建" class="headerlink" title="测试Jenkins-Slave是否可以创建"></a>测试Jenkins-Slave是否可以创建</h5><p>1）创建一个Jenkins流水线项目<br><img src="https://tvax3.sinaimg.cn/large/006MOU0zgy1go9fgd9y08j30as06u75g.jpg" referrerpolicy="no-referrer"><br>2 ）编写Pipeline，从GItlab拉取代码<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def git_address =</span><br><span class="line">"http://192.168.66.100:82/itheima_group/tensquare_back_cluster.git"</span><br><span class="line">def git_auth = "9d9a2707-eab7-4dc9-b106-e52f329cbc95"</span><br><span class="line">//创建一个Pod的模板，label为jenkins-slave</span><br><span class="line">podTemplate(label: 'jenkins-slave', cloud: 'kubernetes', containers: [</span><br><span class="line">  containerTemplate(</span><br><span class="line">    name: 'jnlp',</span><br><span class="line">    image: "192.168.66.102:85/library/jenkins-slave-maven:latest"</span><br><span class="line">	 )</span><br><span class="line">	]</span><br><span class="line">)</span><br><span class="line">&#123;</span><br><span class="line"> //引用jenkins-slave的pod模块来构建Jenkins-Slave的pod</span><br><span class="line"> node("jenkins-slave")&#123;</span><br><span class="line">   // 第一步</span><br><span class="line">   stage('拉取代码')&#123;</span><br><span class="line">    checkout([$class: 'GitSCM', branches: [[name: 'master']],</span><br><span class="line">userRemoteConfigs: [[credentialsId: "$&#123;git_auth&#125;", url: "$&#123;git_address&#125;"]]])</span><br><span class="line">  		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>3 ）查看构建日志<br><img src="https://tvax1.sinaimg.cn/large/006MOU0zgy1go9fgcyr82j30li0j6win.jpg" referrerpolicy="no-referrer"></p><h5 id="Jenkins-Kubernetes-Docker完成微服务持续集成"><a href="#Jenkins-Kubernetes-Docker完成微服务持续集成" class="headerlink" title="Jenkins+Kubernetes+Docker完成微服务持续集成"></a>Jenkins+Kubernetes+Docker完成微服务持续集成</h5><h6 id="拉取代码，构建镜像"><a href="#拉取代码，构建镜像" class="headerlink" title="拉取代码，构建镜像"></a>拉取代码，构建镜像</h6><p>1）创建NFS共享目录<br>让所有Jenkins-Slave构建指向NFS的Maven的共享仓库目录<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/exports</span><br><span class="line">添加内容：</span><br><span class="line">/opt/nfs/jenkins  *(rw,no_root_squash)</span><br><span class="line">/opt/nfs/maven   *(rw,no_root_squash)</span><br><span class="line">systemctl restart nfs  重启NFS</span><br></pre></td></tr></table></figure><p></p><p>2）创建项目，编写构建Pipeline<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">def git_address =</span><br><span class="line">&quot;http://192.168.66.100:82/itheima_group/tensquare_back_cluster.git&quot;</span><br><span class="line">def git_auth = &quot;9d9a2707-eab7-4dc9-b106-e52f329cbc95&quot;</span><br><span class="line">//构建版本的名称</span><br><span class="line">def tag = &quot;latest&quot;</span><br><span class="line">//Harbor私服地址</span><br><span class="line">def harbor_url = &quot;192.168.66.102:85&quot;</span><br><span class="line">//Harbor的项目名称</span><br><span class="line">def harbor_project_name = &quot;tensquare&quot;</span><br><span class="line">//Harbor的凭证</span><br><span class="line">def harbor_auth = &quot;71eff071-ec17-4219-bae1-5d0093e3d060&quot;</span><br><span class="line">podTemplate(label: &apos;jenkins-slave&apos;, cloud: &apos;kubernetes&apos;, containers: [</span><br><span class="line">  containerTemplate(</span><br><span class="line">    name: &apos;jnlp&apos;,</span><br><span class="line">    image: &quot;192.168.66.102:85/library/jenkins-slave-maven:latest&quot;</span><br><span class="line"> ),</span><br><span class="line">  containerTemplate(</span><br><span class="line">    name: &apos;docker&apos;,</span><br><span class="line">    image: &quot;docker:stable&quot;,</span><br><span class="line">    ttyEnabled: true,</span><br><span class="line">    command: &apos;cat&apos;</span><br><span class="line"> ),</span><br><span class="line">],</span><br><span class="line"> volumes: [</span><br><span class="line">  hostPathVolume(mountPath: &apos;/var/run/docker.sock&apos;, hostPath:</span><br><span class="line">&apos;/var/run/docker.sock&apos;),</span><br><span class="line">  nfsVolume(mountPath: &apos;/usr/local/apache-maven/repo&apos;, serverAddress:</span><br><span class="line">&apos;192.168.66.101&apos; , serverPath: &apos;/opt/nfs/maven&apos;),</span><br><span class="line">],</span><br><span class="line">)</span><br><span class="line">&#123;</span><br><span class="line"> node(&quot;jenkins-slave&quot;)&#123;</span><br><span class="line">   // 第一步</span><br><span class="line">   stage(&apos;拉取代码&apos;)&#123;</span><br><span class="line">    checkout([$class: &apos;GitSCM&apos;, branches: [[name: &apos;$&#123;branch&#125;&apos;]],</span><br><span class="line">userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_address&#125;&quot;]]])</span><br><span class="line">  &#125;</span><br><span class="line">   // 第二步</span><br><span class="line">   stage(&apos;代码编译&apos;)&#123;</span><br><span class="line">     //编译并安装公共工程</span><br><span class="line">    sh &quot;mvn -f tensquare_common clean install&quot;</span><br><span class="line">  &#125;</span><br><span class="line">   // 第三步</span><br><span class="line">   stage(&apos;构建镜像，部署项目&apos;)&#123;</span><br><span class="line">    //把选择的项目信息转为数组</span><br><span class="line">def selectedProjects = &quot;$&#123;project_name&#125;&quot;.split(&apos;,&apos;)</span><br><span class="line">      for(int i=0;i&lt;selectedProjects.size();i++)&#123;</span><br><span class="line">        //取出每个项目的名称和端口</span><br><span class="line">        def currentProject = selectedProjects[i];</span><br><span class="line">        //项目名称</span><br><span class="line">        def currentProjectName = currentProject.split(&apos;@&apos;)[0]</span><br><span class="line">        //项目启动端口</span><br><span class="line">        def currentProjectPort = currentProject.split(&apos;@&apos;)[1]</span><br><span class="line">        //定义镜像名称</span><br><span class="line">        def imageName = &quot;$&#123;currentProjectName&#125;:$&#123;tag&#125;&quot;</span><br><span class="line">//编译，构建本地镜像</span><br><span class="line">sh &quot;mvn -f $&#123;currentProjectName&#125; clean package</span><br><span class="line">dockerfile:build&quot;</span><br><span class="line">container(&apos;docker&apos;) &#123;</span><br><span class="line">//给镜像打标签</span><br><span class="line">sh &quot;docker tag $&#123;imageName&#125;</span><br><span class="line">$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">//登录Harbor，并上传镜像</span><br><span class="line">withCredentials([usernamePassword(credentialsId:</span><br><span class="line">&quot;$&#123;harbor_auth&#125;&quot;, passwordVariable: &apos;password&apos;, usernameVariable: &apos;username&apos;)])</span><br><span class="line">&#123;</span><br><span class="line"> //登录</span><br><span class="line"> sh &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125;</span><br><span class="line">$&#123;harbor_url&#125;&quot;</span><br><span class="line"> //上传镜像</span><br><span class="line"> sh &quot;docker push</span><br><span class="line">$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line">//删除本地镜像</span><br><span class="line">sh &quot;docker rmi -f $&#123;imageName&#125;&quot;</span><br><span class="line">sh &quot;docker rmi -f</span><br><span class="line">$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>注意：在构建过程会发现无法创建仓库目录，是因为 NFS共享目录权限不足，需更改权限<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R jenkins:jenkins /opt/nfs/maven</span><br><span class="line">chmod -R 777 /opt/nfs/maven</span><br></pre></td></tr></table></figure><p></p><p>还有 Docker命令执行权限问题<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /var/run/docker.sock</span><br></pre></td></tr></table></figure><p></p><p>需要手动上传父工程依赖到 NFS的Maven共享仓库目录中<br><img src="https://tvax2.sinaimg.cn/large/006MOU0zgy1go9fgcddvsj309e04kglz.jpg" referrerpolicy="no-referrer"></p><h5 id="微服务部署到K8S"><a href="#微服务部署到K8S" class="headerlink" title="微服务部署到K8S"></a>微服务部署到K8S</h5><p>修改每个微服务的 application.yml<br>Eureka<br></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="string">$&#123;PORT:10086&#125;</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line"><span class="attr"> name:</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="comment"># 续期时间，即扫描失效服务的间隔时间（缺省为60*1000ms）</span></span><br><span class="line"><span class="attr"> eviction-interval-timer-in-ms:</span> <span class="number">5000</span></span><br><span class="line"><span class="attr"> enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr"> use-read-only-response-cache:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">client:</span></span><br><span class="line">  <span class="comment"># eureka client间隔多久去拉取服务注册信息 默认30s</span></span><br><span class="line"><span class="attr"> registry-fetch-interval-seconds:</span> <span class="number">5</span></span><br><span class="line"><span class="attr"> serviceUrl:</span></span><br><span class="line"><span class="attr">  defaultZone:</span> <span class="string">$&#123;EUREKA_SERVER:http://127.0.0.1:$&#123;server.port&#125;/eureka/&#125;</span></span><br><span class="line"><span class="attr">instance:</span></span><br><span class="line">  <span class="comment"># 心跳间隔时间，即发送一次心跳之后，多久在发起下一次（缺省为30s）</span></span><br><span class="line"><span class="attr"> lease-renewal-interval-in-seconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="comment"># 在收到一次心跳之后，等待下一次心跳的空档时间，大于心跳间隔即可，即服务续约到期时间（缺省为90s）</span></span><br><span class="line"><span class="attr"> lease-expiration-duration-in-seconds:</span> <span class="number">10</span></span><br><span class="line"><span class="attr"> instance-id:</span></span><br><span class="line"><span class="string">$&#123;EUREKA_INSTANCE_HOSTNAME:$&#123;spring.application.name&#125;&#125;:$&#123;server.port&#125;@$&#123;random.l</span></span><br><span class="line"><span class="string">ong(1000000,9999999)&#125;</span></span><br><span class="line"><span class="attr"> hostname:</span> <span class="string">$&#123;EUREKA_INSTANCE_HOSTNAME:$&#123;spring.application.name&#125;&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>其他微服务需要注册到所有 Eureka中<br></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Eureka配置</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">client:</span></span><br><span class="line"><span class="attr">  serviceUrl:</span></span><br><span class="line"><span class="attr">    defaultZone:</span> <span class="attr">http://eureka-0.eureka:10086/eureka/,http://eureka-1.eureka:10086/eureka/</span> <span class="comment"># Eureka访问地址</span></span><br><span class="line"><span class="attr">instance:</span></span><br><span class="line">	 <span class="attr">preferIpAddress:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p></p><p>1）安装Kubernetes Continuous Deploy插件<br><img src="https://tvax3.sinaimg.cn/large/006MOU0zgy1go9fgc4neoj30e303cwey.jpg" referrerpolicy="no-referrer"><br>2）修改后的流水线脚本<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def deploy_image_name = &quot;$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;</span><br><span class="line">//部署到K8S</span><br><span class="line">  sh &quot;&quot;&quot;</span><br><span class="line">            sed -i &apos;s#\$IMAGE_NAME#$&#123;deploy_image_name&#125;#&apos;</span><br><span class="line">$&#123;currentProjectName&#125;/deploy.yml</span><br><span class="line">sed -i &apos;s#\$SECRET_NAME#$&#123;secret_name&#125;#&apos;</span><br><span class="line">$&#123;currentProjectName&#125;/deploy.yml</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">          </span><br><span class="line">        kubernetesDeploy configs: &quot;$&#123;currentProjectName&#125;/deploy.yml&quot;,</span><br><span class="line">kubeconfigId: &quot;$&#123;k8s_auth&#125;&quot;</span><br></pre></td></tr></table></figure><p></p><p>3）建立k8s认证凭证<br><img src="https://tva2.sinaimg.cn/large/006MOU0zgy1go9fgbplf3j30oj09rtau.jpg" referrerpolicy="no-referrer"></p><p>kubeconfig 到k8s的Master节点复制<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/.kube/config</span><br></pre></td></tr></table></figure><p></p><p>5）生成Docker凭证<br>Docker凭证，用于Kubernetes到Docker私服拉取镜像<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker login -u itcast -p Itcast123 192.168.66.102:85  登录Harbor</span><br><span class="line">kubectl create secret docker-registry registry-auth-secret  --docker-</span><br><span class="line">server=192.168.66.102:85 --docker-username=itcast --docker-password=Itcast123 --</span><br><span class="line">docker-email=itcast@itcast.cn  生成</span><br><span class="line">kubectl get secret  查看密钥</span><br></pre></td></tr></table></figure><p></p><p>6）在每个项目下建立deploy.xml<br>Eureka的deply.yml<br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">labels:</span></span><br><span class="line"><span class="attr"> app:</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">ports:</span></span><br><span class="line"><span class="attr"> - port:</span> <span class="number">10086</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">  targetPort:</span> <span class="number">10086</span></span><br><span class="line"><span class="attr">selector:</span></span><br><span class="line"><span class="attr"> app:</span> <span class="string">eureka</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">serviceName:</span> <span class="string">"eureka"</span></span><br><span class="line"><span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">selector:</span></span><br><span class="line"><span class="attr"> matchLabels:</span></span><br><span class="line"><span class="attr">  app:</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">template:</span></span><br><span class="line"><span class="attr"> metadata:</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">   app:</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr"> spec:</span></span><br><span class="line"><span class="attr">  imagePullSecrets:</span></span><br><span class="line"><span class="attr">   - name:</span> <span class="string">$SECRET_NAME</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">   - name:</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">$IMAGE_NAME</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="attr">     - containerPort:</span> <span class="number">10086</span></span><br><span class="line"><span class="attr">    env:</span></span><br><span class="line"><span class="attr">     - name:</span> <span class="string">MY_POD_NAME</span></span><br><span class="line"><span class="attr">      valueFrom:</span></span><br><span class="line"><span class="attr">       fieldRef:</span></span><br><span class="line"><span class="attr">        fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line"><span class="attr">     - name:</span> <span class="string">EUREKA_SERVER</span></span><br><span class="line"><span class="attr">      value:</span> <span class="string">"http://eureka-0.eureka:10086/eureka/,http://eureka-1.eureka:10086/eureka/"</span></span><br><span class="line"><span class="attr">     - name:</span> <span class="string">EUREKA_INSTANCE_HOSTNAME</span></span><br><span class="line"><span class="attr">      value:</span> <span class="string">$&#123;MY_POD_NAME&#125;.eureka</span></span><br><span class="line"><span class="attr">podManagementPolicy:</span> <span class="string">"Parallel"</span></span><br></pre></td></tr></table></figure><p></p><p>其他项目的 deploy.yml主要把名字和端口修改：<br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">zuul</span></span><br><span class="line"><span class="attr">labels:</span></span><br><span class="line"><span class="attr"> app:</span> <span class="string">zuul</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">ports:</span></span><br><span class="line"><span class="attr"> - port:</span> <span class="number">10020</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">zuul</span></span><br><span class="line"><span class="attr">  targetPort:</span> <span class="number">10020</span></span><br><span class="line"><span class="attr">selector:</span></span><br><span class="line"><span class="attr"> app:</span> <span class="string">zuul</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">zuul</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">serviceName:</span> <span class="string">"zuul"</span></span><br><span class="line"><span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">selector:</span></span><br><span class="line"><span class="attr"> matchLabels:</span></span><br><span class="line"><span class="attr">  app:</span> <span class="string">zuul</span></span><br><span class="line"><span class="attr">template:</span></span><br><span class="line"><span class="attr"> metadata:</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">   app:</span> <span class="string">zuul</span></span><br><span class="line"><span class="attr"> spec:</span></span><br><span class="line"><span class="attr">  imagePullSecrets:</span></span><br><span class="line"><span class="attr">   - name:</span> <span class="string">$SECRET_NAME</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">   - name:</span> <span class="string">zuul</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">$IMAGE_NAME</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="attr">     - containerPort:</span> <span class="number">10020</span></span><br><span class="line"><span class="attr">podManagementPolicy:</span> <span class="string">"Parallel"</span></span><br></pre></td></tr></table></figure><p></p><p>7）项目构建后，查看服务创建情况<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -owide</span><br><span class="line">kubectl get service</span><br></pre></td></tr></table></figure><p></p><p>效果如下：<br><img src="https://tvax2.sinaimg.cn/large/006MOU0zgy1go9fgb5pm2j30om04fta0.jpg" referrerpolicy="no-referrer"></p></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> 在线分享网</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://me.obey.fun/持续集成及Jenkins详解.html" title="持续集成及Jenkins详解">https://me.obey.fun/持续集成及Jenkins详解.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均为原创。转载请注明出处！</li></ul></div><div><div><blockquote class="blockquote-center" style="color:#ccc">-------------本文结束 <i class="fa fa-apple"></i> 感谢您的阅读-------------</blockquote></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏</span></button><div>文章对我有益，我要小额赞赏...</div><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechatpay.jpg" alt="HuiProgramer 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/images/alipay.jpg" alt="HuiProgramer 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div id="tags" class="post-tags"><a href="/tags/Jenkins/" rel="tag">Jenkins</a> <a href="/tags/持续集成-持续部署/" rel="tag">持续集成/持续部署</a></div><script type="text/javascript">for(var alltags=document.getElementById("tags"),tags=alltags.getElementsByTagName("a"),i=tags.length-1;i>=0;i--){var r=Math.floor(75*Math.random()+130),g=Math.floor(75*Math.random()+100),b=Math.floor(75*Math.random()+80);tags[i].style.background="rgb("+r+","+g+","+b+")"}var text="持续集成及Jenkins详解";document.onreadystatechange=function(){"complete"==document.readyState&&wenkmTips.show("正在阅读 -> "+text)}</script><style type="text/css">.post-tags a{color:#fff;background-color:#f5f7f1;border-radius:6px;padding-right:10px;padding-left:10px;margin-right:5px;margin-left:0;margin-top:18px;margin-bottom:0}.post-tags a:before{content:"📜"}</style><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/JVM探究.html" rel="next" title="JVM探究"><i class="fa fa-chevron-left"></i> JVM探究</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><div title="返回顶部(或下方百分比按钮)" class="backtop" style="background-position:0 -1000px"></div><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="https://huiprogramer.gitee.io/medias/avatar.jpg" alt="HuiProgramer" referrerpolicy="no-referrer"><p class="site-author-name" itemprop="name">HuiProgramer</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">54</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">43</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">45</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a rel="external nofollow" href="https://github.com/HuiProgramer" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a rel="external nofollow" href="mailto:huiprogramer@outlook.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a> </span><span class="links-of-author-item"><a rel="external nofollow" href="https://www.jianshu.com/u/1606b64f25b5" target="_blank" title="简书"><i class="fa fa-fw fa-heartbeat"></i>简书</a> </span><span class="links-of-author-item"><a rel="external nofollow" href="https://cnblogs.com/HuiProgramer" target="_blank" title="博客园"><i class="fa fa-fw fa-book"></i>博客园</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 推荐阅读</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a rel="external nofollow" href="https://me.obey.fun/Git教程.html" title="Git教程" target="_blank">Git教程</a></li><li class="links-of-blogroll-item"><a rel="external nofollow" href="https://me.obey.fun/Markdown基本语法.html" title="Markdown基本语法" target="_blank">Markdown基本语法</a></li><li class="links-of-blogroll-item"><a rel="external nofollow" href="https://me.obey.fun/Java学习路线图.html" title="Java学习路线图" target="_blank">Java学习路线图</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#持续集成及Jenkins介绍"><span class="nav-number">1.</span> <span class="nav-text">持续集成及Jenkins介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#软件开发生命周期"><span class="nav-number">1.1.</span> <span class="nav-text">软件开发生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#软件开发瀑布模型"><span class="nav-number">1.2.</span> <span class="nav-text">软件开发瀑布模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#软件的敏捷开发"><span class="nav-number">1.3.</span> <span class="nav-text">软件的敏捷开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么是敏捷开发"><span class="nav-number">1.3.1.</span> <span class="nav-text">什么是敏捷开发</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#何为迭代开发？"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">何为迭代开发？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#何为增量开发？"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">何为增量开发？</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#敏捷开发如何迭代？"><span class="nav-number">1.3.2.</span> <span class="nav-text">敏捷开发如何迭代？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#敏捷开发有什么好处？"><span class="nav-number">1.3.3.</span> <span class="nav-text">敏捷开发有什么好处？</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#早期交付"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">早期交付</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#降低风险"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">降低风险</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是持续集成"><span class="nav-number">1.4.</span> <span class="nav-text">什么是持续集成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#持续集成的流程"><span class="nav-number">1.4.1.</span> <span class="nav-text">持续集成的流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#持续集成的组成要素"><span class="nav-number">1.5.</span> <span class="nav-text">持续集成的组成要素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#持续集成的好处"><span class="nav-number">1.6.</span> <span class="nav-text">持续集成的好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jenkins介绍"><span class="nav-number">1.7.</span> <span class="nav-text">Jenkins介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jenkins安装和持续集成环境配置"><span class="nav-number">1.8.</span> <span class="nav-text">Jenkins安装和持续集成环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#持续集成流程说明"><span class="nav-number">1.8.1.</span> <span class="nav-text">持续集成流程说明</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#服务器列表"><span class="nav-number">1.8.1.1.</span> <span class="nav-text">服务器列表</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Gitlab代码托管服务器安装"><span class="nav-number">1.8.2.</span> <span class="nav-text">Gitlab代码托管服务器安装</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Gitlab简介"><span class="nav-number">1.8.2.1.</span> <span class="nav-text">Gitlab简介</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Gitlab安装"><span class="nav-number">1.8.2.2.</span> <span class="nav-text">Gitlab安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Gitlab添加组、创建用户、创建项目"><span class="nav-number">1.8.2.3.</span> <span class="nav-text">Gitlab添加组、创建用户、创建项目</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#源码上传到Gitlab仓库"><span class="nav-number">1.8.3.</span> <span class="nav-text">源码上传到Gitlab仓库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#持续集成环境-1-Jenkins安装"><span class="nav-number">1.8.4.</span> <span class="nav-text">持续集成环境(1)-Jenkins安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#持续集成环境-2-Jenkins插件管理"><span class="nav-number">1.8.5.</span> <span class="nav-text">持续集成环境(2)-Jenkins插件管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#修改Jenkins插件下载地址"><span class="nav-number">1.8.5.1.</span> <span class="nav-text">修改Jenkins插件下载地址</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#下载中文汉化插件"><span class="nav-number">1.8.5.2.</span> <span class="nav-text">下载中文汉化插件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#持续集成环境-3-Jenkins用户权限管理"><span class="nav-number">1.8.6.</span> <span class="nav-text">持续集成环境(3)-Jenkins用户权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Role-based-Authorization-Strategy插件"><span class="nav-number">1.8.6.1.</span> <span class="nav-text">安装Role-based Authorization Strategy插件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#开启权限全局安全配置"><span class="nav-number">1.8.6.2.</span> <span class="nav-text">开启权限全局安全配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#创建角色"><span class="nav-number">1.8.6.3.</span> <span class="nav-text">创建角色</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#创建用户"><span class="nav-number">1.8.6.3.1.</span> <span class="nav-text">创建用户</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#给用户分配角色"><span class="nav-number">1.8.6.3.2.</span> <span class="nav-text">给用户分配角色</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#创建项目测试权限"><span class="nav-number">1.8.6.3.3.</span> <span class="nav-text">创建项目测试权限</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#持续集成环境-4-Jenkins凭证管理"><span class="nav-number">1.8.7.</span> <span class="nav-text">持续集成环境(4)-Jenkins凭证管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Credentials-Binding插件"><span class="nav-number">1.8.7.1.</span> <span class="nav-text">安装Credentials Binding插件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Git插件和Git工具"><span class="nav-number">1.8.7.2.</span> <span class="nav-text">安装Git插件和Git工具</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#用户密码类型"><span class="nav-number">1.8.7.3.</span> <span class="nav-text">用户密码类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SSH密钥类型"><span class="nav-number">1.8.7.4.</span> <span class="nav-text">SSH密钥类型</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#持续集成环境-5-Maven安装和配置"><span class="nav-number">1.8.8.</span> <span class="nav-text">持续集成环境(5)-Maven安装和配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Maven"><span class="nav-number">1.8.8.1.</span> <span class="nav-text">安装Maven</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置环境变量"><span class="nav-number">1.8.8.2.</span> <span class="nav-text">配置环境变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#全局工具配置关联JDK和Maven"><span class="nav-number">1.8.8.3.</span> <span class="nav-text">全局工具配置关联JDK和Maven</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加Jenkins全局变量"><span class="nav-number">1.8.8.4.</span> <span class="nav-text">添加Jenkins全局变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#修改Maven的settings-xml"><span class="nav-number">1.8.8.5.</span> <span class="nav-text">修改Maven的settings.xml</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试Maven是否配置成功"><span class="nav-number">1.8.8.6.</span> <span class="nav-text">测试Maven是否配置成功</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#持续集成环境-6-Tomcat安装和配置"><span class="nav-number">1.8.9.</span> <span class="nav-text">持续集成环境(6)-Tomcat安装和配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Tomcat8-5"><span class="nav-number">1.8.9.1.</span> <span class="nav-text">安装Tomcat8.5</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置Tomcat用户角色权限"><span class="nav-number">1.8.9.2.</span> <span class="nav-text">配置Tomcat用户角色权限</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins构建Maven项目"><span class="nav-number">1.8.10.</span> <span class="nav-text">Jenkins构建Maven项目</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins项目构建类型-1-Jenkins构建的项目类型介绍"><span class="nav-number">1.8.10.1.</span> <span class="nav-text">Jenkins项目构建类型(1)-Jenkins构建的项目类型介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins项目构建类型-2-自由风格项目构建"><span class="nav-number">1.8.10.2.</span> <span class="nav-text">Jenkins项目构建类型(2)-自由风格项目构建</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#拉取代码"><span class="nav-number">1.8.10.2.1.</span> <span class="nav-text">拉取代码</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#编译打包"><span class="nav-number">1.8.10.2.2.</span> <span class="nav-text">编译打包</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#部署"><span class="nav-number">1.8.10.2.3.</span> <span class="nav-text">部署</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#演示改动代码后的持续集成"><span class="nav-number">1.8.10.2.4.</span> <span class="nav-text">演示改动代码后的持续集成</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins项目构建类型-3-Maven项目构建"><span class="nav-number">1.8.10.3.</span> <span class="nav-text">Jenkins项目构建类型(3)-Maven项目构建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins项目构建类型-4-Pipeline流水线项目构建"><span class="nav-number">1.8.10.4.</span> <span class="nav-text">Jenkins项目构建类型(4)-Pipeline流水线项目构建(*)</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Pipeline简介"><span class="nav-number">1.8.10.4.1.</span> <span class="nav-text">Pipeline简介</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#安装Pipeline插件"><span class="nav-number">1.8.10.4.2.</span> <span class="nav-text">安装Pipeline插件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Pipeline语法快速入门"><span class="nav-number">1.8.10.4.3.</span> <span class="nav-text">Pipeline语法快速入门</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins项目构建细节-1-常用的构建触发器"><span class="nav-number">1.8.11.</span> <span class="nav-text">Jenkins项目构建细节(1)-常用的构建触发器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins项目构建细节-2-Git-hook自动触发构建"><span class="nav-number">1.8.12.</span> <span class="nav-text">Jenkins项目构建细节(2)-Git hook自动触发构建(*)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Gitlab-Hook插件"><span class="nav-number">1.8.12.1.</span> <span class="nav-text">安装Gitlab Hook插件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins设置自动构建"><span class="nav-number">1.8.12.2.</span> <span class="nav-text">Jenkins设置自动构建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Gitlab配置webhook"><span class="nav-number">1.8.12.3.</span> <span class="nav-text">Gitlab配置webhook</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins项目构建细节-3-Jenkins的参数化构建"><span class="nav-number">1.8.13.</span> <span class="nav-text">Jenkins项目构建细节(3)-Jenkins的参数化构建</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#项目创建分支，并推送到Gitlab上"><span class="nav-number">1.8.13.1.</span> <span class="nav-text">项目创建分支，并推送到Gitlab上</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在Jenkins添加字符串类型参数"><span class="nav-number">1.8.13.2.</span> <span class="nav-text">在Jenkins添加字符串类型参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#改动pipeline流水线代码"><span class="nav-number">1.8.13.3.</span> <span class="nav-text">改动pipeline流水线代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#点击Build-with-Parameters"><span class="nav-number">1.8.13.4.</span> <span class="nav-text">点击Build with Parameters</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins项目构建细节-4-配置邮箱服务器发送构建结果"><span class="nav-number">1.8.14.</span> <span class="nav-text">Jenkins项目构建细节(4)-配置邮箱服务器发送构建结果</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Email-Extension插件"><span class="nav-number">1.8.14.1.</span> <span class="nav-text">安装Email Extension插件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins设置邮箱相关参数"><span class="nav-number">1.8.14.2.</span> <span class="nav-text">Jenkins设置邮箱相关参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#准备邮件内容"><span class="nav-number">1.8.14.3.</span> <span class="nav-text">准备邮件内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#编写Jenkinsfile添加构建后发送邮件"><span class="nav-number">1.8.14.4.</span> <span class="nav-text">编写Jenkinsfile添加构建后发送邮件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试"><span class="nav-number">1.8.14.5.</span> <span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins-SonarQube代码审查-1-安装SonarQube"><span class="nav-number">1.8.15.</span> <span class="nav-text">Jenkins+SonarQube代码审查(1) - 安装SonarQube</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SonaQube简介"><span class="nav-number">1.8.15.1.</span> <span class="nav-text">SonaQube简介</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#环境要求"><span class="nav-number">1.8.15.2.</span> <span class="nav-text">环境要求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#安装SonarQube"><span class="nav-number">1.8.15.3.</span> <span class="nav-text">安装SonarQube</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins-SonarQube代码审查-2-实现代码审查"><span class="nav-number">1.8.16.</span> <span class="nav-text">Jenkins+SonarQube代码审查(2) - 实现代码审查</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装SonarQube-Scanner插件"><span class="nav-number">1.8.16.1.</span> <span class="nav-text">安装SonarQube Scanner插件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加SonarQube凭证"><span class="nav-number">1.8.16.2.</span> <span class="nav-text">添加SonarQube凭证</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins进行SonarQube配置"><span class="nav-number">1.8.16.3.</span> <span class="nav-text">Jenkins进行SonarQube配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SonaQube关闭审查结果上传到SCM功能"><span class="nav-number">1.8.16.4.</span> <span class="nav-text">SonaQube关闭审查结果上传到SCM功能</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在项目添加SonaQube代码审查（非流水线项目）"><span class="nav-number">1.8.16.5.</span> <span class="nav-text">在项目添加SonaQube代码审查（非流水线项目）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在项目添加SonaQube代码审查（流水线项目）"><span class="nav-number">1.8.16.6.</span> <span class="nav-text">在项目添加SonaQube代码审查（流水线项目）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jenkins-Docker-SpringCloud微服务持续集成-上"><span class="nav-number">1.9.</span> <span class="nav-text">Jenkins+Docker+SpringCloud微服务持续集成(上)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins-Docker-SpringCloud持续集成流程说明"><span class="nav-number">1.9.1.</span> <span class="nav-text">Jenkins+Docker+SpringCloud持续集成流程说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SpringCloud微服务源码概述"><span class="nav-number">1.9.2.</span> <span class="nav-text">SpringCloud微服务源码概述</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#本地部署-1-SpringCloud微服务部署"><span class="nav-number">1.9.2.1.</span> <span class="nav-text">本地部署(1)-SpringCloud微服务部署</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#本地运行微服务"><span class="nav-number">1.9.2.1.1.</span> <span class="nav-text">本地运行微服务</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#本地部署微服务"><span class="nav-number">1.9.2.1.2.</span> <span class="nav-text">本地部署微服务</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#本地部署-2-前端静态web网站"><span class="nav-number">1.9.2.2.</span> <span class="nav-text">本地部署(2)-前端静态web网站</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#环境准备-1-Docker快速入门"><span class="nav-number">1.9.2.3.</span> <span class="nav-text">环境准备(1)-Docker快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Docker简介"><span class="nav-number">1.9.2.3.1.</span> <span class="nav-text">Docker简介</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Docker基本命令快速入门"><span class="nav-number">1.9.2.3.2.</span> <span class="nav-text">Docker基本命令快速入门</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#环境准备-2-Dockerfile镜像脚本快速入门"><span class="nav-number">1.9.2.4.</span> <span class="nav-text">环境准备(2)-Dockerfile镜像脚本快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Dockerfile简介"><span class="nav-number">1.9.2.4.1.</span> <span class="nav-text">Dockerfile简介</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Dockerfile常见命令"><span class="nav-number">1.9.2.4.2.</span> <span class="nav-text">Dockerfile常见命令</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用Dockerfile制作微服务镜像"><span class="nav-number">1.9.2.4.3.</span> <span class="nav-text">使用Dockerfile制作微服务镜像</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#环境准备-3-Harbor镜像仓库安装及使用"><span class="nav-number">1.9.2.5.</span> <span class="nav-text">环境准备(3)-Harbor镜像仓库安装及使用</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Harbor简介"><span class="nav-number">1.9.2.5.1.</span> <span class="nav-text">Harbor简介</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Harbor安装"><span class="nav-number">1.9.2.5.2.</span> <span class="nav-text">Harbor安装</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#把镜像上传到Harbor"><span class="nav-number">1.9.2.5.3.</span> <span class="nav-text">把镜像上传到Harbor</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#从Harbor下载镜像"><span class="nav-number">1.9.2.5.4.</span> <span class="nav-text">从Harbor下载镜像</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#微服务持续集成-1-项目代码上传到Gitlab"><span class="nav-number">1.9.3.</span> <span class="nav-text">微服务持续集成(1)-项目代码上传到Gitlab</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#微服务持续集成-2-从Gitlab拉取项目源码"><span class="nav-number">1.9.4.</span> <span class="nav-text">微服务持续集成(2)-从Gitlab拉取项目源码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#微服务持续集成-3-提交到SonarQube代码审查"><span class="nav-number">1.9.5.</span> <span class="nav-text">微服务持续集成(3)-提交到SonarQube代码审查</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#微服务持续集成-4-使用Dockerfile编译、生成镜像"><span class="nav-number">1.9.6.</span> <span class="nav-text">微服务持续集成(4)-使用Dockerfile编译、生成镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#微服务持续集成-5-上传到Harbor镜像仓库"><span class="nav-number">1.9.7.</span> <span class="nav-text">微服务持续集成(5)-上传到Harbor镜像仓库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#微服务持续集成-6-拉取镜像和发布应用"><span class="nav-number">1.9.8.</span> <span class="nav-text">微服务持续集成(6)-拉取镜像和发布应用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装-Publish-Over-SSH-插件"><span class="nav-number">1.9.8.1.</span> <span class="nav-text">安装 Publish Over SSH 插件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置远程部署服务器"><span class="nav-number">1.9.8.2.</span> <span class="nav-text">配置远程部署服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#修改Jenkinsfile构建脚本"><span class="nav-number">1.9.8.3.</span> <span class="nav-text">修改Jenkinsfile构建脚本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#编写deploy-sh部署脚本"><span class="nav-number">1.9.8.4.</span> <span class="nav-text">编写deploy.sh部署脚本</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#微服务持续集成-7-部署前端静态web网站"><span class="nav-number">1.9.9.</span> <span class="nav-text">微服务持续集成(7)-部署前端静态web网站</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Nginx服务器"><span class="nav-number">1.9.9.1.</span> <span class="nav-text">安装Nginx服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#安装NodeJS插件"><span class="nav-number">1.9.9.2.</span> <span class="nav-text">安装NodeJS插件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins配置Nginx服务器"><span class="nav-number">1.9.9.3.</span> <span class="nav-text">Jenkins配置Nginx服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#创建前端流水线项目"><span class="nav-number">1.9.9.4.</span> <span class="nav-text">创建前端流水线项目</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#建立Jenkinsfile构建脚本"><span class="nav-number">1.9.9.5.</span> <span class="nav-text">建立Jenkinsfile构建脚本</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5、Jenkins-Docker-SpringCloud微服务持续集成-下"><span class="nav-number">1.9.10.</span> <span class="nav-text">5、Jenkins+Docker+SpringCloud微服务持续集成(下)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins-Docker-SpringCloud部署方案优化"><span class="nav-number">1.9.10.1.</span> <span class="nav-text">Jenkins+Docker+SpringCloud部署方案优化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins-Docker-SpringCloud集群部署流程说明"><span class="nav-number">1.9.10.2.</span> <span class="nav-text">Jenkins+Docker+SpringCloud集群部署流程说明</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#修改所有微服务配置"><span class="nav-number">1.9.10.3.</span> <span class="nav-text">修改所有微服务配置</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#注册中心配置"><span class="nav-number">1.9.10.3.1.</span> <span class="nav-text">注册中心配置(*)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#其他微服务配置"><span class="nav-number">1.9.10.3.2.</span> <span class="nav-text">其他微服务配置</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#设计Jenkins集群项目的构建参数"><span class="nav-number">1.9.10.4.</span> <span class="nav-text">设计Jenkins集群项目的构建参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#完成微服务构建镜像，上传私服"><span class="nav-number">1.9.10.5.</span> <span class="nav-text">完成微服务构建镜像，上传私服</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#完成微服务多服务器远程发布"><span class="nav-number">1.9.10.6.</span> <span class="nav-text">完成微服务多服务器远程发布</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Nginx-Zuul集群实现高可用网关"><span class="nav-number">1.9.10.7.</span> <span class="nav-text">Nginx+Zuul集群实现高可用网关</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于Kubernetes-K8S构建Jenkins持续集成平台-上"><span class="nav-number">1.10.</span> <span class="nav-text">基于Kubernetes/K8S构建Jenkins持续集成平台(上)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins的Master-Slave分布式构建"><span class="nav-number">1.10.1.</span> <span class="nav-text">Jenkins的Master-Slave分布式构建</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#什么是Master-Slave分布式构建"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">什么是Master-Slave分布式构建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#如何实现Master-Slave分布式构建"><span class="nav-number">1.10.1.2.</span> <span class="nav-text">如何实现Master-Slave分布式构建</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kubernetes实现Master-Slave分布式构建方案"><span class="nav-number">1.10.2.</span> <span class="nav-text">Kubernetes实现Master-Slave分布式构建方案</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#传统Jenkins的Master-Slave方案的缺陷"><span class="nav-number">1.10.2.1.</span> <span class="nav-text">传统Jenkins的Master-Slave方案的缺陷</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Kubernates简介"><span class="nav-number">1.10.2.1.1.</span> <span class="nav-text">Kubernates简介</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Kubernates-Docker-Jenkins持续集成架构图"><span class="nav-number">1.10.2.1.2.</span> <span class="nav-text">Kubernates+Docker+Jenkins持续集成架构图</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Kubernates-Docker-Jenkins持续集成方案好处"><span class="nav-number">1.10.2.1.3.</span> <span class="nav-text">Kubernates+Docker+Jenkins持续集成方案好处</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Kubeadm安装Kubernetes"><span class="nav-number">1.10.2.2.</span> <span class="nav-text">Kubeadm安装Kubernetes</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Kubernetes的架构"><span class="nav-number">1.10.2.2.1.</span> <span class="nav-text">Kubernetes的架构</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#安装环境说明"><span class="nav-number">1.10.2.2.2.</span> <span class="nav-text">安装环境说明</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#三台机器都需要完成"><span class="nav-number">1.10.2.2.3.</span> <span class="nav-text">三台机器都需要完成</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#所有节点关闭swap"><span class="nav-number">1.10.2.2.4.</span> <span class="nav-text">所有节点关闭swap</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#安装kubelet、kubeadm、kubectl"><span class="nav-number">1.10.2.2.5.</span> <span class="nav-text">安装kubelet、kubeadm、kubectl</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Master节点需要完成"><span class="nav-number">1.10.2.2.6.</span> <span class="nav-text">Master节点需要完成</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Slave节点需要完成"><span class="nav-number">1.10.2.2.7.</span> <span class="nav-text">Slave节点需要完成</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#kubectl常用命令"><span class="nav-number">1.10.2.2.8.</span> <span class="nav-text">kubectl常用命令</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于Kubernetes-K8S构建Jenkins持续集成平台-下"><span class="nav-number">1.11.</span> <span class="nav-text">基于Kubernetes/K8S构建Jenkins持续集成平台(下)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装和配置-NFS"><span class="nav-number">1.11.1.</span> <span class="nav-text">安装和配置 NFS</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#NFS简介"><span class="nav-number">1.11.1.1.</span> <span class="nav-text">NFS简介</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#NFS安装"><span class="nav-number">1.11.1.2.</span> <span class="nav-text">NFS安装</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在Kubernetes安装Jenkins-Master"><span class="nav-number">1.11.2.</span> <span class="nav-text">在Kubernetes安装Jenkins-Master</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建NFS-client-provisioner"><span class="nav-number">1.11.2.1.</span> <span class="nav-text">创建NFS client provisioner</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Jenkins-Master"><span class="nav-number">1.11.2.2.</span> <span class="nav-text">安装Jenkins-Master</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jenkins与Kubernetes整合"><span class="nav-number">1.11.3.</span> <span class="nav-text">Jenkins与Kubernetes整合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装Kubernetes插件"><span class="nav-number">1.11.3.1.</span> <span class="nav-text">安装Kubernetes插件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#实现Jenkins与Kubernetes整合"><span class="nav-number">1.11.3.2.</span> <span class="nav-text">实现Jenkins与Kubernetes整合</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#构建Jenkins-Slave自定义镜像"><span class="nav-number">1.11.3.3.</span> <span class="nav-text">构建Jenkins-Slave自定义镜像</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试Jenkins-Slave是否可以创建"><span class="nav-number">1.11.3.4.</span> <span class="nav-text">测试Jenkins-Slave是否可以创建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Jenkins-Kubernetes-Docker完成微服务持续集成"><span class="nav-number">1.11.3.5.</span> <span class="nav-text">Jenkins+Kubernetes+Docker完成微服务持续集成</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#拉取代码，构建镜像"><span class="nav-number">1.11.3.5.1.</span> <span class="nav-text">拉取代码，构建镜像</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#微服务部署到K8S"><span class="nav-number">1.11.3.6.</span> <span class="nav-text">微服务部署到K8S</span></a></li></ol></li></ol></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">Copyright&copy; <span itemprop="copyrightYear">2018-2021</span> <span class="with-love" id="heart"><i class="fa fa-heart" style="color:#ff71a8"></i> </span><span class="author" itemprop="copyrightHolder">HuiProgramer</span></div><div><span id="days"></span> <span class="my-face">ღゝ◡╹)ノ♡</span></div><div><span id="busuanzi_container_site_pv" style="display:inline-block">总访问量： <span id="busuanzi_value_site_pv"></span> 次 <span class="post-meta-divider">|</span> </span><span id="busuanzi_container_site_uv" style="display:inline-block">访问人数：<span id="busuanzi_value_site_uv"></span> 人 <span class="post-meta-divider">|</span></span><div class="theme-info"><span class="post-count">字数统计：236.3k 字</span></div></div><div><span id="cnzz_stat_icon_1277385852"></span><script src="https://s23.cnzz.com/z_stat.php?id=1277385852&amp;online=1&amp;show=line" type="text/javascript"></script><script src="https://c.cnzz.com/core.php?web_id=1277385852&amp;show=line&amp;online=1&amp;t=z" charset="utf-8" type="text/javascript"></script></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("11/25/2018 08:18:26"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="本站已勉强运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("TCcAB5wC7Rjx4Xe9aFUYiMUU-gzGzoHsz","pC764tcMRXbraCg5anMgT3QF")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><style>#wenkmTips{position:fixed;font-size:1.4em;text-shadow:none;border-radius:0 5px 5px 0;z-index:5000;top:10px;left:0;background-color:rgba(13,159,203,.6);padding:15px;color:#fff;-webkit-transition:.5s;-moz-transition:.5s;-ms-transition:.5s;transition:.5s;-webkit-transform:translate3d(-100%,0,0);-moz-transform:translate3d(-100%,0,0);-ms-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}#wenkmTips.show{-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}.backtop{position:absolute;top:50%;z-index:3;clear:both;display:none;margin-top:-50px;margin-left:0;idth:68px;height:100px;background:url(https://huiprogramer.gitee.io/images/backtop.png)}</style><script type="text/javascript">function lanye_popup_box(){$("#lanye_popup_bg").fadeIn(800),$("#lanye_popup_bg").after("<div class=lanye_popup_box><h2><strong>支付宝扫码领红包</strong><span class=lanye_popup_closebox onclick=lanye_popup_closebox();></span></h2><div class=lanye_popup_boxcont><div style = 'padding:0px 12px 0px 12px;'>打开支付宝扫描二维码领取红包或者在支付宝首页输入<font color=red>1347239</font>搜索领取红包，每天可领取一次哦。</div><p style=padding-top:5px;padding-bottom:5px;text-align:center><img referrerpolicy='no-referrer' style=width:260px;height:auto; src=https://ws4.sinaimg.cn/large/006MOU0zgy1g23dhnc12bj30fs0nojtf.jpg /></p></div></div>"),$(".hb_box").fadeIn()}function lanye_popup_closebox(){$(".lanye_popup_box").remove(),$("#lanye_popup_bg").fadeOut(800)}$(document).ready(function(){$(".lanye_popup_close").click(function(){$(".lanye_popup_box").fadeOut()}),$(".lanye_popup_closetop").click(function(){$(".lanye_popup_top").remove()})}),$("meta[name='generator']").prop("content","在线生成").prop("name","在线分享网"),$(function(){setTimeout(function(){$("#cnzz_stat_icon_1277040022 a").css("border-bottom","none"),$("#cnzz_stat_icon_1277040022 a").css("color","#999")},1e3)})</script><script id="cy_cmt_num" async src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cyu7tijsf"></script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script async type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script async type="text/javascript" src="/js/src/fireworks.js"></script></body></html><!-- rebuild by neat -->